/*! For license information please see emulator.js.LICENSE.txt */
(()=>{var e={783:e=>{var t;self,t=function(){return(()=>{var e={"./node_modules/assertion-error/index.js":e=>{function t(){var e=[].slice.call(arguments);function t(t,i){Object.keys(i).forEach((function(r){~e.indexOf(r)||(t[r]=i[r])}))}return function(){for(var e=[].slice.call(arguments),i=0,r={};i<e.length;i++)t(r,e[i]);return r}}function i(e,r,n){var s=t("name","message","stack","constructor","toJSON")(r||{});for(var o in this.message=e||"Unspecified AssertionError",this.showDiff=!1,s)this[o]=s[o];if(n=n||i,Error.captureStackTrace)Error.captureStackTrace(this,n);else try{throw new Error}catch(e){this.stack=e.stack}}e.exports=i,i.prototype=Object.create(Error.prototype),i.prototype.name="AssertionError",i.prototype.constructor=i,i.prototype.toJSON=function(e){var i=t("constructor","toJSON","stack")({name:this.name},this);return!1!==e&&this.stack&&(i.stack=this.stack),i}},"./node_modules/chai/index.js":(e,t,i)=>{e.exports=i("./node_modules/chai/lib/chai.js")},"./node_modules/chai/index.mjs":(e,t,i)=>{"use strict";i.r(t),i.d(t,{expect:()=>n,version:()=>s,AssertionError:()=>o,util:()=>a,config:()=>c,use:()=>h,should:()=>l,assert:()=>u,core:()=>p,default:()=>d});var r=i("./node_modules/chai/index.js");const n=r.expect,s=r.version,o=r.AssertionError,a=r.util,c=r.config,h=r.use,l=r.should,u=r.assert,p=r.core,d=r},"./node_modules/chai/lib/chai.js":(e,t,i)=>{var r=[];t.version="4.3.0",t.AssertionError=i("./node_modules/assertion-error/index.js");var n=i("./node_modules/chai/lib/chai/utils/index.js");t.use=function(e){return~r.indexOf(e)||(e(t,n),r.push(e)),t},t.util=n;var s=i("./node_modules/chai/lib/chai/config.js");t.config=s;var o=i("./node_modules/chai/lib/chai/assertion.js");t.use(o);var a=i("./node_modules/chai/lib/chai/core/assertions.js");t.use(a);var c=i("./node_modules/chai/lib/chai/interface/expect.js");t.use(c);var h=i("./node_modules/chai/lib/chai/interface/should.js");t.use(h);var l=i("./node_modules/chai/lib/chai/interface/assert.js");t.use(l)},"./node_modules/chai/lib/chai/assertion.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/config.js");e.exports=function(e,t){var i=e.AssertionError,n=t.flag;function s(e,i,r,o){return n(this,"ssfi",r||s),n(this,"lockSsfi",o),n(this,"object",e),n(this,"message",i),t.proxify(this)}e.Assertion=s,Object.defineProperty(s,"includeStack",{get:function(){return console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead."),r.includeStack},set:function(e){console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead."),r.includeStack=e}}),Object.defineProperty(s,"showDiff",{get:function(){return console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead."),r.showDiff},set:function(e){console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead."),r.showDiff=e}}),s.addProperty=function(e,i){t.addProperty(this.prototype,e,i)},s.addMethod=function(e,i){t.addMethod(this.prototype,e,i)},s.addChainableMethod=function(e,i,r){t.addChainableMethod(this.prototype,e,i,r)},s.overwriteProperty=function(e,i){t.overwriteProperty(this.prototype,e,i)},s.overwriteMethod=function(e,i){t.overwriteMethod(this.prototype,e,i)},s.overwriteChainableMethod=function(e,i,r){t.overwriteChainableMethod(this.prototype,e,i,r)},s.prototype.assert=function(e,s,o,a,c,h){var l=t.test(this,arguments);if(!1!==h&&(h=!0),void 0===a&&void 0===c&&(h=!1),!0!==r.showDiff&&(h=!1),!l){s=t.getMessage(this,arguments);var u=t.getActual(this,arguments),p={actual:u,expected:a,showDiff:h},d=t.getOperator(this,arguments);throw d&&(p.operator=d),new i(s,p,r.includeStack?this.assert:n(this,"ssfi"))}},Object.defineProperty(s.prototype,"_obj",{get:function(){return n(this,"object")},set:function(e){n(this,"object",e)}})}},"./node_modules/chai/lib/chai/config.js":e=>{e.exports={includeStack:!1,showDiff:!0,truncateThreshold:40,useProxy:!0,proxyExcludedKeys:["then","catch","inspect","toJSON"]}},"./node_modules/chai/lib/chai/core/assertions.js":e=>{e.exports=function(e,t){var i=e.Assertion,r=e.AssertionError,n=t.flag;function s(e,i){i&&n(this,"message",i),e=e.toLowerCase();var r=n(this,"object"),s=~["a","e","i","o","u"].indexOf(e.charAt(0))?"an ":"a ";this.assert(e===t.type(r).toLowerCase(),"expected #{this} to be "+s+e,"expected #{this} not to be "+s+e)}function o(e,i){return t.isNaN(e)&&t.isNaN(i)||e===i}function a(){n(this,"contains",!0)}function c(e,s){s&&n(this,"message",s);var a=n(this,"object"),c=t.type(a).toLowerCase(),h=n(this,"message"),l=n(this,"negate"),u=n(this,"ssfi"),p=n(this,"deep"),d=p?"deep ":"";h=h?h+": ":"";var f=!1;switch(c){case"string":f=-1!==a.indexOf(e);break;case"weakset":if(p)throw new r(h+"unable to use .deep.include with WeakSet",void 0,u);f=a.has(e);break;case"map":var m=p?t.eql:o;a.forEach((function(t){f=f||m(t,e)}));break;case"set":p?a.forEach((function(i){f=f||t.eql(i,e)})):f=a.has(e);break;case"array":f=p?a.some((function(i){return t.eql(i,e)})):-1!==a.indexOf(e);break;default:if(e!==Object(e))throw new r(h+"the given combination of arguments ("+c+" and "+t.type(e).toLowerCase()+") is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a "+t.type(e).toLowerCase(),void 0,u);var g=Object.keys(e),y=null,v=0;if(g.forEach((function(s){var o=new i(a);if(t.transferFlags(this,o,!0),n(o,"lockSsfi",!0),l&&1!==g.length)try{o.property(s,e[s])}catch(e){if(!t.checkError.compatibleConstructor(e,r))throw e;null===y&&(y=e),v++}else o.property(s,e[s])}),this),l&&g.length>1&&v===g.length)throw y;return}this.assert(f,"expected #{this} to "+d+"include "+t.inspect(e),"expected #{this} to not "+d+"include "+t.inspect(e))}function h(){var e=n(this,"object"),i=t.type(e);this.assert("Arguments"===i,"expected #{this} to be arguments but got "+i,"expected #{this} to not be arguments")}function l(e,t){t&&n(this,"message",t);var i=n(this,"object");if(n(this,"deep")){var r=n(this,"lockSsfi");n(this,"lockSsfi",!0),this.eql(e),n(this,"lockSsfi",r)}else this.assert(e===i,"expected #{this} to equal #{exp}","expected #{this} to not equal #{exp}",e,this._obj,!0)}function u(e,i){i&&n(this,"message",i),this.assert(t.eql(e,n(this,"object")),"expected #{this} to deeply equal #{exp}","expected #{this} to not deeply equal #{exp}",e,this._obj,!0)}function p(e,s){s&&n(this,"message",s);var o,a=n(this,"object"),c=n(this,"doLength"),h=n(this,"message"),l=h?h+": ":"",u=n(this,"ssfi"),p=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(c&&"map"!==p&&"set"!==p&&new i(a,h,u,!0).to.have.property("length"),c||"date"!==p||"date"===d?"number"===d||!c&&"number"!==p?c||"date"===p||"number"===p?f=!1:o=l+"expected "+("string"===p?"'"+a+"'":a)+" to be a number or a date":o=l+"the argument to above must be a number":o=l+"the argument to above must be a date",f)throw new r(o,void 0,u);if(c){var m,g="length";"map"===p||"set"===p?(g="size",m=a.size):m=a.length,this.assert(m>e,"expected #{this} to have a "+g+" above #{exp} but got #{act}","expected #{this} to not have a "+g+" above #{exp}",e,m)}else this.assert(a>e,"expected #{this} to be above #{exp}","expected #{this} to be at most #{exp}",e)}function d(e,s){s&&n(this,"message",s);var o,a=n(this,"object"),c=n(this,"doLength"),h=n(this,"message"),l=h?h+": ":"",u=n(this,"ssfi"),p=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(c&&"map"!==p&&"set"!==p&&new i(a,h,u,!0).to.have.property("length"),c||"date"!==p||"date"===d?"number"===d||!c&&"number"!==p?c||"date"===p||"number"===p?f=!1:o=l+"expected "+("string"===p?"'"+a+"'":a)+" to be a number or a date":o=l+"the argument to least must be a number":o=l+"the argument to least must be a date",f)throw new r(o,void 0,u);if(c){var m,g="length";"map"===p||"set"===p?(g="size",m=a.size):m=a.length,this.assert(m>=e,"expected #{this} to have a "+g+" at least #{exp} but got #{act}","expected #{this} to have a "+g+" below #{exp}",e,m)}else this.assert(a>=e,"expected #{this} to be at least #{exp}","expected #{this} to be below #{exp}",e)}function f(e,s){s&&n(this,"message",s);var o,a=n(this,"object"),c=n(this,"doLength"),h=n(this,"message"),l=h?h+": ":"",u=n(this,"ssfi"),p=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(c&&"map"!==p&&"set"!==p&&new i(a,h,u,!0).to.have.property("length"),c||"date"!==p||"date"===d?"number"===d||!c&&"number"!==p?c||"date"===p||"number"===p?f=!1:o=l+"expected "+("string"===p?"'"+a+"'":a)+" to be a number or a date":o=l+"the argument to below must be a number":o=l+"the argument to below must be a date",f)throw new r(o,void 0,u);if(c){var m,g="length";"map"===p||"set"===p?(g="size",m=a.size):m=a.length,this.assert(m<e,"expected #{this} to have a "+g+" below #{exp} but got #{act}","expected #{this} to not have a "+g+" below #{exp}",e,m)}else this.assert(a<e,"expected #{this} to be below #{exp}","expected #{this} to be at least #{exp}",e)}function m(e,s){s&&n(this,"message",s);var o,a=n(this,"object"),c=n(this,"doLength"),h=n(this,"message"),l=h?h+": ":"",u=n(this,"ssfi"),p=t.type(a).toLowerCase(),d=t.type(e).toLowerCase(),f=!0;if(c&&"map"!==p&&"set"!==p&&new i(a,h,u,!0).to.have.property("length"),c||"date"!==p||"date"===d?"number"===d||!c&&"number"!==p?c||"date"===p||"number"===p?f=!1:o=l+"expected "+("string"===p?"'"+a+"'":a)+" to be a number or a date":o=l+"the argument to most must be a number":o=l+"the argument to most must be a date",f)throw new r(o,void 0,u);if(c){var m,g="length";"map"===p||"set"===p?(g="size",m=a.size):m=a.length,this.assert(m<=e,"expected #{this} to have a "+g+" at most #{exp} but got #{act}","expected #{this} to have a "+g+" above #{exp}",e,m)}else this.assert(a<=e,"expected #{this} to be at most #{exp}","expected #{this} to be above #{exp}",e)}function g(e,i){i&&n(this,"message",i);var s=n(this,"object"),o=n(this,"ssfi"),a=n(this,"message");try{var c=s instanceof e}catch(i){if(i instanceof TypeError)throw new r((a=a?a+": ":"")+"The instanceof assertion needs a constructor but "+t.type(e)+" was given.",void 0,o);throw i}var h=t.getName(e);null===h&&(h="an unnamed constructor"),this.assert(c,"expected #{this} to be an instance of "+h,"expected #{this} to not be an instance of "+h)}function y(e,i,s){s&&n(this,"message",s);var o=n(this,"nested"),a=n(this,"own"),c=n(this,"message"),h=n(this,"object"),l=n(this,"ssfi"),u=typeof e;if(c=c?c+": ":"",o){if("string"!==u)throw new r(c+"the argument to property must be a string when using nested syntax",void 0,l)}else if("string"!==u&&"number"!==u&&"symbol"!==u)throw new r(c+"the argument to property must be a string, number, or symbol",void 0,l);if(o&&a)throw new r(c+'The "nested" and "own" flags cannot be combined.',void 0,l);if(null==h)throw new r(c+"Target cannot be null or undefined.",void 0,l);var p,d=n(this,"deep"),f=n(this,"negate"),m=o?t.getPathInfo(h,e):null,g=o?m.value:h[e],y="";d&&(y+="deep "),a&&(y+="own "),o&&(y+="nested "),y+="property ",p=a?Object.prototype.hasOwnProperty.call(h,e):o?m.exists:t.hasProperty(h,e),f&&1!==arguments.length||this.assert(p,"expected #{this} to have "+y+t.inspect(e),"expected #{this} to not have "+y+t.inspect(e)),arguments.length>1&&this.assert(p&&(d?t.eql(i,g):i===g),"expected #{this} to have "+y+t.inspect(e)+" of #{exp}, but got #{act}","expected #{this} to not have "+y+t.inspect(e)+" of #{act}",i,g),n(this,"object",g)}function v(e,t,i){n(this,"own",!0),y.apply(this,arguments)}function b(e,i,r){"string"==typeof i&&(r=i,i=null),r&&n(this,"message",r);var s=n(this,"object"),o=Object.getOwnPropertyDescriptor(Object(s),e);o&&i?this.assert(t.eql(i,o),"expected the own property descriptor for "+t.inspect(e)+" on #{this} to match "+t.inspect(i)+", got "+t.inspect(o),"expected the own property descriptor for "+t.inspect(e)+" on #{this} to not match "+t.inspect(i),i,o,!0):this.assert(o,"expected #{this} to have an own property descriptor for "+t.inspect(e),"expected #{this} to not have an own property descriptor for "+t.inspect(e)),n(this,"object",o)}function _(){n(this,"doLength",!0)}function S(e,r){r&&n(this,"message",r);var s,o=n(this,"object"),a=t.type(o).toLowerCase(),c=n(this,"message"),h=n(this,"ssfi"),l="length";switch(a){case"map":case"set":l="size",s=o.size;break;default:new i(o,c,h,!0).to.have.property("length"),s=o.length}this.assert(s==e,"expected #{this} to have a "+l+" of #{exp} but got #{act}","expected #{this} to not have a "+l+" of #{act}",e,s)}function R(e,t){t&&n(this,"message",t);var i=n(this,"object");this.assert(e.exec(i),"expected #{this} to match "+e,"expected #{this} not to match "+e)}function C(e){var i,s,o=n(this,"object"),a=t.type(o),c=t.type(e),h=n(this,"ssfi"),l=n(this,"deep"),u="",p=!0,d=n(this,"message"),f=(d=d?d+": ":"")+"when testing keys against an object or an array you must give a single Array|Object|String argument or multiple String arguments";if("Map"===a||"Set"===a)u=l?"deeply ":"",s=[],o.forEach((function(e,t){s.push(t)})),"Array"!==c&&(e=Array.prototype.slice.call(arguments));else{switch(s=t.getOwnEnumerableProperties(o),c){case"Array":if(arguments.length>1)throw new r(f,void 0,h);break;case"Object":if(arguments.length>1)throw new r(f,void 0,h);e=Object.keys(e);break;default:e=Array.prototype.slice.call(arguments)}e=e.map((function(e){return"symbol"==typeof e?e:String(e)}))}if(!e.length)throw new r(d+"keys required",void 0,h);var m=e.length,g=n(this,"any"),y=n(this,"all"),v=e;if(g||y||(y=!0),g&&(p=v.some((function(e){return s.some((function(i){return l?t.eql(e,i):e===i}))}))),y&&(p=v.every((function(e){return s.some((function(i){return l?t.eql(e,i):e===i}))})),n(this,"contains")||(p=p&&e.length==s.length)),m>1){var b=(e=e.map((function(e){return t.inspect(e)}))).pop();y&&(i=e.join(", ")+", and "+b),g&&(i=e.join(", ")+", or "+b)}else i=t.inspect(e[0]);i=(m>1?"keys ":"key ")+i,i=(n(this,"contains")?"contain ":"have ")+i,this.assert(p,"expected #{this} to "+u+i,"expected #{this} to not "+u+i,v.slice(0).sort(t.compareByInspect),s.sort(t.compareByInspect),!0)}function w(e,r,s){s&&n(this,"message",s);var o,a=n(this,"object"),c=n(this,"ssfi"),h=n(this,"message"),l=n(this,"negate")||!1;new i(a,h,c,!0).is.a("function"),(e instanceof RegExp||"string"==typeof e)&&(r=e,e=null);try{a()}catch(e){o=e}var u=void 0===e&&void 0===r,p=Boolean(e&&r),d=!1,f=!1;if(u||!u&&!l){var m="an error";e instanceof Error?m="#{exp}":e&&(m=t.checkError.getConstructorName(e)),this.assert(o,"expected #{this} to throw "+m,"expected #{this} to not throw an error but #{act} was thrown",e&&e.toString(),o instanceof Error?o.toString():"string"==typeof o?o:o&&t.checkError.getConstructorName(o))}if(e&&o&&(e instanceof Error&&t.checkError.compatibleInstance(o,e)===l&&(p&&l?d=!0:this.assert(l,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(o&&!l?" but #{act} was thrown":""),e.toString(),o.toString())),t.checkError.compatibleConstructor(o,e)===l&&(p&&l?d=!0:this.assert(l,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(o?" but #{act} was thrown":""),e instanceof Error?e.toString():e&&t.checkError.getConstructorName(e),o instanceof Error?o.toString():o&&t.checkError.getConstructorName(o)))),o&&null!=r){var g="including";r instanceof RegExp&&(g="matching"),t.checkError.compatibleMessage(o,r)===l&&(p&&l?f=!0:this.assert(l,"expected #{this} to throw error "+g+" #{exp} but got #{act}","expected #{this} to throw error not "+g+" #{exp}",r,t.checkError.getMessage(o)))}d&&f&&this.assert(l,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(o?" but #{act} was thrown":""),e instanceof Error?e.toString():e&&t.checkError.getConstructorName(e),o instanceof Error?o.toString():o&&t.checkError.getConstructorName(o)),n(this,"object",o)}function T(e,i){i&&n(this,"message",i);var r=n(this,"object"),s=n(this,"itself"),o="function"!=typeof r||s?r[e]:r.prototype[e];this.assert("function"==typeof o,"expected #{this} to respond to "+t.inspect(e),"expected #{this} to not respond to "+t.inspect(e))}function E(e,i){i&&n(this,"message",i);var r=e(n(this,"object"));this.assert(r,"expected #{this} to satisfy "+t.objDisplay(e),"expected #{this} to not satisfy"+t.objDisplay(e),!n(this,"negate"),r)}function P(e,t,s){s&&n(this,"message",s);var o=n(this,"object"),a=n(this,"message"),c=n(this,"ssfi");if(new i(o,a,c,!0).is.a("number"),"number"!=typeof e||"number"!=typeof t)throw new r((a=a?a+": ":"")+"the arguments to closeTo or approximately must be numbers"+(void 0===t?", and a delta is required":""),void 0,c);this.assert(Math.abs(o-e)<=t,"expected #{this} to be close to "+e+" +/- "+t,"expected #{this} not to be close to "+e+" +/- "+t)}function D(e,t,r){r&&n(this,"message",r);var s,o=n(this,"object"),a=n(this,"message"),c=n(this,"ssfi");new i(o,a,c,!0).is.a("function"),t?(new i(e,a,c,!0).to.have.property(t),s=e[t]):(new i(e,a,c,!0).is.a("function"),s=e()),o();var h=null==t?e():e[t],l=null==t?s:"."+t;n(this,"deltaMsgObj",l),n(this,"initialDeltaValue",s),n(this,"finalDeltaValue",h),n(this,"deltaBehavior","change"),n(this,"realDelta",h!==s),this.assert(s!==h,"expected "+l+" to change","expected "+l+" to not change")}function I(e,t,r){r&&n(this,"message",r);var s,o=n(this,"object"),a=n(this,"message"),c=n(this,"ssfi");new i(o,a,c,!0).is.a("function"),t?(new i(e,a,c,!0).to.have.property(t),s=e[t]):(new i(e,a,c,!0).is.a("function"),s=e()),new i(s,a,c,!0).is.a("number"),o();var h=null==t?e():e[t],l=null==t?s:"."+t;n(this,"deltaMsgObj",l),n(this,"initialDeltaValue",s),n(this,"finalDeltaValue",h),n(this,"deltaBehavior","increase"),n(this,"realDelta",h-s),this.assert(h-s>0,"expected "+l+" to increase","expected "+l+" to not increase")}function O(e,t,r){r&&n(this,"message",r);var s,o=n(this,"object"),a=n(this,"message"),c=n(this,"ssfi");new i(o,a,c,!0).is.a("function"),t?(new i(e,a,c,!0).to.have.property(t),s=e[t]):(new i(e,a,c,!0).is.a("function"),s=e()),new i(s,a,c,!0).is.a("number"),o();var h=null==t?e():e[t],l=null==t?s:"."+t;n(this,"deltaMsgObj",l),n(this,"initialDeltaValue",s),n(this,"finalDeltaValue",h),n(this,"deltaBehavior","decrease"),n(this,"realDelta",s-h),this.assert(h-s<0,"expected "+l+" to decrease","expected "+l+" to not decrease")}["to","be","been","is","and","has","have","with","that","which","at","of","same","but","does","still"].forEach((function(e){i.addProperty(e)})),i.addProperty("not",(function(){n(this,"negate",!0)})),i.addProperty("deep",(function(){n(this,"deep",!0)})),i.addProperty("nested",(function(){n(this,"nested",!0)})),i.addProperty("own",(function(){n(this,"own",!0)})),i.addProperty("ordered",(function(){n(this,"ordered",!0)})),i.addProperty("any",(function(){n(this,"any",!0),n(this,"all",!1)})),i.addProperty("all",(function(){n(this,"all",!0),n(this,"any",!1)})),i.addChainableMethod("an",s),i.addChainableMethod("a",s),i.addChainableMethod("include",c,a),i.addChainableMethod("contain",c,a),i.addChainableMethod("contains",c,a),i.addChainableMethod("includes",c,a),i.addProperty("ok",(function(){this.assert(n(this,"object"),"expected #{this} to be truthy","expected #{this} to be falsy")})),i.addProperty("true",(function(){this.assert(!0===n(this,"object"),"expected #{this} to be true","expected #{this} to be false",!n(this,"negate"))})),i.addProperty("false",(function(){this.assert(!1===n(this,"object"),"expected #{this} to be false","expected #{this} to be true",!!n(this,"negate"))})),i.addProperty("null",(function(){this.assert(null===n(this,"object"),"expected #{this} to be null","expected #{this} not to be null")})),i.addProperty("undefined",(function(){this.assert(void 0===n(this,"object"),"expected #{this} to be undefined","expected #{this} not to be undefined")})),i.addProperty("NaN",(function(){this.assert(t.isNaN(n(this,"object")),"expected #{this} to be NaN","expected #{this} not to be NaN")})),i.addProperty("exist",(function(){var e=n(this,"object");this.assert(null!=e,"expected #{this} to exist","expected #{this} to not exist")})),i.addProperty("empty",(function(){var e,i=n(this,"object"),s=n(this,"ssfi"),o=n(this,"message");switch(o=o?o+": ":"",t.type(i).toLowerCase()){case"array":case"string":e=i.length;break;case"map":case"set":e=i.size;break;case"weakmap":case"weakset":throw new r(o+".empty was passed a weak collection",void 0,s);case"function":var a=o+".empty was passed a function "+t.getName(i);throw new r(a.trim(),void 0,s);default:if(i!==Object(i))throw new r(o+".empty was passed non-string primitive "+t.inspect(i),void 0,s);e=Object.keys(i).length}this.assert(0===e,"expected #{this} to be empty","expected #{this} not to be empty")})),i.addProperty("arguments",h),i.addProperty("Arguments",h),i.addMethod("equal",l),i.addMethod("equals",l),i.addMethod("eq",l),i.addMethod("eql",u),i.addMethod("eqls",u),i.addMethod("above",p),i.addMethod("gt",p),i.addMethod("greaterThan",p),i.addMethod("least",d),i.addMethod("gte",d),i.addMethod("below",f),i.addMethod("lt",f),i.addMethod("lessThan",f),i.addMethod("most",m),i.addMethod("lte",m),i.addMethod("within",(function(e,s,o){o&&n(this,"message",o);var a,c=n(this,"object"),h=n(this,"doLength"),l=n(this,"message"),u=l?l+": ":"",p=n(this,"ssfi"),d=t.type(c).toLowerCase(),f=t.type(e).toLowerCase(),m=t.type(s).toLowerCase(),g=!0,y="date"===f&&"date"===m?e.toUTCString()+".."+s.toUTCString():e+".."+s;if(h&&"map"!==d&&"set"!==d&&new i(c,l,p,!0).to.have.property("length"),h||"date"!==d||"date"===f&&"date"===m?"number"===f&&"number"===m||!h&&"number"!==d?h||"date"===d||"number"===d?g=!1:a=u+"expected "+("string"===d?"'"+c+"'":c)+" to be a number or a date":a=u+"the arguments to within must be numbers":a=u+"the arguments to within must be dates",g)throw new r(a,void 0,p);if(h){var v,b="length";"map"===d||"set"===d?(b="size",v=c.size):v=c.length,this.assert(v>=e&&v<=s,"expected #{this} to have a "+b+" within "+y,"expected #{this} to not have a "+b+" within "+y)}else this.assert(c>=e&&c<=s,"expected #{this} to be within "+y,"expected #{this} to not be within "+y)})),i.addMethod("instanceof",g),i.addMethod("instanceOf",g),i.addMethod("property",y),i.addMethod("ownProperty",v),i.addMethod("haveOwnProperty",v),i.addMethod("ownPropertyDescriptor",b),i.addMethod("haveOwnPropertyDescriptor",b),i.addChainableMethod("length",S,_),i.addChainableMethod("lengthOf",S,_),i.addMethod("match",R),i.addMethod("matches",R),i.addMethod("string",(function(e,r){r&&n(this,"message",r);var s=n(this,"object"),o=n(this,"message"),a=n(this,"ssfi");new i(s,o,a,!0).is.a("string"),this.assert(~s.indexOf(e),"expected #{this} to contain "+t.inspect(e),"expected #{this} to not contain "+t.inspect(e))})),i.addMethod("keys",C),i.addMethod("key",C),i.addMethod("throw",w),i.addMethod("throws",w),i.addMethod("Throw",w),i.addMethod("respondTo",T),i.addMethod("respondsTo",T),i.addProperty("itself",(function(){n(this,"itself",!0)})),i.addMethod("satisfy",E),i.addMethod("satisfies",E),i.addMethod("closeTo",P),i.addMethod("approximately",P),i.addMethod("members",(function(e,r){r&&n(this,"message",r);var s=n(this,"object"),o=n(this,"message"),a=n(this,"ssfi");new i(s,o,a,!0).to.be.an("array"),new i(e,o,a,!0).to.be.an("array");var c,h,l,u=n(this,"contains"),p=n(this,"ordered");u?(h="expected #{this} to be "+(c=p?"an ordered superset":"a superset")+" of #{exp}",l="expected #{this} to not be "+c+" of #{exp}"):(h="expected #{this} to have the same "+(c=p?"ordered members":"members")+" as #{exp}",l="expected #{this} to not have the same "+c+" as #{exp}");var d=n(this,"deep")?t.eql:void 0;this.assert(function(e,t,i,r,n){if(!r){if(e.length!==t.length)return!1;t=t.slice()}return e.every((function(e,s){if(n)return i?i(e,t[s]):e===t[s];if(!i){var o=t.indexOf(e);return-1!==o&&(r||t.splice(o,1),!0)}return t.some((function(n,s){return!!i(e,n)&&(r||t.splice(s,1),!0)}))}))}(e,s,d,u,p),h,l,e,s,!0)})),i.addMethod("oneOf",(function(e,t){t&&n(this,"message",t);var r=n(this,"object"),s=n(this,"message"),o=n(this,"ssfi"),a=n(this,"contains");new i(e,s,o,!0).to.be.an("array"),a?this.assert(e.some((function(e){return r.indexOf(e)>-1})),"expected #{this} to contain one of #{exp}","expected #{this} to not contain one of #{exp}",e,r):this.assert(e.indexOf(r)>-1,"expected #{this} to be one of #{exp}","expected #{this} to not be one of #{exp}",e,r)})),i.addMethod("change",D),i.addMethod("changes",D),i.addMethod("increase",I),i.addMethod("increases",I),i.addMethod("decrease",O),i.addMethod("decreases",O),i.addMethod("by",(function(e,t){t&&n(this,"message",t);var i,r=n(this,"deltaMsgObj"),s=n(this,"initialDeltaValue"),o=n(this,"finalDeltaValue"),a=n(this,"deltaBehavior"),c=n(this,"realDelta");i="change"===a?Math.abs(o-s)===Math.abs(e):c===Math.abs(e),this.assert(i,"expected "+r+" to "+a+" by "+e,"expected "+r+" to not "+a+" by "+e)})),i.addProperty("extensible",(function(){var e=n(this,"object"),t=e===Object(e)&&Object.isExtensible(e);this.assert(t,"expected #{this} to be extensible","expected #{this} to not be extensible")})),i.addProperty("sealed",(function(){var e=n(this,"object"),t=e!==Object(e)||Object.isSealed(e);this.assert(t,"expected #{this} to be sealed","expected #{this} to not be sealed")})),i.addProperty("frozen",(function(){var e=n(this,"object"),t=e!==Object(e)||Object.isFrozen(e);this.assert(t,"expected #{this} to be frozen","expected #{this} to not be frozen")})),i.addProperty("finite",(function(e){var t=n(this,"object");this.assert("number"==typeof t&&isFinite(t),"expected #{this} to be a finite number","expected #{this} to not be a finite number")}))}},"./node_modules/chai/lib/chai/interface/assert.js":e=>{e.exports=function(e,t){var i=e.Assertion,r=t.flag,n=e.assert=function(t,r){new i(null,null,e.assert,!0).assert(t,r,"[ negation message unavailable ]")};n.fail=function(t,i,r,s){throw arguments.length<2&&(r=t,t=void 0),r=r||"assert.fail()",new e.AssertionError(r,{actual:t,expected:i,operator:s},n.fail)},n.isOk=function(e,t){new i(e,t,n.isOk,!0).is.ok},n.isNotOk=function(e,t){new i(e,t,n.isNotOk,!0).is.not.ok},n.equal=function(e,t,s){var o=new i(e,s,n.equal,!0);o.assert(t==r(o,"object"),"expected #{this} to equal #{exp}","expected #{this} to not equal #{act}",t,e,!0)},n.notEqual=function(e,t,s){var o=new i(e,s,n.notEqual,!0);o.assert(t!=r(o,"object"),"expected #{this} to not equal #{exp}","expected #{this} to equal #{act}",t,e,!0)},n.strictEqual=function(e,t,r){new i(e,r,n.strictEqual,!0).to.equal(t)},n.notStrictEqual=function(e,t,r){new i(e,r,n.notStrictEqual,!0).to.not.equal(t)},n.deepEqual=n.deepStrictEqual=function(e,t,r){new i(e,r,n.deepEqual,!0).to.eql(t)},n.notDeepEqual=function(e,t,r){new i(e,r,n.notDeepEqual,!0).to.not.eql(t)},n.isAbove=function(e,t,r){new i(e,r,n.isAbove,!0).to.be.above(t)},n.isAtLeast=function(e,t,r){new i(e,r,n.isAtLeast,!0).to.be.least(t)},n.isBelow=function(e,t,r){new i(e,r,n.isBelow,!0).to.be.below(t)},n.isAtMost=function(e,t,r){new i(e,r,n.isAtMost,!0).to.be.most(t)},n.isTrue=function(e,t){new i(e,t,n.isTrue,!0).is.true},n.isNotTrue=function(e,t){new i(e,t,n.isNotTrue,!0).to.not.equal(!0)},n.isFalse=function(e,t){new i(e,t,n.isFalse,!0).is.false},n.isNotFalse=function(e,t){new i(e,t,n.isNotFalse,!0).to.not.equal(!1)},n.isNull=function(e,t){new i(e,t,n.isNull,!0).to.equal(null)},n.isNotNull=function(e,t){new i(e,t,n.isNotNull,!0).to.not.equal(null)},n.isNaN=function(e,t){new i(e,t,n.isNaN,!0).to.be.NaN},n.isNotNaN=function(e,t){new i(e,t,n.isNotNaN,!0).not.to.be.NaN},n.exists=function(e,t){new i(e,t,n.exists,!0).to.exist},n.notExists=function(e,t){new i(e,t,n.notExists,!0).to.not.exist},n.isUndefined=function(e,t){new i(e,t,n.isUndefined,!0).to.equal(void 0)},n.isDefined=function(e,t){new i(e,t,n.isDefined,!0).to.not.equal(void 0)},n.isFunction=function(e,t){new i(e,t,n.isFunction,!0).to.be.a("function")},n.isNotFunction=function(e,t){new i(e,t,n.isNotFunction,!0).to.not.be.a("function")},n.isObject=function(e,t){new i(e,t,n.isObject,!0).to.be.a("object")},n.isNotObject=function(e,t){new i(e,t,n.isNotObject,!0).to.not.be.a("object")},n.isArray=function(e,t){new i(e,t,n.isArray,!0).to.be.an("array")},n.isNotArray=function(e,t){new i(e,t,n.isNotArray,!0).to.not.be.an("array")},n.isString=function(e,t){new i(e,t,n.isString,!0).to.be.a("string")},n.isNotString=function(e,t){new i(e,t,n.isNotString,!0).to.not.be.a("string")},n.isNumber=function(e,t){new i(e,t,n.isNumber,!0).to.be.a("number")},n.isNotNumber=function(e,t){new i(e,t,n.isNotNumber,!0).to.not.be.a("number")},n.isFinite=function(e,t){new i(e,t,n.isFinite,!0).to.be.finite},n.isBoolean=function(e,t){new i(e,t,n.isBoolean,!0).to.be.a("boolean")},n.isNotBoolean=function(e,t){new i(e,t,n.isNotBoolean,!0).to.not.be.a("boolean")},n.typeOf=function(e,t,r){new i(e,r,n.typeOf,!0).to.be.a(t)},n.notTypeOf=function(e,t,r){new i(e,r,n.notTypeOf,!0).to.not.be.a(t)},n.instanceOf=function(e,t,r){new i(e,r,n.instanceOf,!0).to.be.instanceOf(t)},n.notInstanceOf=function(e,t,r){new i(e,r,n.notInstanceOf,!0).to.not.be.instanceOf(t)},n.include=function(e,t,r){new i(e,r,n.include,!0).include(t)},n.notInclude=function(e,t,r){new i(e,r,n.notInclude,!0).not.include(t)},n.deepInclude=function(e,t,r){new i(e,r,n.deepInclude,!0).deep.include(t)},n.notDeepInclude=function(e,t,r){new i(e,r,n.notDeepInclude,!0).not.deep.include(t)},n.nestedInclude=function(e,t,r){new i(e,r,n.nestedInclude,!0).nested.include(t)},n.notNestedInclude=function(e,t,r){new i(e,r,n.notNestedInclude,!0).not.nested.include(t)},n.deepNestedInclude=function(e,t,r){new i(e,r,n.deepNestedInclude,!0).deep.nested.include(t)},n.notDeepNestedInclude=function(e,t,r){new i(e,r,n.notDeepNestedInclude,!0).not.deep.nested.include(t)},n.ownInclude=function(e,t,r){new i(e,r,n.ownInclude,!0).own.include(t)},n.notOwnInclude=function(e,t,r){new i(e,r,n.notOwnInclude,!0).not.own.include(t)},n.deepOwnInclude=function(e,t,r){new i(e,r,n.deepOwnInclude,!0).deep.own.include(t)},n.notDeepOwnInclude=function(e,t,r){new i(e,r,n.notDeepOwnInclude,!0).not.deep.own.include(t)},n.match=function(e,t,r){new i(e,r,n.match,!0).to.match(t)},n.notMatch=function(e,t,r){new i(e,r,n.notMatch,!0).to.not.match(t)},n.property=function(e,t,r){new i(e,r,n.property,!0).to.have.property(t)},n.notProperty=function(e,t,r){new i(e,r,n.notProperty,!0).to.not.have.property(t)},n.propertyVal=function(e,t,r,s){new i(e,s,n.propertyVal,!0).to.have.property(t,r)},n.notPropertyVal=function(e,t,r,s){new i(e,s,n.notPropertyVal,!0).to.not.have.property(t,r)},n.deepPropertyVal=function(e,t,r,s){new i(e,s,n.deepPropertyVal,!0).to.have.deep.property(t,r)},n.notDeepPropertyVal=function(e,t,r,s){new i(e,s,n.notDeepPropertyVal,!0).to.not.have.deep.property(t,r)},n.ownProperty=function(e,t,r){new i(e,r,n.ownProperty,!0).to.have.own.property(t)},n.notOwnProperty=function(e,t,r){new i(e,r,n.notOwnProperty,!0).to.not.have.own.property(t)},n.ownPropertyVal=function(e,t,r,s){new i(e,s,n.ownPropertyVal,!0).to.have.own.property(t,r)},n.notOwnPropertyVal=function(e,t,r,s){new i(e,s,n.notOwnPropertyVal,!0).to.not.have.own.property(t,r)},n.deepOwnPropertyVal=function(e,t,r,s){new i(e,s,n.deepOwnPropertyVal,!0).to.have.deep.own.property(t,r)},n.notDeepOwnPropertyVal=function(e,t,r,s){new i(e,s,n.notDeepOwnPropertyVal,!0).to.not.have.deep.own.property(t,r)},n.nestedProperty=function(e,t,r){new i(e,r,n.nestedProperty,!0).to.have.nested.property(t)},n.notNestedProperty=function(e,t,r){new i(e,r,n.notNestedProperty,!0).to.not.have.nested.property(t)},n.nestedPropertyVal=function(e,t,r,s){new i(e,s,n.nestedPropertyVal,!0).to.have.nested.property(t,r)},n.notNestedPropertyVal=function(e,t,r,s){new i(e,s,n.notNestedPropertyVal,!0).to.not.have.nested.property(t,r)},n.deepNestedPropertyVal=function(e,t,r,s){new i(e,s,n.deepNestedPropertyVal,!0).to.have.deep.nested.property(t,r)},n.notDeepNestedPropertyVal=function(e,t,r,s){new i(e,s,n.notDeepNestedPropertyVal,!0).to.not.have.deep.nested.property(t,r)},n.lengthOf=function(e,t,r){new i(e,r,n.lengthOf,!0).to.have.lengthOf(t)},n.hasAnyKeys=function(e,t,r){new i(e,r,n.hasAnyKeys,!0).to.have.any.keys(t)},n.hasAllKeys=function(e,t,r){new i(e,r,n.hasAllKeys,!0).to.have.all.keys(t)},n.containsAllKeys=function(e,t,r){new i(e,r,n.containsAllKeys,!0).to.contain.all.keys(t)},n.doesNotHaveAnyKeys=function(e,t,r){new i(e,r,n.doesNotHaveAnyKeys,!0).to.not.have.any.keys(t)},n.doesNotHaveAllKeys=function(e,t,r){new i(e,r,n.doesNotHaveAllKeys,!0).to.not.have.all.keys(t)},n.hasAnyDeepKeys=function(e,t,r){new i(e,r,n.hasAnyDeepKeys,!0).to.have.any.deep.keys(t)},n.hasAllDeepKeys=function(e,t,r){new i(e,r,n.hasAllDeepKeys,!0).to.have.all.deep.keys(t)},n.containsAllDeepKeys=function(e,t,r){new i(e,r,n.containsAllDeepKeys,!0).to.contain.all.deep.keys(t)},n.doesNotHaveAnyDeepKeys=function(e,t,r){new i(e,r,n.doesNotHaveAnyDeepKeys,!0).to.not.have.any.deep.keys(t)},n.doesNotHaveAllDeepKeys=function(e,t,r){new i(e,r,n.doesNotHaveAllDeepKeys,!0).to.not.have.all.deep.keys(t)},n.throws=function(e,t,s,o){("string"==typeof t||t instanceof RegExp)&&(s=t,t=null);var a=new i(e,o,n.throws,!0).to.throw(t,s);return r(a,"object")},n.doesNotThrow=function(e,t,r,s){("string"==typeof t||t instanceof RegExp)&&(r=t,t=null),new i(e,s,n.doesNotThrow,!0).to.not.throw(t,r)},n.operator=function(s,o,a,c){var h;switch(o){case"==":h=s==a;break;case"===":h=s===a;break;case">":h=s>a;break;case">=":h=s>=a;break;case"<":h=s<a;break;case"<=":h=s<=a;break;case"!=":h=s!=a;break;case"!==":h=s!==a;break;default:throw c=c?c+": ":c,new e.AssertionError(c+'Invalid operator "'+o+'"',void 0,n.operator)}var l=new i(h,c,n.operator,!0);l.assert(!0===r(l,"object"),"expected "+t.inspect(s)+" to be "+o+" "+t.inspect(a),"expected "+t.inspect(s)+" to not be "+o+" "+t.inspect(a))},n.closeTo=function(e,t,r,s){new i(e,s,n.closeTo,!0).to.be.closeTo(t,r)},n.approximately=function(e,t,r,s){new i(e,s,n.approximately,!0).to.be.approximately(t,r)},n.sameMembers=function(e,t,r){new i(e,r,n.sameMembers,!0).to.have.same.members(t)},n.notSameMembers=function(e,t,r){new i(e,r,n.notSameMembers,!0).to.not.have.same.members(t)},n.sameDeepMembers=function(e,t,r){new i(e,r,n.sameDeepMembers,!0).to.have.same.deep.members(t)},n.notSameDeepMembers=function(e,t,r){new i(e,r,n.notSameDeepMembers,!0).to.not.have.same.deep.members(t)},n.sameOrderedMembers=function(e,t,r){new i(e,r,n.sameOrderedMembers,!0).to.have.same.ordered.members(t)},n.notSameOrderedMembers=function(e,t,r){new i(e,r,n.notSameOrderedMembers,!0).to.not.have.same.ordered.members(t)},n.sameDeepOrderedMembers=function(e,t,r){new i(e,r,n.sameDeepOrderedMembers,!0).to.have.same.deep.ordered.members(t)},n.notSameDeepOrderedMembers=function(e,t,r){new i(e,r,n.notSameDeepOrderedMembers,!0).to.not.have.same.deep.ordered.members(t)},n.includeMembers=function(e,t,r){new i(e,r,n.includeMembers,!0).to.include.members(t)},n.notIncludeMembers=function(e,t,r){new i(e,r,n.notIncludeMembers,!0).to.not.include.members(t)},n.includeDeepMembers=function(e,t,r){new i(e,r,n.includeDeepMembers,!0).to.include.deep.members(t)},n.notIncludeDeepMembers=function(e,t,r){new i(e,r,n.notIncludeDeepMembers,!0).to.not.include.deep.members(t)},n.includeOrderedMembers=function(e,t,r){new i(e,r,n.includeOrderedMembers,!0).to.include.ordered.members(t)},n.notIncludeOrderedMembers=function(e,t,r){new i(e,r,n.notIncludeOrderedMembers,!0).to.not.include.ordered.members(t)},n.includeDeepOrderedMembers=function(e,t,r){new i(e,r,n.includeDeepOrderedMembers,!0).to.include.deep.ordered.members(t)},n.notIncludeDeepOrderedMembers=function(e,t,r){new i(e,r,n.notIncludeDeepOrderedMembers,!0).to.not.include.deep.ordered.members(t)},n.oneOf=function(e,t,r){new i(e,r,n.oneOf,!0).to.be.oneOf(t)},n.changes=function(e,t,r,s){3===arguments.length&&"function"==typeof t&&(s=r,r=null),new i(e,s,n.changes,!0).to.change(t,r)},n.changesBy=function(e,t,r,s,o){if(4===arguments.length&&"function"==typeof t){var a=s;s=r,o=a}else 3===arguments.length&&(s=r,r=null);new i(e,o,n.changesBy,!0).to.change(t,r).by(s)},n.doesNotChange=function(e,t,r,s){return 3===arguments.length&&"function"==typeof t&&(s=r,r=null),new i(e,s,n.doesNotChange,!0).to.not.change(t,r)},n.changesButNotBy=function(e,t,r,s,o){if(4===arguments.length&&"function"==typeof t){var a=s;s=r,o=a}else 3===arguments.length&&(s=r,r=null);new i(e,o,n.changesButNotBy,!0).to.change(t,r).but.not.by(s)},n.increases=function(e,t,r,s){return 3===arguments.length&&"function"==typeof t&&(s=r,r=null),new i(e,s,n.increases,!0).to.increase(t,r)},n.increasesBy=function(e,t,r,s,o){if(4===arguments.length&&"function"==typeof t){var a=s;s=r,o=a}else 3===arguments.length&&(s=r,r=null);new i(e,o,n.increasesBy,!0).to.increase(t,r).by(s)},n.doesNotIncrease=function(e,t,r,s){return 3===arguments.length&&"function"==typeof t&&(s=r,r=null),new i(e,s,n.doesNotIncrease,!0).to.not.increase(t,r)},n.increasesButNotBy=function(e,t,r,s,o){if(4===arguments.length&&"function"==typeof t){var a=s;s=r,o=a}else 3===arguments.length&&(s=r,r=null);new i(e,o,n.increasesButNotBy,!0).to.increase(t,r).but.not.by(s)},n.decreases=function(e,t,r,s){return 3===arguments.length&&"function"==typeof t&&(s=r,r=null),new i(e,s,n.decreases,!0).to.decrease(t,r)},n.decreasesBy=function(e,t,r,s,o){if(4===arguments.length&&"function"==typeof t){var a=s;s=r,o=a}else 3===arguments.length&&(s=r,r=null);new i(e,o,n.decreasesBy,!0).to.decrease(t,r).by(s)},n.doesNotDecrease=function(e,t,r,s){return 3===arguments.length&&"function"==typeof t&&(s=r,r=null),new i(e,s,n.doesNotDecrease,!0).to.not.decrease(t,r)},n.doesNotDecreaseBy=function(e,t,r,s,o){if(4===arguments.length&&"function"==typeof t){var a=s;s=r,o=a}else 3===arguments.length&&(s=r,r=null);return new i(e,o,n.doesNotDecreaseBy,!0).to.not.decrease(t,r).by(s)},n.decreasesButNotBy=function(e,t,r,s,o){if(4===arguments.length&&"function"==typeof t){var a=s;s=r,o=a}else 3===arguments.length&&(s=r,r=null);new i(e,o,n.decreasesButNotBy,!0).to.decrease(t,r).but.not.by(s)},n.ifError=function(e){if(e)throw e},n.isExtensible=function(e,t){new i(e,t,n.isExtensible,!0).to.be.extensible},n.isNotExtensible=function(e,t){new i(e,t,n.isNotExtensible,!0).to.not.be.extensible},n.isSealed=function(e,t){new i(e,t,n.isSealed,!0).to.be.sealed},n.isNotSealed=function(e,t){new i(e,t,n.isNotSealed,!0).to.not.be.sealed},n.isFrozen=function(e,t){new i(e,t,n.isFrozen,!0).to.be.frozen},n.isNotFrozen=function(e,t){new i(e,t,n.isNotFrozen,!0).to.not.be.frozen},n.isEmpty=function(e,t){new i(e,t,n.isEmpty,!0).to.be.empty},n.isNotEmpty=function(e,t){new i(e,t,n.isNotEmpty,!0).to.not.be.empty},function e(t,i){return n[i]=n[t],e}("isOk","ok")("isNotOk","notOk")("throws","throw")("throws","Throw")("isExtensible","extensible")("isNotExtensible","notExtensible")("isSealed","sealed")("isNotSealed","notSealed")("isFrozen","frozen")("isNotFrozen","notFrozen")("isEmpty","empty")("isNotEmpty","notEmpty")}},"./node_modules/chai/lib/chai/interface/expect.js":e=>{e.exports=function(e,t){e.expect=function(t,i){return new e.Assertion(t,i)},e.expect.fail=function(t,i,r,n){throw arguments.length<2&&(r=t,t=void 0),r=r||"expect.fail()",new e.AssertionError(r,{actual:t,expected:i,operator:n},e.expect.fail)}}},"./node_modules/chai/lib/chai/interface/should.js":e=>{e.exports=function(e,t){var i=e.Assertion;function r(){Object.defineProperty(Object.prototype,"should",{set:function(e){Object.defineProperty(this,"should",{value:e,enumerable:!0,configurable:!0,writable:!0})},get:function e(){return this instanceof String||this instanceof Number||this instanceof Boolean||"function"==typeof Symbol&&this instanceof Symbol||"function"==typeof BigInt&&this instanceof BigInt?new i(this.valueOf(),null,e):new i(this,null,e)},configurable:!0});var t={fail:function(i,r,n,s){throw arguments.length<2&&(n=i,i=void 0),n=n||"should.fail()",new e.AssertionError(n,{actual:i,expected:r,operator:s},t.fail)},equal:function(e,t,r){new i(e,r).to.equal(t)},Throw:function(e,t,r,n){new i(e,n).to.Throw(t,r)},exist:function(e,t){new i(e,t).to.exist},not:{}};return t.not.equal=function(e,t,r){new i(e,r).to.not.equal(t)},t.not.Throw=function(e,t,r,n){new i(e,n).to.not.Throw(t,r)},t.not.exist=function(e,t){new i(e,t).to.not.exist},t.throw=t.Throw,t.not.throw=t.not.Throw,t}e.should=r,e.Should=r}},"./node_modules/chai/lib/chai/utils/addChainableMethod.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/addLengthGuard.js"),n=i("./node_modules/chai/lib/chai.js"),s=i("./node_modules/chai/lib/chai/utils/flag.js"),o=i("./node_modules/chai/lib/chai/utils/proxify.js"),a=i("./node_modules/chai/lib/chai/utils/transferFlags.js"),c="function"==typeof Object.setPrototypeOf,h=function(){},l=Object.getOwnPropertyNames(h).filter((function(e){var t=Object.getOwnPropertyDescriptor(h,e);return"object"!=typeof t||!t.configurable})),u=Function.prototype.call,p=Function.prototype.apply;e.exports=function(e,t,i,h){"function"!=typeof h&&(h=function(){});var d={method:i,chainingBehavior:h};e.__methods||(e.__methods={}),e.__methods[t]=d,Object.defineProperty(e,t,{get:function(){d.chainingBehavior.call(this);var i=function(){s(this,"lockSsfi")||s(this,"ssfi",i);var e=d.method.apply(this,arguments);if(void 0!==e)return e;var t=new n.Assertion;return a(this,t),t};if(r(i,t,!0),c){var h=Object.create(this);h.call=u,h.apply=p,Object.setPrototypeOf(i,h)}else Object.getOwnPropertyNames(e).forEach((function(t){if(-1===l.indexOf(t)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r)}}));return a(this,i),o(i)},configurable:!0})}},"./node_modules/chai/lib/chai/utils/addLengthGuard.js":e=>{var t=Object.getOwnPropertyDescriptor((function(){}),"length");e.exports=function(e,i,r){return t.configurable?(Object.defineProperty(e,"length",{get:function(){if(r)throw Error("Invalid Chai property: "+i+'.length. Due to a compatibility issue, "length" cannot directly follow "'+i+'". Use "'+i+'.lengthOf" instead.');throw Error("Invalid Chai property: "+i+'.length. See docs for proper usage of "'+i+'".')}}),e):e}},"./node_modules/chai/lib/chai/utils/addMethod.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/addLengthGuard.js"),n=i("./node_modules/chai/lib/chai.js"),s=i("./node_modules/chai/lib/chai/utils/flag.js"),o=i("./node_modules/chai/lib/chai/utils/proxify.js"),a=i("./node_modules/chai/lib/chai/utils/transferFlags.js");e.exports=function(e,t,i){var c=function(){s(this,"lockSsfi")||s(this,"ssfi",c);var e=i.apply(this,arguments);if(void 0!==e)return e;var t=new n.Assertion;return a(this,t),t};r(c,t,!1),e[t]=o(c,t)}},"./node_modules/chai/lib/chai/utils/addProperty.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai.js"),n=i("./node_modules/chai/lib/chai/utils/flag.js"),s=i("./node_modules/chai/lib/chai/utils/isProxyEnabled.js"),o=i("./node_modules/chai/lib/chai/utils/transferFlags.js");e.exports=function(e,t,i){i=void 0===i?function(){}:i,Object.defineProperty(e,t,{get:function e(){s()||n(this,"lockSsfi")||n(this,"ssfi",e);var t=i.call(this);if(void 0!==t)return t;var a=new r.Assertion;return o(this,a),a},configurable:!0})}},"./node_modules/chai/lib/chai/utils/compareByInspect.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/inspect.js");e.exports=function(e,t){return r(e)<r(t)?-1:1}},"./node_modules/chai/lib/chai/utils/expectTypes.js":(e,t,i)=>{var r=i("./node_modules/assertion-error/index.js"),n=i("./node_modules/chai/lib/chai/utils/flag.js"),s=i("./node_modules/type-detect/type-detect.js");e.exports=function(e,t){var i=n(e,"message"),o=n(e,"ssfi");i=i?i+": ":"",e=n(e,"object"),(t=t.map((function(e){return e.toLowerCase()}))).sort();var a=t.map((function(e,i){var r=~["a","e","i","o","u"].indexOf(e.charAt(0))?"an":"a";return(t.length>1&&i===t.length-1?"or ":"")+r+" "+e})).join(", "),c=s(e).toLowerCase();if(!t.some((function(e){return c===e})))throw new r(i+"object tested must be "+a+", but "+c+" given",void 0,o)}},"./node_modules/chai/lib/chai/utils/flag.js":e=>{e.exports=function(e,t,i){var r=e.__flags||(e.__flags=Object.create(null));if(3!==arguments.length)return r[t];r[t]=i}},"./node_modules/chai/lib/chai/utils/getActual.js":e=>{e.exports=function(e,t){return t.length>4?t[4]:e._obj}},"./node_modules/chai/lib/chai/utils/getEnumerableProperties.js":e=>{e.exports=function(e){var t=[];for(var i in e)t.push(i);return t}},"./node_modules/chai/lib/chai/utils/getMessage.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/flag.js"),n=i("./node_modules/chai/lib/chai/utils/getActual.js"),s=i("./node_modules/chai/lib/chai/utils/objDisplay.js");e.exports=function(e,t){var i=r(e,"negate"),o=r(e,"object"),a=t[3],c=n(e,t),h=i?t[2]:t[1],l=r(e,"message");return"function"==typeof h&&(h=h()),h=(h=h||"").replace(/#\{this\}/g,(function(){return s(o)})).replace(/#\{act\}/g,(function(){return s(c)})).replace(/#\{exp\}/g,(function(){return s(a)})),l?l+": "+h:h}},"./node_modules/chai/lib/chai/utils/getOperator.js":(e,t,i)=>{var r=i("./node_modules/type-detect/type-detect.js"),n=i("./node_modules/chai/lib/chai/utils/flag.js");e.exports=function(e,t){var i=n(e,"operator"),s=n(e,"negate"),o=t[3],a=s?t[2]:t[1];if(i)return i;if("function"==typeof a&&(a=a()),(a=a||"")&&!/\shave\s/.test(a)){var c=function(e){var t=r(e);return-1!==["Array","Object","function"].indexOf(t)}(o);return/\snot\s/.test(a)?c?"notDeepStrictEqual":"notStrictEqual":c?"deepStrictEqual":"strictEqual"}}},"./node_modules/chai/lib/chai/utils/getOwnEnumerableProperties.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/getOwnEnumerablePropertySymbols.js");e.exports=function(e){return Object.keys(e).concat(r(e))}},"./node_modules/chai/lib/chai/utils/getOwnEnumerablePropertySymbols.js":e=>{e.exports=function(e){return"function"!=typeof Object.getOwnPropertySymbols?[]:Object.getOwnPropertySymbols(e).filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))}},"./node_modules/chai/lib/chai/utils/getProperties.js":e=>{e.exports=function(e){var t=Object.getOwnPropertyNames(e);function i(e){-1===t.indexOf(e)&&t.push(e)}for(var r=Object.getPrototypeOf(e);null!==r;)Object.getOwnPropertyNames(r).forEach(i),r=Object.getPrototypeOf(r);return t}},"./node_modules/chai/lib/chai/utils/index.js":(e,t,i)=>{var r=i("./node_modules/pathval/index.js");t.test=i("./node_modules/chai/lib/chai/utils/test.js"),t.type=i("./node_modules/type-detect/type-detect.js"),t.expectTypes=i("./node_modules/chai/lib/chai/utils/expectTypes.js"),t.getMessage=i("./node_modules/chai/lib/chai/utils/getMessage.js"),t.getActual=i("./node_modules/chai/lib/chai/utils/getActual.js"),t.inspect=i("./node_modules/chai/lib/chai/utils/inspect.js"),t.objDisplay=i("./node_modules/chai/lib/chai/utils/objDisplay.js"),t.flag=i("./node_modules/chai/lib/chai/utils/flag.js"),t.transferFlags=i("./node_modules/chai/lib/chai/utils/transferFlags.js"),t.eql=i("./node_modules/deep-eql/index.js"),t.getPathInfo=r.getPathInfo,t.hasProperty=r.hasProperty,t.getName=i("./node_modules/get-func-name/index.js"),t.addProperty=i("./node_modules/chai/lib/chai/utils/addProperty.js"),t.addMethod=i("./node_modules/chai/lib/chai/utils/addMethod.js"),t.overwriteProperty=i("./node_modules/chai/lib/chai/utils/overwriteProperty.js"),t.overwriteMethod=i("./node_modules/chai/lib/chai/utils/overwriteMethod.js"),t.addChainableMethod=i("./node_modules/chai/lib/chai/utils/addChainableMethod.js"),t.overwriteChainableMethod=i("./node_modules/chai/lib/chai/utils/overwriteChainableMethod.js"),t.compareByInspect=i("./node_modules/chai/lib/chai/utils/compareByInspect.js"),t.getOwnEnumerablePropertySymbols=i("./node_modules/chai/lib/chai/utils/getOwnEnumerablePropertySymbols.js"),t.getOwnEnumerableProperties=i("./node_modules/chai/lib/chai/utils/getOwnEnumerableProperties.js"),t.checkError=i("./node_modules/check-error/index.js"),t.proxify=i("./node_modules/chai/lib/chai/utils/proxify.js"),t.addLengthGuard=i("./node_modules/chai/lib/chai/utils/addLengthGuard.js"),t.isProxyEnabled=i("./node_modules/chai/lib/chai/utils/isProxyEnabled.js"),t.isNaN=i("./node_modules/chai/lib/chai/utils/isNaN.js"),t.getOperator=i("./node_modules/chai/lib/chai/utils/getOperator.js")},"./node_modules/chai/lib/chai/utils/inspect.js":(e,t,i)=>{var r=i("./node_modules/get-func-name/index.js"),n=i("./node_modules/chai/lib/chai/utils/getProperties.js"),s=i("./node_modules/chai/lib/chai/utils/getEnumerableProperties.js"),o=i("./node_modules/chai/lib/chai/config.js");function a(e,i,f){if(i&&"function"==typeof i.inspect&&i.inspect!==t.inspect&&(!i.constructor||i.constructor.prototype!==i)){var m=i.inspect(f,e);return"string"!=typeof m&&(m=a(e,m,f)),m}var g,y=function(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string");case"number":return 0===t&&1/t==-1/0?e.stylize("-0","number"):e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean");case"symbol":return e.stylize(t.toString(),"symbol")}if(null===t)return e.stylize("null","null")}(e,i);if(y)return y;if(g=i,"object"==typeof HTMLElement?g instanceof HTMLElement:g&&"object"==typeof g&&"nodeType"in g&&1===g.nodeType&&"string"==typeof g.nodeName){if("outerHTML"in i)return i.outerHTML;try{if(document.xmlVersion)return(new XMLSerializer).serializeToString(i);var v=document.createElementNS("http://www.w3.org/1999/xhtml","_");v.appendChild(i.cloneNode(!1));var b=v.innerHTML.replace("><",">"+i.innerHTML+"<");return v.innerHTML="",b}catch(e){}}var _,S,R=s(i),C=e.showHidden?n(i):R;if(0===C.length||p(i)&&(1===C.length&&"stack"===C[0]||2===C.length&&"description"===C[0]&&"stack"===C[1])){if("function"==typeof i)return S=(_=r(i))?": "+_:"",e.stylize("[Function"+S+"]","special");if(l(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(u(i))return e.stylize(Date.prototype.toUTCString.call(i),"date");if(p(i))return c(i)}var w,T,E="",P=!1,D=!1,I=["{","}"];if("object"==typeof(w=i)&&/\w+Array]$/.test(d(w))&&(D=!0,I=["[","]"]),function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===d(e)}(i)&&(P=!0,I=["[","]"]),"function"==typeof i&&(E=" [Function"+(S=(_=r(i))?": "+_:"")+"]"),l(i)&&(E=" "+RegExp.prototype.toString.call(i)),u(i)&&(E=" "+Date.prototype.toUTCString.call(i)),p(i))return c(i);if(0===C.length&&(!P||0==i.length))return I[0]+E+I[1];if(f<0)return l(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special");if(e.seen.push(i),P)T=function(e,t,i,r,n){for(var s=[],o=0,a=t.length;o<a;++o)Object.prototype.hasOwnProperty.call(t,String(o))?s.push(h(e,t,i,r,String(o),!0)):s.push("");return n.forEach((function(n){n.match(/^\d+$/)||s.push(h(e,t,i,r,n,!0))})),s}(e,i,f,R,C);else{if(D)return function(e){for(var t="[ ",i=0;i<e.length;++i){if(t.length>=o.truncateThreshold-7){t+="...";break}t+=e[i]+", "}return-1!==(t+=" ]").indexOf(",  ]")&&(t=t.replace(",  ]"," ]")),t}(i);T=C.map((function(t){return h(e,i,f,R,t,P)}))}return e.seen.pop(),function(e,t,i){return e.reduce((function(e,t){return e+t.length+1}),0)>60?i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]:i[0]+t+" "+e.join(", ")+" "+i[1]}(T,E,I)}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,i,r,n,s){var o,c,h=Object.getOwnPropertyDescriptor(t,n);if(h&&(h.get?c=h.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):h.set&&(c=e.stylize("[Setter]","special"))),r.indexOf(n)<0&&(o="["+n+"]"),c||(e.seen.indexOf(t[n])<0?(c=a(e,t[n],null===i?null:i-1)).indexOf("\n")>-1&&(c=s?c.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+c.split("\n").map((function(e){return"   "+e})).join("\n")):c=e.stylize("[Circular]","special")),void 0===o){if(s&&n.match(/^\d+$/))return c;(o=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+c}function l(e){return"object"==typeof e&&"[object RegExp]"===d(e)}function u(e){return"object"==typeof e&&"[object Date]"===d(e)}function p(e){return"object"==typeof e&&"[object Error]"===d(e)}function d(e){return Object.prototype.toString.call(e)}e.exports=function(e,t,i,r){return a({showHidden:t,seen:[],stylize:function(e){return e}},e,void 0===i?2:i)}},"./node_modules/chai/lib/chai/utils/isNaN.js":e=>{e.exports=Number.isNaN||function(e){return e!=e}},"./node_modules/chai/lib/chai/utils/isProxyEnabled.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/config.js");e.exports=function(){return r.useProxy&&"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect}},"./node_modules/chai/lib/chai/utils/objDisplay.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/inspect.js"),n=i("./node_modules/chai/lib/chai/config.js");e.exports=function(e){var t=r(e),i=Object.prototype.toString.call(e);if(n.truncateThreshold&&t.length>=n.truncateThreshold){if("[object Function]"===i)return e.name&&""!==e.name?"[Function: "+e.name+"]":"[Function]";if("[object Array]"===i)return"[ Array("+e.length+") ]";if("[object Object]"===i){var s=Object.keys(e);return"{ Object ("+(s.length>2?s.splice(0,2).join(", ")+", ...":s.join(", "))+") }"}return t}return t}},"./node_modules/chai/lib/chai/utils/overwriteChainableMethod.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai.js"),n=i("./node_modules/chai/lib/chai/utils/transferFlags.js");e.exports=function(e,t,i,s){var o=e.__methods[t],a=o.chainingBehavior;o.chainingBehavior=function(){var e=s(a).call(this);if(void 0!==e)return e;var t=new r.Assertion;return n(this,t),t};var c=o.method;o.method=function(){var e=i(c).apply(this,arguments);if(void 0!==e)return e;var t=new r.Assertion;return n(this,t),t}}},"./node_modules/chai/lib/chai/utils/overwriteMethod.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/addLengthGuard.js"),n=i("./node_modules/chai/lib/chai.js"),s=i("./node_modules/chai/lib/chai/utils/flag.js"),o=i("./node_modules/chai/lib/chai/utils/proxify.js"),a=i("./node_modules/chai/lib/chai/utils/transferFlags.js");e.exports=function(e,t,i){var c=e[t],h=function(){throw new Error(t+" is not a function")};c&&"function"==typeof c&&(h=c);var l=function(){s(this,"lockSsfi")||s(this,"ssfi",l);var e=s(this,"lockSsfi");s(this,"lockSsfi",!0);var t=i(h).apply(this,arguments);if(s(this,"lockSsfi",e),void 0!==t)return t;var r=new n.Assertion;return a(this,r),r};r(l,t,!1),e[t]=o(l,t)}},"./node_modules/chai/lib/chai/utils/overwriteProperty.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai.js"),n=i("./node_modules/chai/lib/chai/utils/flag.js"),s=i("./node_modules/chai/lib/chai/utils/isProxyEnabled.js"),o=i("./node_modules/chai/lib/chai/utils/transferFlags.js");e.exports=function(e,t,i){var a=Object.getOwnPropertyDescriptor(e,t),c=function(){};a&&"function"==typeof a.get&&(c=a.get),Object.defineProperty(e,t,{get:function e(){s()||n(this,"lockSsfi")||n(this,"ssfi",e);var t=n(this,"lockSsfi");n(this,"lockSsfi",!0);var a=i(c).call(this);if(n(this,"lockSsfi",t),void 0!==a)return a;var h=new r.Assertion;return o(this,h),h},configurable:!0})}},"./node_modules/chai/lib/chai/utils/proxify.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/config.js"),n=i("./node_modules/chai/lib/chai/utils/flag.js"),s=i("./node_modules/chai/lib/chai/utils/getProperties.js"),o=i("./node_modules/chai/lib/chai/utils/isProxyEnabled.js"),a=["__flags","__methods","_obj","assert"];e.exports=function(e,t){return o()?new Proxy(e,{get:function e(i,o){if("string"==typeof o&&-1===r.proxyExcludedKeys.indexOf(o)&&!Reflect.has(i,o)){if(t)throw Error("Invalid Chai property: "+t+"."+o+'. See docs for proper usage of "'+t+'".');var c=null,h=4;throw s(i).forEach((function(e){if(!Object.prototype.hasOwnProperty(e)&&-1===a.indexOf(e)){var t=function(e,t,i){if(Math.abs(e.length-t.length)>=i)return i;for(var r=[],n=0;n<=e.length;n++)r[n]=Array(t.length+1).fill(0),r[n][0]=n;for(var s=0;s<t.length;s++)r[0][s]=s;for(n=1;n<=e.length;n++){var o=e.charCodeAt(n-1);for(s=1;s<=t.length;s++)Math.abs(n-s)>=i?r[n][s]=i:r[n][s]=Math.min(r[n-1][s]+1,r[n][s-1]+1,r[n-1][s-1]+(o===t.charCodeAt(s-1)?0:1))}return r[e.length][t.length]}(o,e,h);t<h&&(c=e,h=t)}})),null!==c?Error("Invalid Chai property: "+o+'. Did you mean "'+c+'"?'):Error("Invalid Chai property: "+o)}return-1!==a.indexOf(o)||n(i,"lockSsfi")||n(i,"ssfi",e),Reflect.get(i,o)}}):e}},"./node_modules/chai/lib/chai/utils/test.js":(e,t,i)=>{var r=i("./node_modules/chai/lib/chai/utils/flag.js");e.exports=function(e,t){var i=r(e,"negate"),n=t[0];return i?!n:n}},"./node_modules/chai/lib/chai/utils/transferFlags.js":e=>{e.exports=function(e,t,i){var r=e.__flags||(e.__flags=Object.create(null));for(var n in t.__flags||(t.__flags=Object.create(null)),i=3!==arguments.length||i,r)(i||"object"!==n&&"ssfi"!==n&&"lockSsfi"!==n&&"message"!=n)&&(t.__flags[n]=r[n])}},"./node_modules/check-error/index.js":e=>{"use strict";var t=/\s*function(?:\s|\s*\/\*[^(?:*\/)]+\*\/\s*)*([^\(\/]+)/;function i(e){var i="";if(void 0===e.name){var r=String(e).match(t);r&&(i=r[1])}else i=e.name;return i}e.exports={compatibleInstance:function(e,t){return t instanceof Error&&e===t},compatibleConstructor:function(e,t){return t instanceof Error?e.constructor===t.constructor||e instanceof t.constructor:(t.prototype instanceof Error||t===Error)&&(e.constructor===t||e instanceof t)},compatibleMessage:function(e,t){var i="string"==typeof e?e:e.message;return t instanceof RegExp?t.test(i):"string"==typeof t&&-1!==i.indexOf(t)},getMessage:function(e){var t="";return e&&e.message?t=e.message:"string"==typeof e&&(t=e),t},getConstructorName:function(e){var t=e;return e instanceof Error?t=i(e.constructor):"function"==typeof e&&(t=i(e).trim()||i(new e)),t}}},"./node_modules/decode-uri-component/index.js":e=>{"use strict";var t="%[a-f0-9]{2}",i=new RegExp(t,"gi"),r=new RegExp("("+t+")+","gi");function n(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var i=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],n(i),n(r))}function s(e){try{return decodeURIComponent(e)}catch(s){for(var t=e.match(i),r=1;r<t.length;r++)t=(e=n(t,r).join("")).match(i);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},i=r.exec(e);i;){try{t[i[0]]=decodeURIComponent(i[0])}catch(e){var n=s(i[0]);n!==i[0]&&(t[i[0]]=n)}i=r.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),a=0;a<o.length;a++){var c=o[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},"./node_modules/deep-eql/index.js":(e,t,i)=>{"use strict";var r=i("./node_modules/type-detect/type-detect.js");function n(){this._key="chai/deep-eql__"+Math.random()+Date.now()}n.prototype={get:function(e){return e[this._key]},set:function(e,t){Object.isExtensible(e)&&Object.defineProperty(e,this._key,{value:t,configurable:!0})}};var s="function"==typeof WeakMap?WeakMap:n;function o(e,t,i){if(!i||m(e)||m(t))return null;var r=i.get(e);if(r){var n=r.get(t);if("boolean"==typeof n)return n}return null}function a(e,t,i,r){if(i&&!m(e)&&!m(t)){var n=i.get(e);n?n.set(t,r):((n=new s).set(t,r),i.set(e,n))}}function c(e,t,i){if(i&&i.comparator)return l(e,t,i);var r=h(e,t);return null!==r?r:l(e,t,i)}function h(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t||!m(e)&&!m(t)&&null}function l(e,t,i){(i=i||{}).memoize=!1!==i.memoize&&(i.memoize||new s);var n=i&&i.comparator,l=o(e,t,i.memoize);if(null!==l)return l;var m=o(t,e,i.memoize);if(null!==m)return m;if(n){var g=n(e,t);if(!1===g||!0===g)return a(e,t,i.memoize,g),g;var y=h(e,t);if(null!==y)return y}var v=r(e);if(v!==r(t))return a(e,t,i.memoize,!1),!1;a(e,t,i.memoize,!0);var b=function(e,t,i,r){switch(i){case"String":case"Number":case"Boolean":case"Date":return c(e.valueOf(),t.valueOf());case"Promise":case"Symbol":case"function":case"WeakMap":case"WeakSet":case"Error":return e===t;case"Arguments":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"Array":return u(e,t,r);case"RegExp":return function(e,t){return e.toString()===t.toString()}(e,t);case"Generator":return function(e,t,i){return u(d(e),d(t),i)}(e,t,r);case"DataView":return u(new Uint8Array(e.buffer),new Uint8Array(t.buffer),r);case"ArrayBuffer":return u(new Uint8Array(e),new Uint8Array(t),r);case"Set":case"Map":return function(e,t,i){if(e.size!==t.size)return!1;if(0===e.size)return!0;var r=[],n=[];return e.forEach((function(e,t){r.push([e,t])})),t.forEach((function(e,t){n.push([e,t])})),u(r.sort(),n.sort(),i)}(e,t,r);default:return function(e,t,i){var r=f(e),n=f(t);if(r.length&&r.length===n.length)return r.sort(),n.sort(),!1!==u(r,n)&&function(e,t,i,r){var n=i.length;if(0===n)return!0;for(var s=0;s<n;s+=1)if(!1===c(e[i[s]],t[i[s]],r))return!1;return!0}(e,t,r,i);var s=p(e),o=p(t);return s.length&&s.length===o.length?(s.sort(),o.sort(),u(s,o,i)):0===r.length&&0===s.length&&0===n.length&&0===o.length}(e,t,r)}}(e,t,v,i);return a(e,t,i.memoize,b),b}function u(e,t,i){var r=e.length;if(r!==t.length)return!1;if(0===r)return!0;for(var n=-1;++n<r;)if(!1===c(e[n],t[n],i))return!1;return!0}function p(e){if(function(e){return"undefined"!=typeof Symbol&&"object"==typeof e&&void 0!==Symbol.iterator&&"function"==typeof e[Symbol.iterator]}(e))try{return d(e[Symbol.iterator]())}catch(e){return[]}return[]}function d(e){for(var t=e.next(),i=[t.value];!1===t.done;)t=e.next(),i.push(t.value);return i}function f(e){var t=[];for(var i in e)t.push(i);return t}function m(e){return null===e||"object"!=typeof e}e.exports=c,e.exports.MemoizeMap=s},"./node_modules/dijkstrajs/dijkstra.js":e=>{"use strict";var t={single_source_shortest_paths:function(e,i,r){var n={},s={};s[i]=0;var o,a,c,h,l,u,p,d=t.PriorityQueue.make();for(d.push(i,0);!d.empty();)for(c in a=(o=d.pop()).value,h=o.cost,l=e[a]||{})l.hasOwnProperty(c)&&(u=h+l[c],p=s[c],(void 0===s[c]||p>u)&&(s[c]=u,d.push(c,u),n[c]=a));if(void 0!==r&&void 0===s[r]){var f=["Could not find a path from ",i," to ",r,"."].join("");throw new Error(f)}return n},extract_shortest_path_from_predecessor_list:function(e,t){for(var i=[],r=t;r;)i.push(r),e[r],r=e[r];return i.reverse(),i},find_path:function(e,i,r){var n=t.single_source_shortest_paths(e,i,r);return t.extract_shortest_path_from_predecessor_list(n,r)},PriorityQueue:{make:function(e){var i,r=t.PriorityQueue,n={};for(i in e=e||{},r)r.hasOwnProperty(i)&&(n[i]=r[i]);return n.queue=[],n.sorter=e.sorter||r.default_sorter,n},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var i={value:e,cost:t};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};e.exports=t},"./node_modules/encode-utf8/index.js":e=>{"use strict";e.exports=function(e){for(var t=[],i=e.length,r=0;r<i;r++){var n=e.charCodeAt(r);if(n>=55296&&n<=56319&&i>r+1){var s=e.charCodeAt(r+1);s>=56320&&s<=57343&&(n=1024*(n-55296)+s-56320+65536,r+=1)}n<128?t.push(n):n<2048?(t.push(n>>6|192),t.push(63&n|128)):n<55296||n>=57344&&n<65536?(t.push(n>>12|224),t.push(n>>6&63|128),t.push(63&n|128)):n>=65536&&n<=1114111?(t.push(n>>18|240),t.push(n>>12&63|128),t.push(n>>6&63|128),t.push(63&n|128)):t.push(239,191,189)}return new Uint8Array(t).buffer}},"./node_modules/filter-obj/index.js":e=>{"use strict";e.exports=function(e,t){for(var i={},r=Object.keys(e),n=Array.isArray(t),s=0;s<r.length;s++){var o=r[s],a=e[o];(n?-1!==t.indexOf(o):t(o,a,e))&&(i[o]=a)}return i}},"./node_modules/get-func-name/index.js":e=>{"use strict";var t=Function.prototype.toString,i=/\s*function(?:\s|\s*\/\*[^(?:*\/)]+\*\/\s*)*([^\s\(\/]+)/;e.exports=function(e){if("function"!=typeof e)return null;var r="";if(void 0===Function.prototype.name&&void 0===e.name){var n=t.call(e).match(i);n&&(r=n[1])}else r=e.name;return r}},"./node_modules/loglevel/lib/loglevel.js":function(e,t,i){var r,n;!function(s,o){"use strict";r=function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function n(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&i?s:void 0!==console[r]?n(console,r):void 0!==console.log?n(console,"log"):e)}function a(t,i){for(var n=0;n<r.length;n++){var s=r[n];this[s]=n<t?e:this.methodFactory(s,t,i)}this.log=this.debug}function c(e,i,r){return function(){typeof console!==t&&(a.call(this,i,r),this[e].apply(this,arguments))}}function h(e,t,i){return o(e)||c.apply(this,arguments)}function l(e,i,n){var s,o=this,c="loglevel";function l(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,r=i.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(i.slice(r))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=n||h,o.getLevel=function(){return s},o.setLevel=function(i,n){if("string"==typeof i&&void 0!==o.levels[i.toUpperCase()]&&(i=o.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(s=i,!1!==n&&function(e){var i=(r[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+i+";"}catch(e){}}}(i),a.call(o,i,e),typeof console===t&&i<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){l()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var u=l();null==u&&(u=null==i?"WARN":i),o.setLevel(u,!1)}var u=new l,p={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new l(e,u.getLevel(),u.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=d),u},u.getLoggers=function(){return p},u.default=u,u},void 0===(n=r.call(t,i,t,e))||(e.exports=n)}()},"./node_modules/pathval/index.js":e=>{"use strict";function t(e,t){return null!=e&&t in Object(e)}function i(e){return e.replace(/([^\\])\[/g,"$1.[").match(/(\\\.|[^.]+?)+/g).map((function(e){if("constructor"===e||"__proto__"===e||"prototype"===e)return{};var t=/^\[(\d+)\]$/.exec(e);return t?{i:parseFloat(t[1])}:{p:e.replace(/\\([.[\]])/g,"$1")}}))}function r(e,t,i){var r=e,n=null;i=void 0===i?t.length:i;for(var s=0;s<i;s++){var o=t[s];r&&(r=void 0===o.p?r[o.i]:r[o.p],s===i-1&&(n=r))}return n}function n(e,n){var s=i(n),o=s[s.length-1],a={parent:s.length>1?r(e,s,s.length-1):e,name:o.p||o.i,value:r(e,s)};return a.exists=t(a.parent,a.name),a}e.exports={hasProperty:t,getPathInfo:n,getPathValue:function(e,t){return n(e,t).value},setPathValue:function(e,t,r){return function(e,t,i){for(var r=e,n=i.length,s=null,o=0;o<n;o++){var a=null,c=null;if(s=i[o],o===n-1)r[a=void 0===s.p?s.i:s.p]=t;else if(void 0!==s.p&&r[s.p])r=r[s.p];else if(void 0!==s.i&&r[s.i])r=r[s.i];else{var h=i[o+1];a=void 0===s.p?s.i:s.p,c=void 0===h.p?[]:{},r[a]=c,r=r[a]}}}(e,r,i(t)),e}}},"./node_modules/peerjs/dist/peerjs.min.js":(e,t,i)=>{parcelRequire=function(t,r,n,s){var o,a="function"==typeof parcelRequire&&parcelRequire;function c(e,n){if(!r[e]){if(!t[e]){var s="function"==typeof parcelRequire&&parcelRequire;if(!n&&s)return s(e,!0);if(a)return a(e,!0);if("string"==typeof e)return i("./node_modules/peerjs/dist sync recursive")(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}l.resolve=function(i){return t[e][1][i]||i},l.cache={};var h=r[e]=new c.Module(e);t[e][0].call(h.exports,l,h,h.exports,this)}return r[e].exports;function l(e){return c(l.resolve(e))}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=r,c.parent=a,c.register=function(e,i){t[e]=[function(e,t){t.exports=i},{}]};for(var h=0;h<n.length;h++)try{c(n[h])}catch(t){o||(o=t)}if(n.length){var l=c(n[n.length-1]);e.exports=l}if(parcelRequire=c,o)throw o;return c}({EgBh:[function(e,t,i){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),t.exports.binaryFeatures=r;var n=t.exports.BlobBuilder;function s(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(n=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),s.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},s.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);r.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},s.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var e=new n,t=0,i=this._parts.length;t<i;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},t.exports.BufferBuilder=s},{}],kdPp:[function(e,t,i){var r=e("./bufferbuilder").BufferBuilder,n=e("./bufferbuilder").binaryFeatures,s={unpack:function(e){return new o(e).unpack()},pack:function(e){var t=new a;return t.pack(e),t.getBuffer()}};function o(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function a(){this.bufferBuilder=new r}function c(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}t.exports=s,o.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},o.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},o.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},o.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},o.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},o.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},o.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},o.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},o.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},o.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},o.prototype.unpack_string=function(e){for(var t,i,r=this.read(e),n=0,s="";n<e;)(t=r[n])<128?(s+=String.fromCharCode(t),n++):(192^t)<32?(i=(192^t)<<6|63&r[n+1],s+=String.fromCharCode(i),n+=2):(i=(15&t)<<12|(63&r[n+1])<<6|63&r[n+2],s+=String.fromCharCode(i),n+=3);return this.index+=e,s},o.prototype.unpack_array=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=this.unpack();return t},o.prototype.unpack_map=function(e){for(var t={},i=0;i<e;i++){var r=this.unpack(),n=this.unpack();t[r]=n}return t},o.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(0==e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,t-23)},o.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),i=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,i-20)+t*Math.pow(2,i-52))},o.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},a.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},a.prototype.pack=function(e){var t=typeof e;if("string"===t)this.pack_string(e);else if("number"===t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"===t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"===t)this.bufferBuilder.append(192);else{if("object"!==t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var i=e.constructor;if(i==Array)this.pack_array(e);else if(i==Blob||i==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(i==ArrayBuffer)n.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)n.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(i==Object||i.toString().startsWith("class"))this.pack_object(e);else if(i==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+i.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},a.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_string=function(e){var t=function(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,c).length}(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var i=0;i<t;i++)this.pack(e[i])},a.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(255&e);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},a.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var i=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,i)-1,n=Math.floor(r*Math.pow(2,52)),s=Math.pow(2,32),o=t<<31|i+1023<<20|n/s&1048575,a=n%s;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)},a.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var i in e)e.hasOwnProperty(i)&&(this.pack(i),this.pack(e[i]))},a.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},a.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},a.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),i=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)},a.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},a.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),i=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(e,t,i){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(i,"__esModule",{value:!0}),i.extractVersion=o,i.wrapPeerConnectionEvent=function(e,t,i){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return n.apply(this,arguments);var s=function(e){var t=i(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,s),n.apply(this,[e,s])};var s=r.removeEventListener;r.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(i))return s.apply(this,arguments);var r=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},i.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},i.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(s=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},i.log=function(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},i.deprecated=function(e,t){s&&console.warn(e+" is deprecated, please use "+t+" instead.")},i.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=o(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=o(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=o(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=o(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},i.compactObject=function e(t){return a(t)?Object.keys(t).reduce((function(i,r){var n=a(t[r]),s=n?e(t[r]):t[r],o=n&&!Object.keys(s).length;return void 0===s||o?i:Object.assign(i,function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},r,s))}),{}):t},i.walkStats=c,i.filterStats=function(e,t,i){var r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;var s=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((function(t){e.forEach((function(i){i.type===r&&i.trackId===t.id&&c(e,i,n)}))})),n};var n=!0,s=!0;function o(e,t,i){var r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?c(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach((function(t){c(e,e.get(t),i)}))})))}},{}],s6SN:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=function(e,t){var i=e&&e.navigator;if(i.mediaDevices){var r=function(e){if("object"!==s(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var r="object"===s(e[i])?e[i]:{ideal:e[i]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[n("min",i)]=r.ideal,t.optional.push(o),(o={})[n("max",i)]=r.ideal,t.optional.push(o)):(o[n("",i)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",i)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,i)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===s(e.audio)){var a=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"===s(e.video)){var c=e.video.facingMode;c=c&&("object"===s(c)?c:{ideal:c});var h,l=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||l)&&(delete e.video.facingMode,"environment"===c.exact||"environment"===c.ideal?h=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(h=["front"]),h))return i.mediaDevices.enumerateDevices().then((function(t){var i=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return h.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!i&&t.length&&h.includes("back")&&(i=t[t.length-1]),i&&(e.video.deviceId=c.exact?{exact:i.deviceId}:{ideal:i.deviceId}),e.video=r(e.video),o("chrome: "+JSON.stringify(e)),n(e)}));e.video=r(e.video)}return o("chrome: "+JSON.stringify(e)),n(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(e,t,r){n(e,(function(e){i.webkitGetUserMedia(e,t,(function(e){r&&r(a(e))}))}))}.bind(i),i.mediaDevices.getUserMedia){var c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(e){return n(e,(function(e){return c(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}}};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,t&&t.set(e,i),i}(e("../utils.js"));function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r.log},{"../utils.js":"iSxC"}],VHa8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then((function(t){var r=i.video&&i.video.width,n=i.video&&i.video.height,s=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},r&&(i.video.mandatory.maxWidth=r),n&&(i.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(i)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],uI5X:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},i.shimOnTrack=function(e){if("object"!==c(e)||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var n;n=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var s=new Event("track");s.track=r.track,s.receiver=n,s.transceiver={receiver:n},s.streams=[t.stream],i.dispatchEvent(s)})),t.stream.getTracks().forEach((function(r){var n;n=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var s=new Event("track");s.track=r,s.receiver=n,s.transceiver={receiver:n},s.streams=[t.stream],i.dispatchEvent(s)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},i.shimGetSendersWithDtmf=function(e){if("object"===c(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var n=i.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var i=this;this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((function(e){i._senders.push(t(i,e))}))};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach((function(e){var i=t._senders.find((function(t){return t.track===e}));i&&t._senders.splice(t._senders.indexOf(i),1)}))}}else if("object"===c(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},i.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,[i,r,n]=arguments;if(arguments.length>0&&"function"==typeof i)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof i))return t.apply(this,[]);var s=function(e){var t={};return e.result().forEach((function(e){var i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){i[t]=e.stat(t)})),t[i.id]=i})),t},o=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};return arguments.length>=2?t.apply(this,[function(e){r(o(s(e)))},i]):new Promise((function(i,r){t.apply(e,[function(e){i(o(s(e)))},r])})).then(r,n)}}},i.shimSenderReceiverGetStats=function(e){if("object"===c(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,i=t.apply(this,[]);return i.forEach((function(t){return t._pc=e})),i});var i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return r.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),r.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return r.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,i,r,n=arguments[0];return this.getSenders().forEach((function(e){e.track===n&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===n&&(i?r=!0:i=e),e.track===n})),r||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}}},i.shimAddTrackRemoveTrackWithNative=h,i.shimAddTrackRemoveTrack=function(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return h(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var i=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(i.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var s=this._streams[i.id];if(s)s.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var o=new e.MediaStream([t]);this._streams[i.id]=o,this._reverseStreams[o.id]=i,this.addStream(o)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var i=e.RTCPeerConnection.prototype[t],r=a({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?i.apply(this,[function(i){var r=c(e,i);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):i.apply(this,arguments).then((function(t){return c(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(e=this,i=(t=arguments[0]).sdp,Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],n=e._streams[r.id];i=i.replace(new RegExp(r.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:i})),s.apply(this,arguments)):s.apply(this,arguments);var e,t,i};var o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=o.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,i=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){i._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=i._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],n=e._streams[r.id];i=i.replace(new RegExp(n.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:i})}},i.shimPeerConnection=function(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var i=e.RTCPeerConnection.prototype[t],r=a({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}))},i.fixNegotiationNeeded=function(e,t){r.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e}))},Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}});var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(e("../utils.js")),n=e("./getusermedia"),s=e("./getdisplaymedia");function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(r)&&this._shimmedLocalStreams[i.id].push(r):this._shimmedLocalStreams[i.id]=[i,r],r};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();i.apply(this,arguments);var n=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(n)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(i){var r=t._shimmedLocalStreams[i].indexOf(e);-1!==r&&t._shimmedLocalStreams[i].splice(r,1),1===t._shimmedLocalStreams[i].length&&delete t._shimmedLocalStreams[i]})),n.apply(this,arguments)}}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.filterIceServers=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var n="string"==typeof t;return n&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!i?(i=!0,!0):t&&!i})),delete e.url,e.urls=n?t[0]:t,!!t.length}}))};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,t&&t.set(e,i),i}(e("../utils"));function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}},{"../utils":"iSxC"}],YHvh:[function(e,t,i){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":i.relatedAddress=t[r+1];break;case"rport":i.relatedPort=parseInt(t[r+1],10);break;case"tcptype":i.tcpType=t[r+1];break;case"ufrag":i.ufrag=t[r+1],i.usernameFragment=t[r+1];break;default:i[t[r]]=t[r+1]}return i},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,i={},r=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<r.length;n++)i[(t=r[n].trim().split("="))[0].trim()]=t[1];return i},r.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+i+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(i.attribute=e.substr(t+1,r-t-1),i.value=e.substr(r+1)):i.attribute=e.substr(t+1),i},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var i=r.matchPrefix(e+t,"a=ice-ufrag:")[0],n=r.matchPrefix(e+t,"a=ice-pwd:")[0];return i&&n?{usernameFragment:i.substr(12),password:n.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=r.splitLines(e)[0].split(" "),n=3;n<i.length;n++){var s=i[n],o=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var a=r.parseRtpMap(o),c=r.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=c.length?r.parseFmtp(c[0]):{},a.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){i+=r.writeRtpMap(e),i+=r.writeFmtp(e),i+=r.writeRtcpFb(e)}));var n=0;return t.codecs.forEach((function(e){e.maxptime>n&&(n=e.maxptime)})),n>0&&(i+="a=maxptime:"+n+"\r\n"),i+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){i+=r.writeExtmap(e)})),i},r.parseRtpEncodingParameters=function(e){var t,i=[],n=r.parseRtpParameters(e),s=-1!==n.fecMechanisms.indexOf("RED"),o=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,h=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));h.length>0&&h[0].length>1&&h[0][0]===c&&(t=h[0][1]),n.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),i.push(r),s&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(r))}})),0===i.length&&c&&i.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,i.forEach((function(e){e.maxBitrate=l}))),i},r.parseRtcpParameters=function(e){var t={},i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);var n=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;var s=r.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},r.parseMsid=function(e){var t,i=r.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substr(7).split(" "))[0],track:t[1]};var n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return n.length>0?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,i=r.parseMLine(e),n=r.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=parseInt(n[0].substr(19),10)),isNaN(t)&&(t=65536);var s=r.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:i.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var o=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,i){var n=void 0!==t?t:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,i,n){var s=r.writeRtpDescription(e.kind,t);if(s+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),s},r.getDirection=function(e,t){for(var i=r.splitLines(e),n=0;n<i.length;n++)switch(i[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[n].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=r)},{}],NJ2u:[function(e,t,i){"use strict";var r=e("sdp");function n(e,t,i,n,s){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":s||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(n?n.id:"-")+" "+a+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o}function s(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]},n=function(e,t,i,n){var s=r(e.parameters.apt,i),o=r(t.parameters.apt,n);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(r){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&o.parameters.apt&&!n(r,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(r.numChannels,o.numChannels),i.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var n=t.headerExtensions[r];if(e.uri===n.uri){i.headerExtensions.push(n);break}}})),i}function o(e,t,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(i)}function a(e,t){var i=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return i||e.addRemoteCandidate(t),!i}function c(e,t){var i=new Error(t);return i.name=e,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],i}t.exports=function(e,t){function i(t,i){i.addTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function h(t,i,r,n){var s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=n,e.setTimeout((function(){t._dispatchEvent("track",s)}))}var l=function(i){var n=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){n[e]=s[e].bind(s)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",i=JSON.parse(JSON.stringify(i||{})),this.usingBundle="max-bundle"===i.bundlePolicy,"negotiate"===i.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(i.rtcpMuxPolicy||(i.rtcpMuxPolicy="require"),i.iceTransportPolicy){case"all":case"relay":break;default:i.iceTransportPolicy="all"}switch(i.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:i.bundlePolicy="balanced"}if(i.iceServers=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof r;return n&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||i?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(i=!0,!0)})),delete e.url,e.urls=n?r[0]:r,!!r.length}}))}(i.iceServers||[],t),this._iceGatherers=[],i.iceCandidatePoolSize)for(var o=i.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:i.iceServers,gatherPolicy:i.iceTransportPolicy}));else i.iceCandidatePoolSize=0;this._config=i,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var i=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();r.iceTransport=n.iceTransport,r.dtlsTransport=n.dtlsTransport}return t||this.transceivers.push(r),r},l.prototype.addTrack=function(t,i){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(r=this.transceivers[n]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(i)&&this.localStreams.push(i),r.track=t,r.stream=i,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var i=this;if(t>=15025)e.getTracks().forEach((function(t){i.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var i=r.getTracks()[t];e.addEventListener("enabled",(function(e){i.enabled=e.enabled}))})),r.getTracks().forEach((function(e){i.addTrack(e,r)}))}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var i=this.transceivers.find((function(e){return e.rtpSender===t}));if(!i)throw c("InvalidAccessError","Sender was not created by this connection.");var r=i.stream;i.rtpSender.stop(),i.rtpSender=null,i.track=null,i.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var i=t.getSenders().find((function(t){return t.track===e}));i&&t.removeTrack(i)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},l.prototype._createIceGatherer=function(t,i){var r=this;if(i&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var n=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(n,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var i=!e.candidate||0===Object.keys(e.candidate).length;n.state=i?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},n.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),n},l.prototype._gather=function(t,i){var n=this,s=this.transceivers[i].iceGatherer;if(!s.onlocalcandidate){var o=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,s.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),s.onlocalcandidate=function(e){if(!(n.usingBundle&&i>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:i};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==s.state&&"gathering"!==s.state||(s.state="completed");else{"new"===s.state&&(s.state="gathering"),a.component=1,a.ufrag=s.getLocalParameters().usernameFragment;var h=r.writeCandidate(a);o.candidate=Object.assign(o.candidate,r.parseCandidate(h)),o.candidate.candidate=h,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var l=r.getMediaSections(n._localDescription.sdp);l[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",n._localDescription.sdp=r.getDescription(n._localDescription.sdp)+l.join("");var u=n.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),c||n._dispatchEvent("icecandidate",o),u&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){s.onlocalcandidate(e)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,i=new e.RTCIceTransport(null);i.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(i);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:i,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,i,n){var o=s(e.localCapabilities,e.remoteCapabilities);i&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),n&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},l.prototype.setLocalDescription=function(e){var t,i,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),i=t.shift(),t.forEach((function(e,t){var i=r.parseRtpParameters(e);n.transceivers[t].localCapabilities=i})),n.transceivers.forEach((function(e,t){n._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(n._remoteDescription.sdp),i=t.shift();var a=r.matchPrefix(i,"a=ice-lite").length>0;t.forEach((function(e,t){var o=n.transceivers[t],c=o.iceGatherer,h=o.iceTransport,l=o.dtlsTransport,u=o.localCapabilities,p=o.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length||o.rejected)){var d=r.getIceParameters(e,i),f=r.getDtlsParameters(e,i);a&&(f.role="server"),n.usingBundle&&0!==t||(n._gather(o.mid,t),"new"===h.state&&h.start(c,d,a?"controlling":"controlled"),"new"===l.state&&l.start(f));var m=s(u,p);n._transceive(o,m.codecs.length>0,!1)}}))}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(n){var l=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(c("TypeError",'Unsupported type "'+n.type+'"'));if(!o("setRemoteDescription",n.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+n.type+" in state "+l.signalingState));var u={};l.remoteStreams.forEach((function(e){u[e.id]=e}));var p=[],d=r.splitSections(n.sdp),f=d.shift(),m=r.matchPrefix(f,"a=ice-lite").length>0,g=r.matchPrefix(f,"a=group:BUNDLE ").length>0;l.usingBundle=g;var y=r.matchPrefix(f,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,d.forEach((function(o,c){var h=r.splitLines(o),d=r.getKind(o),y=r.isRejected(o)&&0===r.matchPrefix(o,"a=bundle-only").length,v=h[0].substr(2).split(" ")[2],b=r.getDirection(o,f),_=r.parseMsid(o),S=r.getMid(o)||r.generateIdentifier();if(y||"application"===d&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))l.transceivers[c]={mid:S,kind:d,protocol:v,rejected:!0};else{var R,C,w,T,E,P,D,I,O;!y&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(d,!0));var A,k,N=r.parseRtpParameters(o);y||(A=r.getIceParameters(o,f),(k=r.getDtlsParameters(o,f)).role="client"),D=r.parseRtpEncodingParameters(o);var M=r.parseRtcpParameters(o),x=r.matchPrefix(o,"a=end-of-candidates",f).length>0,j=r.matchPrefix(o,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===n.type||"answer"===n.type)&&!y&&g&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==n.type||y)"answer"!==n.type||y||(C=(R=l.transceivers[c]).iceGatherer,w=R.iceTransport,T=R.dtlsTransport,E=R.rtpReceiver,P=R.sendEncodingParameters,I=R.localCapabilities,l.transceivers[c].recvEncodingParameters=D,l.transceivers[c].remoteCapabilities=N,l.transceivers[c].rtcpParameters=M,j.length&&"new"===w.state&&(!m&&!x||g&&0!==c?j.forEach((function(e){a(R.iceTransport,e)})):w.setRemoteCandidates(j)),g&&0!==c||("new"===w.state&&w.start(C,A,"controlling"),"new"===T.state&&T.start(k)),!s(R.localCapabilities,R.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,l._transceive(R,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!E||"sendrecv"!==b&&"sendonly"!==b?delete R.rtpReceiver:(O=E.track,_?(u[_.stream]||(u[_.stream]=new e.MediaStream),i(O,u[_.stream]),p.push([O,E,u[_.stream]])):(u.default||(u.default=new e.MediaStream),i(O,u.default),p.push([O,E,u.default]))));else{(R=l.transceivers[c]||l._createTransceiver(d)).mid=S,R.iceGatherer||(R.iceGatherer=l._createIceGatherer(c,g)),j.length&&"new"===R.iceTransport.state&&(!x||g&&0!==c?j.forEach((function(e){a(R.iceTransport,e)})):R.iceTransport.setRemoteCandidates(j)),I=e.RTCRtpReceiver.getCapabilities(d),t<15019&&(I.codecs=I.codecs.filter((function(e){return"rtx"!==e.name}))),P=R.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var L,F=!1;"sendrecv"===b||"sendonly"===b?(F=!R.rtpReceiver,E=R.rtpReceiver||new e.RTCRtpReceiver(R.dtlsTransport,d),F&&(O=E.track,_&&"-"===_.stream||(_?(u[_.stream]||(u[_.stream]=new e.MediaStream,Object.defineProperty(u[_.stream],"id",{get:function(){return _.stream}})),Object.defineProperty(O,"id",{get:function(){return _.track}}),L=u[_.stream]):(u.default||(u.default=new e.MediaStream),L=u.default)),L&&(i(O,L),R.associatedRemoteMediaStreams.push(L)),p.push([O,E,L]))):R.rtpReceiver&&R.rtpReceiver.track&&(R.associatedRemoteMediaStreams.forEach((function(t){var i,r,n=t.getTracks().find((function(e){return e.id===R.rtpReceiver.track.id}));n&&(i=n,(r=t).removeTrack(i),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:i})))})),R.associatedRemoteMediaStreams=[]),R.localCapabilities=I,R.remoteCapabilities=N,R.rtpReceiver=E,R.rtcpParameters=M,R.sendEncodingParameters=P,R.recvEncodingParameters=D,l._transceive(l.transceivers[c],!1,F)}}})),void 0===l._dtlsRole&&(l._dtlsRole="offer"===n.type?"active":"passive"),l._remoteDescription={type:n.type,sdp:n.sdp},"offer"===n.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(u).forEach((function(t){var i=u[t];if(i.getTracks().length){if(-1===l.remoteStreams.indexOf(i)){l.remoteStreams.push(i);var r=new Event("addstream");r.stream=i,e.setTimeout((function(){l._dispatchEvent("addstream",r)}))}p.forEach((function(e){var t=e[0],r=e[1];i.id===e[2].id&&h(l,t,r,[i])}))}})),p.forEach((function(e){e[2]||h(l,e[0],e[1],[])})),e.setTimeout((function(){l&&l.transceivers&&l.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},l.prototype.createOffer=function(){var i=this;if(i._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var s=i.transceivers.filter((function(e){return"audio"===e.kind})).length,o=i.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(s=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(i.transceivers.forEach((function(e){"audio"===e.kind?--s<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));s>0||o>0;)s>0&&(i._createTransceiver("audio"),s--),o>0&&(i._createTransceiver("video"),o--);var h=r.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.transceivers.forEach((function(n,s){var o=n.track,a=n.kind,c=n.mid||r.generateIdentifier();n.mid=c,n.iceGatherer||(n.iceGatherer=i._createIceGatherer(s,i.usingBundle));var h=e.RTCRtpSender.getCapabilities(a);t<15019&&(h.codecs=h.codecs.filter((function(e){return"rtx"!==e.name}))),h.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),h.headerExtensions.forEach((function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=n.sendEncodingParameters||[{ssrc:1001*(2*s+1)}];o&&t>=15019&&"video"===a&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=h,n.sendEncodingParameters=l})),"max-compat"!==i._config.bundlePolicy&&(h+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),h+="a=ice-options:trickle\r\n",i.transceivers.forEach((function(e,t){h+=n(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),h+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,h+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(h+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:h});return Promise.resolve(l)},l.prototype.createAnswer=function(){var i=this;if(i._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var o=r.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.usingBundle&&(o+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var a=r.getMediaSections(i._remoteDescription.sdp).length;i.transceivers.forEach((function(e,r){if(!(r+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var h=s(e.localCapabilities,e.remoteCapabilities);!h.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=n(e,h,"answer",e.stream,i._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var h=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(h)},l.prototype.addIceCandidate=function(e){var t,i=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(n,s){if(!i._remoteDescription)return s(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var h=0;h<i.transceivers.length;h++)if(i.transceivers[h].mid===e.sdpMid){o=h;break}var l=i.transceivers[o];if(!l)return s(c("OperationError","Can not add ICE candidate"));if(l.rejected)return n();var u=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return n();if(u.component&&1!==u.component)return n();if((0===o||o>0&&l.iceTransport!==i.transceivers[0].iceTransport)&&!a(l.iceTransport,u))return s(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=r.getMediaSections(i._remoteDescription.sdp))[o]+="a="+(u.type?p:"end-of-candidates")+"\r\n",i._remoteDescription.sdp=r.getDescription(i._remoteDescription.sdp)+t.join("")}else for(var d=0;d<i.transceivers.length&&(i.transceivers[d].rejected||(i.transceivers[d].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(i._remoteDescription.sdp))[d]+="a=end-of-candidates\r\n",i._remoteDescription.sdp=r.getDescription(i._remoteDescription.sdp)+t.join(""),!i.usingBundle));d++);n()}))},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var i=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?i=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(i=e.rtpReceiver)})),!i)throw c("InvalidAccessError","Invalid selector.");return i.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var i=e[t];if(i&&i.prototype&&i.prototype.getStats){var r=i.prototype.getStats;i.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(i){e[i].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[i]),t.set(i,e[i])})),t}))}}}));var u=["createOffer","createAnswer"];return u.forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),l}},{sdp:"YHvh"}],YdKx:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=function(e){var t=e&&e.navigator,i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],P3bV:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],XRic:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimPeerConnection=function(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var i=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){i.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=(0,s.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,n.filterIceServers)(e.iceServers,t.version),r.log("ICE servers after filtering:",e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},i.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}});var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(e("../utils")),n=e("./filtericeservers"),s=function(e){return e&&e.__esModule?e:{default:e}}(e("rtcpeerconnection-shim")),o=e("./getusermedia"),a=e("./getdisplaymedia");function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=function(e,t){var i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){var o=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},a=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(e){return"object"===s(e)&&"object"===s(e.audio)&&(e=JSON.parse(JSON.stringify(e)),o(e.audio,"autoGainControl","mozAutoGainControl"),o(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},n&&n.prototype.getSettings){var c=n.prototype.getSettings;n.prototype.getSettings=function(){var e=c.apply(this,arguments);return o(e,"mozAutoGainControl","autoGainControl"),o(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var h=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===s(e)&&(e=JSON.parse(JSON.stringify(e)),o(e,"autoGainControl","mozAutoGainControl"),o(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,t&&t.set(e,i),i}(e("../utils"));function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{"../utils":"iSxC"}],UuGU:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}},{}],Fzdr:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimOnTrack=function(e){"object"===a(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},i.shimPeerConnection=function(e,t){if("object"===a(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var i=e.RTCPeerConnection.prototype[t],r=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var[e,n,s]=arguments;return r.apply(this,[e||null]).then((function(e){if(t.version<53&&!n)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(n,s)}}},i.shimSenderGetStats=function(e){if("object"===a(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,i=t.apply(this,[]);return i.forEach((function(t){return t._pc=e})),i});var i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},i.shimReceiverGetStats=function(e){if("object"===a(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,i=t.apply(this,[]);return i.forEach((function(t){return t._pc=e})),i}),r.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},i.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(i){i.track&&e.getTracks().includes(i.track)&&t.removeTrack(i)}))})},i.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},i.shimAddTransceiver=function(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],i=e&&"sendEncodings"in e;i&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(i){var{sender:n}=r,s=n.getParameters();"encodings"in s&&(1!==s.encodings.length||0!==Object.keys(s.encodings[0]).length)||(s.encodings=e.sendEncodings,n.sendEncodings=e.sendEncodings,this.setParametersPromises.push(n.setParameters(s).then((function(){delete n.sendEncodings})).catch((function(){delete n.sendEncodings}))))}return r})}},i.shimGetParameters=function(e){if("object"===a(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}},i.shimCreateOffer=function(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,i=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(i,e)})).finally((function(){i.setParametersPromises=[]})):t.apply(this,arguments)}}},i.shimCreateAnswer=function(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,i=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(i,e)})).finally((function(){i.setParametersPromises=[]})):t.apply(this,arguments)}}},Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}});var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(e("../utils")),n=e("./getusermedia"),s=e("./getdisplaymedia");function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimLocalStreamsAPI=function(e){if("object"===s(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var i=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(i,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(i,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var i=this,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return n&&n.forEach((function(e){i._localStreams?i._localStreams.includes(e)||i._localStreams.push(e):i._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var i=this._localStreams.indexOf(e);if(-1!==i){this._localStreams.splice(i,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}},i.shimRemoteStreamsAPI=function(e){if("object"===s(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var i=new Event("addstream");i.stream=e,t.dispatchEvent(i)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}}))}),t.apply(e,arguments)}}},i.shimCallbacksAPI=function(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n};var c=function(e,t,i){var r=n.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,i){var r=o.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,i){var r=a.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r},t.addIceCandidate=c}},i.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=function(e){return r(o(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,r){t.mediaDevices.getUserMedia(e).then(i,r)}.bind(t))},i.shimConstraints=o,i.shimRTCIceServerUrls=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){for(var n=[],s=0;s<e.iceServers.length;s++){var o=e.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[s])}e.iceServers=n}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}},i.shimTrackEventTransceiver=function(e){"object"===s(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},i.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var i=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveAudio||i||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}},i.shimAudioContext=function(e){"object"!==s(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=e[s]}return i.default=e,t&&t.set(e,i),i}(e("../utils"));function n(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return n=function(){return e},e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return e&&void 0!==e.video?Object.assign({},e,{video:r.compactObject(e.video)}):e}},{"../utils":"iSxC"}],GOQK:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&(!e.RTCIceCandidate||!("foundation"in e.RTCIceCandidate.prototype))){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===o(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var i=new t(e),n=r.default.parseCandidate(e.candidate),s=Object.assign(i,n);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,n.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},i.shimMaxMessageSize=function(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;var t=r.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=r.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){var n,s=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var i=parseInt(t[1],10);return i!=i?-1:i}(arguments[0]),o=(h=s,l=65536,"firefox"===t.browser&&(l=t.version<57?-1===h?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),l),a=function(e,i){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var s=r.default.matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?n=parseInt(s[0].substr(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n}(arguments[0],s);n=0===o&&0===a?Number.POSITIVE_INFINITY:0===o||0===a?Math.max(o,a):Math.min(o,a);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return n}}),this._sctp=c}var h,l;return i.apply(this,arguments)}}},i.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return i(e,this),e},n.wrapPeerConnectionEvent(e,"datachannel",(function(e){return i(e.channel,e.target),e}))}function i(e,t){var i=e.send;e.send=function(){var r=arguments[0],n=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}},i.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}}))}},i.removeExtmapAllowMixed=function(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return i.apply(this,arguments)}}},i.shimAddIceCandidateNullOrEmpty=function(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}};var r=function(e){return e&&e.__esModule?e:{default:e}}(e("sdp")),n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=r?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(e("./utils"));function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.adapterFactory=function(){var{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},i=r.log,h=r.detectBrowser(e),l={browserDetails:h,commonShim:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(h.browser){case"chrome":if(!n||!n.shimPeerConnection||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),l;if(null===h.version)return i("Chrome shim can not determine version, not shimming."),l;i("adapter.js shimming chrome."),l.browserShim=n,c.shimAddIceCandidateNullOrEmpty(e,h),n.shimGetUserMedia(e,h),n.shimMediaStream(e,h),n.shimPeerConnection(e,h),n.shimOnTrack(e,h),n.shimAddTrackRemoveTrack(e,h),n.shimGetSendersWithDtmf(e,h),n.shimGetStats(e,h),n.shimSenderReceiverGetStats(e,h),n.fixNegotiationNeeded(e,h),c.shimRTCIceCandidate(e,h),c.shimConnectionState(e,h),c.shimMaxMessageSize(e,h),c.shimSendThrowTypeError(e,h),c.removeExtmapAllowMixed(e,h);break;case"firefox":if(!o||!o.shimPeerConnection||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),l;i("adapter.js shimming firefox."),l.browserShim=o,c.shimAddIceCandidateNullOrEmpty(e,h),o.shimGetUserMedia(e,h),o.shimPeerConnection(e,h),o.shimOnTrack(e,h),o.shimRemoveStream(e,h),o.shimSenderGetStats(e,h),o.shimReceiverGetStats(e,h),o.shimRTCDataChannel(e,h),o.shimAddTransceiver(e,h),o.shimGetParameters(e,h),o.shimCreateOffer(e,h),o.shimCreateAnswer(e,h),c.shimRTCIceCandidate(e,h),c.shimConnectionState(e,h),c.shimMaxMessageSize(e,h),c.shimSendThrowTypeError(e,h);break;case"edge":if(!s||!s.shimPeerConnection||!t.shimEdge)return i("MS edge shim is not included in this adapter release."),l;i("adapter.js shimming edge."),l.browserShim=s,s.shimGetUserMedia(e,h),s.shimGetDisplayMedia(e,h),s.shimPeerConnection(e,h),s.shimReplaceTrack(e,h),c.shimMaxMessageSize(e,h),c.shimSendThrowTypeError(e,h);break;case"safari":if(!a||!t.shimSafari)return i("Safari shim is not included in this adapter release."),l;i("adapter.js shimming safari."),l.browserShim=a,c.shimAddIceCandidateNullOrEmpty(e,h),a.shimRTCIceServerUrls(e,h),a.shimCreateOfferLegacy(e,h),a.shimCallbacksAPI(e,h),a.shimLocalStreamsAPI(e,h),a.shimRemoteStreamsAPI(e,h),a.shimTrackEventTransceiver(e,h),a.shimGetUserMedia(e,h),a.shimAudioContext(e,h),c.shimRTCIceCandidate(e,h),c.shimMaxMessageSize(e,h),c.shimSendThrowTypeError(e,h),c.removeExtmapAllowMixed(e,h);break;default:i("Unsupported browser!")}return l};var r=l(e("./utils")),n=l(e("./chrome/chrome_shim")),s=l(e("./edge/edge_shim")),o=l(e("./firefox/firefox_shim")),a=l(e("./safari/safari_shim")),c=l(e("./common_shim"));function h(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return h=function(){return e},e}function l(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=h();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});i.default=r},{"./adapter_factory.js":"KtlG"}],sXtV:[function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.webRTCAdapter=void 0;var n=r(e("webrtc-adapter"));i.webRTCAdapter=n.default},{"webrtc-adapter":"tI1X"}],I31f:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Supports=void 0;var r=e("./adapter");i.Supports=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},e.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&!this.isIOS&&t>=this.minSafariVersion)},e.prototype.getBrowser=function(){return r.webRTCAdapter.browserDetails.browser},e.prototype.getVersion=function(){return r.webRTCAdapter.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var e,t=this.getBrowser(),i=r.webRTCAdapter.browserDetails.version||0;if("chrome"===t&&i<72)return!1;if("firefox"===t&&i>=59)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),n=!0}catch(e){}finally{e&&e.close()}return n},e.prototype.toString=function(){return"Supports: \n    browser:"+this.getBrowser()+" \n    version:"+this.getVersion()+" \n    isIOS:"+this.isIOS+" \n    isWebRTCSupported:"+this.isWebRTCSupported()+" \n    isBrowserSupported:"+this.isBrowserSupported()+" \n    isUnifiedPlanSupported:"+this.isUnifiedPlanSupported()},e}())},{"./adapter":"sXtV"}],BHXf:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t};Object.defineProperty(i,"__esModule",{value:!0}),i.util=void 0;var o=s(e("peerjs-js-binarypack")),a=e("./supports"),c={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};i.util=new(function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=c,this.browser=a.Supports.getBrowser(),this.browserVersion=a.Supports.getVersion(),this.supports=function(){var e,t={browser:a.Supports.isBrowserSupported(),webRTC:a.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{e=new RTCPeerConnection(c),t.audioVideo=!0;var i=void 0;try{i=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!a.Supports.isIOS}catch(e){}}catch(e){}finally{i&&i.close()}}catch(e){}finally{e&&e.close()}return t}(),this.pack=o.pack,this.unpack=o.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},e.prototype.chunk=function(e){for(var t=[],r=e.size,n=Math.ceil(r/i.util.chunkedMTU),s=0,o=0;o<r;){var a=Math.min(r,o+i.util.chunkedMTU),c=e.slice(o,a),h={__peerData:this._dataCount,n:s,data:c,total:n};t.push(h),o=a,s++}return this._dataCount++,t},e.prototype.blobToArrayBuffer=function(e,t){var i=new FileReader;return i.onload=function(e){e.target&&t(e.target.result)},i.readAsArrayBuffer(e),i},e.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},e.prototype.isSecure=function(){return"https:"===location.protocol},e}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(e,t,i){"use strict";var r=Object.prototype.hasOwnProperty,n="~";function s(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,i,r,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,r||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function h(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),h.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)r.call(e,t)&&i.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},h.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,o=new Array(s);r<s;r++)o[r]=i[r].fn;return o},h.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},h.prototype.emit=function(e,t,i,r,s,o){var a=n?n+e:e;if(!this._events[a])return!1;var c,h,l=this._events[a],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,r),!0;case 5:return l.fn.call(l.context,t,i,r,s),!0;case 6:return l.fn.call(l.context,t,i,r,s,o),!0}for(h=1,c=new Array(u-1);h<u;h++)c[h-1]=arguments[h];l.fn.apply(l.context,c)}else{var p,d=l.length;for(h=0;h<d;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),u){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,i);break;case 4:l[h].fn.call(l[h].context,t,i,r);break;default:if(!c)for(p=1,c=new Array(u-1);p<u;p++)c[p-1]=arguments[p];l[h].fn.apply(l[h].context,c)}}return!0},h.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},h.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},h.prototype.removeListener=function(e,t,i,r){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return c(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||c(this,s);else{for(var a=0,h=[],l=o.length;a<l;a++)(o[a].fn!==t||r&&!o[a].once||i&&o[a].context!==i)&&h.push(o[a]);h.length?this._events[s]=1===h.length?h[0]:h:c(this,s)}return this},h.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&c(this,t)):(this._events=new s,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=n,h.EventEmitter=h,void 0!==t&&(t.exports=h)},{}],WOs9:[function(e,t,i){"use strict";var r=this&&this.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},n=this&&this.__spreadArray||function(e,t){for(var i=0,r=t.length,n=e.length;i<r;i++,n++)e[n]=t[i];return e};Object.defineProperty(i,"__esModule",{value:!0}),i.LogLevel=void 0;var s,o="PeerJS: ";!function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"}(s=i.LogLevel||(i.LogLevel={}));var a=function(){function e(){this._logLevel=s.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=s.All&&this._print.apply(this,n([s.All],r(e)))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=s.Warnings&&this._print.apply(this,n([s.Warnings],r(e)))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=s.Errors&&this._print.apply(this,n([s.Errors],r(e)))},e.prototype.setLogFunction=function(e){this._print=e},e.prototype._print=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var a=n([o],r(t));for(var c in a)a[c]instanceof Error&&(a[c]="("+a[c].name+") "+a[c].message);e>=s.All?console.log.apply(console,n([],r(a))):e>=s.Warnings?console.warn.apply(console,n(["WARNING"],r(a))):e>=s.Errors&&console.error.apply(console,n(["ERROR"],r(a)))},e}();i.default=new a},{}],ZRYf:[function(e,t,i){"use strict";var r;Object.defineProperty(i,"__esModule",{value:!0}),i.ServerMessageType=i.SocketEventType=i.SerializationType=i.PeerErrorType=i.PeerEventType=i.ConnectionType=i.ConnectionEventType=void 0,(r=i.ConnectionEventType||(i.ConnectionEventType={})).Open="open",r.Stream="stream",r.Data="data",r.Close="close",r.Error="error",r.IceStateChanged="iceStateChanged",function(e){e.Data="data",e.Media="media"}(i.ConnectionType||(i.ConnectionType={})),function(e){e.Open="open",e.Close="close",e.Connection="connection",e.Call="call",e.Disconnected="disconnected",e.Error="error"}(i.PeerEventType||(i.PeerEventType={})),function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"}(i.PeerErrorType||(i.PeerErrorType={})),function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"}(i.SerializationType||(i.SerializationType={})),function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"}(i.SocketEventType||(i.SocketEventType={})),function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"}(i.ServerMessageType||(i.ServerMessageType={}))},{}],wJlv:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),n=this&&this.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},s=this&&this.__spreadArray||function(e,t){for(var i=0,r=t.length,n=e.length;i<r;i++,n++)e[n]=t[i];return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.Socket=void 0;var c=e("eventemitter3"),h=a(e("./logger")),l=e("./enums"),u=function(e){function t(t,i,r,n,s,o){void 0===o&&(o=5e3);var a=e.call(this)||this;a.pingInterval=o,a._disconnected=!0,a._messagesQueue=[];var c=t?"wss://":"ws://";return a._baseUrl=c+i+":"+r+n+"peerjs?key="+s,a}return r(t,e),t.prototype.start=function(e,t){var i=this;this._id=e;var r=this._baseUrl+"&id="+e+"&token="+t;!this._socket&&this._disconnected&&(this._socket=new WebSocket(r),this._disconnected=!1,this._socket.onmessage=function(e){var t;try{t=JSON.parse(e.data),h.default.log("Server message received:",t)}catch(t){return void h.default.log("Invalid server message",e.data)}i.emit(l.SocketEventType.Message,t)},this._socket.onclose=function(e){i._disconnected||(h.default.log("Socket closed.",e),i._cleanup(),i._disconnected=!0,i.emit(l.SocketEventType.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),h.default.log("Socket open"),i._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout((function(){e._sendHeartbeat()}),this.pingInterval)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:l.ServerMessageType.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else h.default.log("Cannot send heartbeat, because socket closed")},t.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},t.prototype._sendQueuedMessages=function(){var e,t,i=s([],n(this._messagesQueue));this._messagesQueue=[];try{for(var r=o(i),a=r.next();!a.done;a=r.next()){var c=a.value;this.send(c)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(l.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(e)},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(c.EventEmitter);i.Socket=u},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(e,t,i){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.Negotiator=void 0;var a=e("./util"),c=o(e("./logger")),h=e("./enums"),l=function(){function e(e){this.connection=e}return e.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===h.ConnectionType.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===h.ConnectionType.Data){var i=this.connection,r={ordered:!!e.reliable},n=t.createDataChannel(i.label,r);i.initialize(n)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},e.prototype._startPeerConnection=function(){c.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},e.prototype._setupListeners=function(e){var t=this,i=this.connection.peer,r=this.connection.connectionId,n=this.connection.type,s=this.connection.provider;c.default.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&(c.default.log("Received ICE candidates for "+i+":",e.candidate),s.socket.send({type:h.ServerMessageType.Candidate,payload:{candidate:e.candidate,type:n,connectionId:r},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":c.default.log("iceConnectionState is failed, closing connections to "+i),t.connection.emit(h.ConnectionEventType.Error,new Error("Negotiation of connection to "+i+" failed.")),t.connection.close();break;case"closed":c.default.log("iceConnectionState is closed, closing connections to "+i),t.connection.emit(h.ConnectionEventType.Error,new Error("Connection to "+i+" closed.")),t.connection.close();break;case"disconnected":c.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":e.onicecandidate=a.util.noop}t.connection.emit(h.ConnectionEventType.IceStateChanged,e.iceConnectionState)},c.default.log("Listening for data channel"),e.ondatachannel=function(e){c.default.log("Received data channel");var t=e.channel;s.getConnection(i,r).initialize(t)},c.default.log("Listening for remote stream"),e.ontrack=function(e){c.default.log("Received remote stream");var n=e.streams[0],o=s.getConnection(i,r);if(o.type===h.ConnectionType.Media){var a=o;t._addStreamToMediaConnection(n,a)}}},e.prototype.cleanup=function(){c.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t="closed"!==e.signalingState,i=!1;if(this.connection.type===h.ConnectionType.Data){var r=this.connection.dataChannel;r&&(i=!!r.readyState&&"closed"!==r.readyState)}(t||i)&&e.close()}},e.prototype._makeOffer=function(){return n(this,void 0,Promise,(function(){var e,t,i,n,o,l,u;return s(this,(function(s){switch(s.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:i=s.sent(),c.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return s.sent(),c.default.log("Set localDescription:",i,"for:"+this.connection.peer),n={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:a.util.browser},this.connection.type===h.ConnectionType.Data&&(o=this.connection,n=r(r({},n),{label:o.label,reliable:o.reliable,serialization:o.serialization})),t.socket.send({type:h.ServerMessageType.Offer,payload:n,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(l=s.sent())&&(t.emitError(h.PeerErrorType.WebRTC,l),c.default.log("Failed to setLocalDescription, ",l)),[3,6];case 6:return[3,8];case 7:return u=s.sent(),t.emitError(h.PeerErrorType.WebRTC,u),c.default.log("Failed to createOffer, ",u),[3,8];case 8:return[2]}}))}))},e.prototype._makeAnswer=function(){return n(this,void 0,Promise,(function(){var e,t,i,r,n;return s(this,(function(s){switch(s.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:i=s.sent(),c.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return s.sent(),c.default.log("Set localDescription:",i,"for:"+this.connection.peer),t.socket.send({type:h.ServerMessageType.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:a.util.browser},dst:this.connection.peer}),[3,6];case 5:return r=s.sent(),t.emitError(h.PeerErrorType.WebRTC,r),c.default.log("Failed to setLocalDescription, ",r),[3,6];case 6:return[3,8];case 7:return n=s.sent(),t.emitError(h.PeerErrorType.WebRTC,n),c.default.log("Failed to create answer, ",n),[3,8];case 8:return[2]}}))}))},e.prototype.handleSDP=function(e,t){return n(this,void 0,Promise,(function(){var i,r,n,o;return s(this,(function(s){switch(s.label){case 0:t=new RTCSessionDescription(t),i=this.connection.peerConnection,r=this.connection.provider,c.default.log("Setting remote description",t),n=this,s.label=1;case 1:return s.trys.push([1,5,,6]),[4,i.setRemoteDescription(t)];case 2:return s.sent(),c.default.log("Set remoteDescription:"+e+" for:"+this.connection.peer),"OFFER"!==e?[3,4]:[4,n._makeAnswer()];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:return o=s.sent(),r.emitError(h.PeerErrorType.WebRTC,o),c.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}}))}))},e.prototype.handleCandidate=function(e){return n(this,void 0,Promise,(function(){var t,i,r,n,o,a;return s(this,(function(s){switch(s.label){case 0:c.default.log("handleCandidate:",e),t=e.candidate,i=e.sdpMLineIndex,r=e.sdpMid,n=this.connection.peerConnection,o=this.connection.provider,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:i,candidate:t}))];case 2:return s.sent(),c.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return a=s.sent(),o.emitError(h.PeerErrorType.WebRTC,a),c.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}}))}))},e.prototype._addTracksToConnection=function(e,t){if(c.default.log("add tracks from stream "+e.id+" to peer connection"),!t.addTrack)return c.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach((function(i){t.addTrack(i,e)}))},e.prototype._addStreamToMediaConnection=function(e,t){c.default.log("add stream "+e.id+" to media connection "+t.connectionId),t.addStream(e)},e}();i.Negotiator=l},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0}),i.BaseConnection=void 0;var n=function(e){function t(t,i,r){var n=e.call(this)||this;return n.peer=t,n.provider=i,n.options=r,n._open=!1,n.metadata=r.metadata,n}return r(t,e),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(e("eventemitter3").EventEmitter);i.BaseConnection=n},{eventemitter3:"JJlS"}],dbHP:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.MediaConnection=void 0;var a=e("./util"),c=o(e("./logger")),h=e("./negotiator"),l=e("./enums"),u=function(e){function t(i,r,n){var s=e.call(this,i,r,n)||this;return s._localStream=s.options._stream,s.connectionId=s.options.connectionId||t.ID_PREFIX+a.util.randomToken(),s._negotiator=new h.Negotiator(s),s._localStream&&s._negotiator.startConnection({_stream:s._localStream,originator:!0}),s}return r(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return l.ConnectionType.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(t){c.default.log("Receiving stream",t),this._remoteStream=t,e.prototype.emit.call(this,l.ConnectionEventType.Stream,t)},t.prototype.handleMessage=function(e){var t=e.type,i=e.payload;switch(e.type){case l.ServerMessageType.Answer:this._negotiator.handleSDP(t,i.sdp),this._open=!0;break;case l.ServerMessageType.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:c.default.warn("Unrecognized message type:"+t+" from peer:"+this.peer)}},t.prototype.answer=function(e,t){var i,r;if(void 0===t&&(t={}),this._localStream)c.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(n(n({},this.options._payload),{_stream:e}));var o=this.provider._getMessages(this.connectionId);try{for(var a=s(o),h=a.next();!h.done;h=a.next()){var l=h.value;this.handleMessage(l)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}this._open=!0}},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,l.ConnectionEventType.Close))},t.ID_PREFIX="mc_",t}(e("./baseconnection").BaseConnection);i.MediaConnection=u},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.EncodingQueue=void 0;var s=e("eventemitter3"),o=n(e("./logger")),a=function(e){function t(){var t=e.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(e){t._processing=!1,e.target&&t.emit("done",e.target.result),t.doNextTask()},t.fileReader.onerror=function(e){o.default.error("EncodingQueue error:",e),t._processing=!1,t.destroy(),t.emit("error",e)},t}return r(t,e),Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),this.processing||this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(s.EventEmitter);i.EncodingQueue=a},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.DataConnection=void 0;var o=e("./util"),a=s(e("./logger")),c=e("./negotiator"),h=e("./enums"),l=e("./baseconnection"),u=e("./encodingQueue"),p=function(e){function t(i,r,n){var s=e.call(this,i,r,n)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new u.EncodingQueue,s.connectionId=s.options.connectionId||t.ID_PREFIX+o.util.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||h.SerializationType.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",(function(e){s._bufferedSend(e)})),s._encodingQueue.on("error",(function(){a.default.error("DC#"+s.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),s.close()})),s._negotiator=new c.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return r(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return h.ConnectionType.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;o.util.supports.binaryBlob&&!o.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){a.default.log("DC#"+e.connectionId+" dc connection success"),e._open=!0,e.emit(h.ConnectionEventType.Open)},this.dataChannel.onmessage=function(t){a.default.log("DC#"+e.connectionId+" dc onmessage:",t.data),e._handleDataMessage(t)},this.dataChannel.onclose=function(){a.default.log("DC#"+e.connectionId+" dc closed for:",e.peer),e.close()}},t.prototype._handleDataMessage=function(t){var i=this,r=t.data,n=r.constructor,s=r;if(this.serialization===h.SerializationType.Binary||this.serialization===h.SerializationType.BinaryUTF8){if(n===Blob)return void o.util.blobToArrayBuffer(r,(function(e){var t=o.util.unpack(e);i.emit(h.ConnectionEventType.Data,t)}));if(n===ArrayBuffer)s=o.util.unpack(r);else if(n===String){var a=o.util.binaryStringToArrayBuffer(r);s=o.util.unpack(a)}}else this.serialization===h.SerializationType.JSON&&(s=this.parse(r));s.__peerData?this._handleChunk(s):e.prototype.emit.call(this,h.ConnectionEventType.Data,s)},t.prototype._handleChunk=function(e){var t=e.__peerData,i=this._chunkedData[t]||{data:[],count:0,total:e.total};if(i.data[e.n]=e.data,i.count++,this._chunkedData[t]=i,i.total===i.count){delete this._chunkedData[t];var r=new Blob(i.data);this._handleDataMessage({data:r})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,h.ConnectionEventType.Close))},t.prototype.send=function(t,i){if(this.open)if(this.serialization===h.SerializationType.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===h.SerializationType.Binary||this.serialization===h.SerializationType.BinaryUTF8){var r=o.util.pack(t);if(!i&&r.size>o.util.chunkedMTU)return void this._sendChunks(r);o.util.supports.binaryBlob?this._bufferedSend(r):this._encodingQueue.enque(r)}else this._bufferedSend(t);else e.prototype.emit.call(this,h.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},t.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((function(){i._buffering=!1,i._tryBuffer()}),50),!1;try{this.dataChannel.send(e)}catch(e){return a.default.error("DC#:"+this.connectionId+" Error when sending:",e),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var t,i,r=o.util.chunk(e);a.default.log("DC#"+this.connectionId+" Try to send "+r.length+" chunks...");try{for(var s=n(r),c=s.next();!c.done;c=s.next()){var h=c.value;this.send(h,!0)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}},t.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case h.ServerMessageType.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case h.ServerMessageType.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:a.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(l.BaseConnection);i.DataConnection=p},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.API=void 0;var o=e("./util"),a=s(e("./logger")),c=function(){function e(e){this._options=e}return e.prototype._buildUrl=function(e){return(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+e+"?ts="+(new Date).getTime()+Math.random()},e.prototype.retrieveId=function(){return r(this,void 0,Promise,(function(){var e,t,i,r;return n(this,(function(n){switch(n.label){case 0:e=this._buildUrl("id"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=n.sent()).status)throw new Error("Error. Status:"+t.status);return[2,t.text()];case 3:throw i=n.sent(),a.default.error("Error retrieving ID",i),r="","/"===this._options.path&&this._options.host!==o.util.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r);case 4:return[2]}}))}))},e.prototype.listAllPeers=function(){return r(this,void 0,Promise,(function(){var e,t,i,r;return n(this,(function(n){switch(n.label){case 0:e=this._buildUrl("peers"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=n.sent()).status){if(401===t.status)throw i=this._options.host===o.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+i);throw new Error("Error. Status:"+t.status)}return[2,t.json()];case 3:throw r=n.sent(),a.default.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r);case 4:return[2]}}))}))},e}();i.API=c},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.Peer=void 0;var c=e("eventemitter3"),h=e("./util"),l=a(e("./logger")),u=e("./socket"),p=e("./mediaconnection"),d=e("./dataconnection"),f=e("./enums"),m=e("./api"),g=function(e){function t(i,r){var s,o=e.call(this)||this;return o._id=null,o._lastServerId=null,o._destroyed=!1,o._disconnected=!1,o._open=!1,o._connections=new Map,o._lostMessages=new Map,i&&i.constructor==Object?r=i:i&&(s=i.toString()),r=n({debug:0,host:h.util.CLOUD_HOST,port:h.util.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:h.util.randomToken(),config:h.util.defaultConfig},r),o._options=r,"/"===o._options.host&&(o._options.host=window.location.hostname),o._options.path&&("/"!==o._options.path[0]&&(o._options.path="/"+o._options.path),"/"!==o._options.path[o._options.path.length-1]&&(o._options.path+="/")),void 0===o._options.secure&&o._options.host!==h.util.CLOUD_HOST?o._options.secure=h.util.isSecure():o._options.host==h.util.CLOUD_HOST&&(o._options.secure=!0),o._options.logFunction&&l.default.setLogFunction(o._options.logFunction),l.default.logLevel=o._options.debug||0,o._api=new m.API(r),o._socket=o._createServerConnection(),h.util.supports.audioVideo||h.util.supports.data?s&&!h.util.validateId(s)?(o._delayedAbort(f.PeerErrorType.InvalidID,'ID "'+s+'" is invalid'),o):(s?o._initialize(s):o._api.retrieveId().then((function(e){return o._initialize(e)})).catch((function(e){return o._abort(f.PeerErrorType.ServerError,e)})),o):(o._delayedAbort(f.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),o)}return r(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,t,i=Object.create(null);try{for(var r=s(this._connections),n=r.next();!n.done;n=r.next()){var a=o(n.value,2),c=a[0],h=a[1];i[c]=h}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,t=new u.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(f.SocketEventType.Message,(function(t){e._handleMessage(t)})),t.on(f.SocketEventType.Error,(function(t){e._abort(f.PeerErrorType.SocketError,t)})),t.on(f.SocketEventType.Disconnected,(function(){e.disconnected||(e.emitError(f.PeerErrorType.Network,"Lost connection to server."),e.disconnect())})),t.on(f.SocketEventType.Close,(function(){e.disconnected||e._abort(f.PeerErrorType.SocketClosed,"Underlying socket is already closed.")})),t},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var t,i,r=e.type,n=e.payload,o=e.src;switch(r){case f.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(f.PeerEventType.Open,this.id);break;case f.ServerMessageType.Error:this._abort(f.PeerErrorType.ServerError,n.msg);break;case f.ServerMessageType.IdTaken:this._abort(f.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case f.ServerMessageType.InvalidKey:this._abort(f.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case f.ServerMessageType.Leave:l.default.log("Received leave message from "+o),this._cleanupPeer(o),this._connections.delete(o);break;case f.ServerMessageType.Expire:this.emitError(f.PeerErrorType.PeerUnavailable,"Could not connect to peer "+o);break;case f.ServerMessageType.Offer:var a=n.connectionId;if((g=this.getConnection(o,a))&&(g.close(),l.default.warn("Offer received for existing Connection ID:"+a)),n.type===f.ConnectionType.Media)g=new p.MediaConnection(o,this,{connectionId:a,_payload:n,metadata:n.metadata}),this._addConnection(o,g),this.emit(f.PeerEventType.Call,g);else{if(n.type!==f.ConnectionType.Data)return void l.default.warn("Received malformed connection type:"+n.type);g=new d.DataConnection(o,this,{connectionId:a,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable}),this._addConnection(o,g),this.emit(f.PeerEventType.Connection,g)}var c=this._getMessages(a);try{for(var h=s(c),u=h.next();!u.done;u=h.next()){var m=u.value;g.handleMessage(m)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(t)throw t.error}}break;default:if(!n)return void l.default.warn("You received a malformed message from "+o+" of type "+r);var g;a=n.connectionId,(g=this.getConnection(o,a))&&g.peerConnection?g.handleMessage(e):a?this._storeMessage(a,e):l.default.warn("You received an unrecognized message:",e)}},t.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},t.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},t.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return l.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(f.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var i=new d.DataConnection(e,this,t);return this._addConnection(e,i),i},t.prototype.call=function(e,t,i){if(void 0===i&&(i={}),this.disconnected)return l.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(f.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){i._stream=t;var r=new p.MediaConnection(e,this,i);return this._addConnection(e,r),r}l.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},t.prototype._addConnection=function(e,t){l.default.log("add connection "+t.type+":"+t.connectionId+" to peerId:"+e),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},t.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,t){var i,r,n=this._connections.get(e);if(!n)return null;try{for(var o=s(n),a=o.next();!a.done;a=o.next()){var c=a.value;if(c.connectionId===t)return c}}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return null},t.prototype._delayedAbort=function(e,t){var i=this;setTimeout((function(){i._abort(e,t)}),0)},t.prototype._abort=function(e,t){l.default.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,t){var i;l.default.error("Error:",t),(i="string"==typeof t?new Error(t):t).type=e,this.emit(f.PeerEventType.Error,i)},t.prototype.destroy=function(){this.destroyed||(l.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(f.PeerEventType.Close))},t.prototype._cleanup=function(){var e,t;try{for(var i=s(this._connections.keys()),r=i.next();!r.done;r=i.next()){var n=r.value;this._cleanupPeer(n),this._connections.delete(n)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var t,i,r=this._connections.get(e);if(r)try{for(var n=s(r),o=n.next();!o.done;o=n.next())o.value.close()}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;l.default.log("Disconnect peer with ID:"+e),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit(f.PeerEventType.Disconnected,e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)l.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");l.default.error("In a hurry? We're still trying to make the initial connection!")}},t.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(e){}),this._api.listAllPeers().then((function(t){return e(t)})).catch((function(e){return t._abort(f.PeerErrorType.ServerError,e)}))},t.DEFAULT_KEY="peerjs",t}(c.EventEmitter);i.Peer=g},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.peerjs=void 0;var r=e("./util"),n=e("./peer");i.peerjs={Peer:n.Peer,util:r.util},i.default=n.Peer,window.peerjs=i.peerjs,window.Peer=n.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"])},"./node_modules/peerjs/dist sync recursive":e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id="./node_modules/peerjs/dist sync recursive",e.exports=t},"./node_modules/qrcode/lib/browser.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/can-promise.js"),n=i("./node_modules/qrcode/lib/core/qrcode.js"),s=i("./node_modules/qrcode/lib/renderer/canvas.js"),o=i("./node_modules/qrcode/lib/renderer/svg-tag.js");function a(e,t,i,s,o){const a=[].slice.call(arguments,1),c=a.length,h="function"==typeof a[c-1];if(!h&&!r())throw new Error("Callback required as last argument");if(!h){if(c<1)throw new Error("Too few arguments provided");return 1===c?(i=t,t=s=void 0):2!==c||t.getContext||(s=i,i=t,t=void 0),new Promise((function(r,o){try{const o=n.create(i,s);r(e(o,t,s))}catch(e){o(e)}}))}if(c<2)throw new Error("Too few arguments provided");2===c?(o=i,i=t,t=s=void 0):3===c&&(t.getContext&&void 0===o?(o=s,s=void 0):(o=s,s=i,i=t,t=void 0));try{const r=n.create(i,s);o(null,e(r,t,s))}catch(e){o(e)}}t.create=n.create,t.toCanvas=a.bind(null,s.render),t.toDataURL=a.bind(null,s.renderToDataURL),t.toString=a.bind(null,(function(e,t,i){return o.render(e,i)}))},"./node_modules/qrcode/lib/can-promise.js":e=>{e.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},"./node_modules/qrcode/lib/core/alignment-pattern.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/utils.js").getSymbolSize;t.getRowColCoords=function(e){if(1===e)return[];const t=Math.floor(e/7)+2,i=r(e),n=145===i?26:2*Math.ceil((i-13)/(2*t-2)),s=[i-7];for(let e=1;e<t-1;e++)s[e]=s[e-1]-n;return s.push(6),s.reverse()},t.getPositions=function(e){const i=[],r=t.getRowColCoords(e),n=r.length;for(let e=0;e<n;e++)for(let t=0;t<n;t++)0===e&&0===t||0===e&&t===n-1||e===n-1&&0===t||i.push([r[e],r[t]]);return i}},"./node_modules/qrcode/lib/core/alphanumeric-data.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/mode.js"),n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(e){this.mode=r.ALPHANUMERIC,this.data=e}s.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let i=45*n.indexOf(this.data[t]);i+=n.indexOf(this.data[t+1]),e.put(i,11)}this.data.length%2&&e.put(n.indexOf(this.data[t]),6)},e.exports=s},"./node_modules/qrcode/lib/core/bit-buffer.js":e=>{function t(){this.buffer=[],this.length=0}t.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let i=0;i<t;i++)this.putBit(1==(e>>>t-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},"./node_modules/qrcode/lib/core/bit-matrix.js":e=>{function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}t.prototype.set=function(e,t,i,r){const n=e*this.size+t;this.data[n]=i,r&&(this.reservedBit[n]=!0)},t.prototype.get=function(e,t){return this.data[e*this.size+t]},t.prototype.xor=function(e,t,i){this.data[e*this.size+t]^=i},t.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},e.exports=t},"./node_modules/qrcode/lib/core/byte-data.js":(e,t,i)=>{const r=i("./node_modules/encode-utf8/index.js"),n=i("./node_modules/qrcode/lib/core/mode.js");function s(e){this.mode=n.BYTE,"string"==typeof e&&(e=r(e)),this.data=new Uint8Array(e)}s.getBitsLength=function(e){return 8*e},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){for(let t=0,i=this.data.length;t<i;t++)e.put(this.data[t],8)},e.exports=s},"./node_modules/qrcode/lib/core/error-correction-code.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/error-correction-level.js"),n=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(e,t){switch(t){case r.L:return n[4*(e-1)+0];case r.M:return n[4*(e-1)+1];case r.Q:return n[4*(e-1)+2];case r.H:return n[4*(e-1)+3];default:return}},t.getTotalCodewordsCount=function(e,t){switch(t){case r.L:return s[4*(e-1)+0];case r.M:return s[4*(e-1)+1];case r.Q:return s[4*(e-1)+2];case r.H:return s[4*(e-1)+3];default:return}}},"./node_modules/qrcode/lib/core/error-correction-level.js":(e,t)=>{t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},t.from=function(e,i){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(e){return i}}},"./node_modules/qrcode/lib/core/finder-pattern.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/utils.js").getSymbolSize;t.getPositions=function(e){const t=r(e);return[[0,0],[t-7,0],[0,t-7]]}},"./node_modules/qrcode/lib/core/format-info.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/utils.js"),n=r.getBCHDigit(1335);t.getEncodedBits=function(e,t){const i=e.bit<<3|t;let s=i<<10;for(;r.getBCHDigit(s)-n>=0;)s^=1335<<r.getBCHDigit(s)-n;return 21522^(i<<10|s)}},"./node_modules/qrcode/lib/core/galois-field.js":(e,t)=>{const i=new Uint8Array(512),r=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)i[t]=e,r[e]=t,e<<=1,256&e&&(e^=285);for(let e=255;e<512;e++)i[e]=i[e-255]}(),t.log=function(e){if(e<1)throw new Error("log("+e+")");return r[e]},t.exp=function(e){return i[e]},t.mul=function(e,t){return 0===e||0===t?0:i[r[e]+r[t]]}},"./node_modules/qrcode/lib/core/kanji-data.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/mode.js"),n=i("./node_modules/qrcode/lib/core/utils.js");function s(e){this.mode=r.KANJI,this.data=e}s.getBitsLength=function(e){return 13*e},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let i=n.toSJIS(this.data[t]);if(i>=33088&&i<=40956)i-=33088;else{if(!(i>=57408&&i<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");i-=49472}i=192*(i>>>8&255)+(255&i),e.put(i,13)}},e.exports=s},"./node_modules/qrcode/lib/core/mask-pattern.js":(e,t)=>{t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};function i(e,i,r){switch(e){case t.Patterns.PATTERN000:return(i+r)%2==0;case t.Patterns.PATTERN001:return i%2==0;case t.Patterns.PATTERN010:return r%3==0;case t.Patterns.PATTERN011:return(i+r)%3==0;case t.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(r/3))%2==0;case t.Patterns.PATTERN101:return i*r%2+i*r%3==0;case t.Patterns.PATTERN110:return(i*r%2+i*r%3)%2==0;case t.Patterns.PATTERN111:return(i*r%3+(i+r)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}}t.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},t.from=function(e){return t.isValid(e)?parseInt(e,10):void 0},t.getPenaltyN1=function(e){const t=e.size;let i=0,r=0,n=0,s=null,o=null;for(let a=0;a<t;a++){r=n=0,s=o=null;for(let c=0;c<t;c++){let t=e.get(a,c);t===s?r++:(r>=5&&(i+=r-5+3),s=t,r=1),t=e.get(c,a),t===o?n++:(n>=5&&(i+=n-5+3),o=t,n=1)}r>=5&&(i+=r-5+3),n>=5&&(i+=n-5+3)}return i},t.getPenaltyN2=function(e){const t=e.size;let i=0;for(let r=0;r<t-1;r++)for(let n=0;n<t-1;n++){const t=e.get(r,n)+e.get(r,n+1)+e.get(r+1,n)+e.get(r+1,n+1);4!==t&&0!==t||i++}return 3*i},t.getPenaltyN3=function(e){const t=e.size;let i=0,r=0,n=0;for(let s=0;s<t;s++){r=n=0;for(let o=0;o<t;o++)r=r<<1&2047|e.get(s,o),o>=10&&(1488===r||93===r)&&i++,n=n<<1&2047|e.get(o,s),o>=10&&(1488===n||93===n)&&i++}return 40*i},t.getPenaltyN4=function(e){let t=0;const i=e.data.length;for(let r=0;r<i;r++)t+=e.data[r];return 10*Math.abs(Math.ceil(100*t/i/5)-10)},t.applyMask=function(e,t){const r=t.size;for(let n=0;n<r;n++)for(let s=0;s<r;s++)t.isReserved(s,n)||t.xor(s,n,i(e,s,n))},t.getBestMask=function(e,i){const r=Object.keys(t.Patterns).length;let n=0,s=1/0;for(let o=0;o<r;o++){i(o),t.applyMask(o,e);const r=t.getPenaltyN1(e)+t.getPenaltyN2(e)+t.getPenaltyN3(e)+t.getPenaltyN4(e);t.applyMask(o,e),r<s&&(s=r,n=o)}return n}},"./node_modules/qrcode/lib/core/mode.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/version-check.js"),n=i("./node_modules/qrcode/lib/core/regex.js");t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(e,t){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!r.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]},t.getBestModeForData=function(e){return n.testNumeric(e)?t.NUMERIC:n.testAlphanumeric(e)?t.ALPHANUMERIC:n.testKanji(e)?t.KANJI:t.BYTE},t.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},t.isValid=function(e){return e&&e.bit&&e.ccBits},t.from=function(e,i){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+e)}}(e)}catch(e){return i}}},"./node_modules/qrcode/lib/core/numeric-data.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/mode.js");function n(e){this.mode=r.NUMERIC,this.data=e.toString()}n.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(e){let t,i,r;for(t=0;t+3<=this.data.length;t+=3)i=this.data.substr(t,3),r=parseInt(i,10),e.put(r,10);const n=this.data.length-t;n>0&&(i=this.data.substr(t),r=parseInt(i,10),e.put(r,3*n+1))},e.exports=n},"./node_modules/qrcode/lib/core/polynomial.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/galois-field.js");t.mul=function(e,t){const i=new Uint8Array(e.length+t.length-1);for(let n=0;n<e.length;n++)for(let s=0;s<t.length;s++)i[n+s]^=r.mul(e[n],t[s]);return i},t.mod=function(e,t){let i=new Uint8Array(e);for(;i.length-t.length>=0;){const e=i[0];for(let n=0;n<t.length;n++)i[n]^=r.mul(t[n],e);let n=0;for(;n<i.length&&0===i[n];)n++;i=i.slice(n)}return i},t.generateECPolynomial=function(e){let i=new Uint8Array([1]);for(let n=0;n<e;n++)i=t.mul(i,new Uint8Array([1,r.exp(n)]));return i}},"./node_modules/qrcode/lib/core/qrcode.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/utils.js"),n=i("./node_modules/qrcode/lib/core/error-correction-level.js"),s=i("./node_modules/qrcode/lib/core/bit-buffer.js"),o=i("./node_modules/qrcode/lib/core/bit-matrix.js"),a=i("./node_modules/qrcode/lib/core/alignment-pattern.js"),c=i("./node_modules/qrcode/lib/core/finder-pattern.js"),h=i("./node_modules/qrcode/lib/core/mask-pattern.js"),l=i("./node_modules/qrcode/lib/core/error-correction-code.js"),u=i("./node_modules/qrcode/lib/core/reed-solomon-encoder.js"),p=i("./node_modules/qrcode/lib/core/version.js"),d=i("./node_modules/qrcode/lib/core/format-info.js"),f=i("./node_modules/qrcode/lib/core/mode.js"),m=i("./node_modules/qrcode/lib/core/segments.js");function g(e,t,i){const r=e.size,n=d.getEncodedBits(t,i);let s,o;for(s=0;s<15;s++)o=1==(n>>s&1),s<6?e.set(s,8,o,!0):s<8?e.set(s+1,8,o,!0):e.set(r-15+s,8,o,!0),s<8?e.set(8,r-s-1,o,!0):s<9?e.set(8,15-s-1+1,o,!0):e.set(8,15-s-1,o,!0);e.set(r-8,8,1,!0)}function y(e,t,i,n){let d;if(Array.isArray(e))d=m.fromArray(e);else{if("string"!=typeof e)throw new Error("Invalid data");{let r=t;if(!r){const t=m.rawSplit(e);r=p.getBestVersionForData(t,i)}d=m.fromString(e,r||40)}}const y=p.getBestVersionForData(d,i);if(!y)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<y)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+y+".\n")}else t=y;const v=function(e,t,i){const n=new s;i.forEach((function(t){n.put(t.mode.bit,4),n.put(t.getLength(),f.getCharCountIndicator(t.mode,e)),t.write(n)}));const o=8*(r.getSymbolTotalCodewords(e)-l.getTotalCodewordsCount(e,t));for(n.getLengthInBits()+4<=o&&n.put(0,4);n.getLengthInBits()%8!=0;)n.putBit(0);const a=(o-n.getLengthInBits())/8;for(let e=0;e<a;e++)n.put(e%2?17:236,8);return function(e,t,i){const n=r.getSymbolTotalCodewords(t),s=n-l.getTotalCodewordsCount(t,i),o=l.getBlocksCount(t,i),a=o-n%o,c=Math.floor(n/o),h=Math.floor(s/o),p=h+1,d=c-h,f=new u(d);let m=0;const g=new Array(o),y=new Array(o);let v=0;const b=new Uint8Array(e.buffer);for(let e=0;e<o;e++){const t=e<a?h:p;g[e]=b.slice(m,m+t),y[e]=f.encode(g[e]),m+=t,v=Math.max(v,t)}const _=new Uint8Array(n);let S,R,C=0;for(S=0;S<v;S++)for(R=0;R<o;R++)S<g[R].length&&(_[C++]=g[R][S]);for(S=0;S<d;S++)for(R=0;R<o;R++)_[C++]=y[R][S];return _}(n,e,t)}(t,i,d),b=r.getSymbolSize(t),_=new o(b);return function(e,t){const i=e.size,r=c.getPositions(t);for(let t=0;t<r.length;t++){const n=r[t][0],s=r[t][1];for(let t=-1;t<=7;t++)if(!(n+t<=-1||i<=n+t))for(let r=-1;r<=7;r++)s+r<=-1||i<=s+r||(t>=0&&t<=6&&(0===r||6===r)||r>=0&&r<=6&&(0===t||6===t)||t>=2&&t<=4&&r>=2&&r<=4?e.set(n+t,s+r,!0,!0):e.set(n+t,s+r,!1,!0))}}(_,t),function(e){const t=e.size;for(let i=8;i<t-8;i++){const t=i%2==0;e.set(i,6,t,!0),e.set(6,i,t,!0)}}(_),function(e,t){const i=a.getPositions(t);for(let t=0;t<i.length;t++){const r=i[t][0],n=i[t][1];for(let t=-2;t<=2;t++)for(let i=-2;i<=2;i++)-2===t||2===t||-2===i||2===i||0===t&&0===i?e.set(r+t,n+i,!0,!0):e.set(r+t,n+i,!1,!0)}}(_,t),g(_,i,0),t>=7&&function(e,t){const i=e.size,r=p.getEncodedBits(t);let n,s,o;for(let t=0;t<18;t++)n=Math.floor(t/3),s=t%3+i-8-3,o=1==(r>>t&1),e.set(n,s,o,!0),e.set(s,n,o,!0)}(_,t),function(e,t){const i=e.size;let r=-1,n=i-1,s=7,o=0;for(let a=i-1;a>0;a-=2)for(6===a&&a--;;){for(let i=0;i<2;i++)if(!e.isReserved(n,a-i)){let r=!1;o<t.length&&(r=1==(t[o]>>>s&1)),e.set(n,a-i,r),s--,-1===s&&(o++,s=7)}if(n+=r,n<0||i<=n){n-=r,r=-r;break}}}(_,v),isNaN(n)&&(n=h.getBestMask(_,g.bind(null,_,i))),h.applyMask(n,_),g(_,i,n),{modules:_,version:t,errorCorrectionLevel:i,maskPattern:n,segments:d}}t.create=function(e,t){if(void 0===e||""===e)throw new Error("No input text");let i,s,o=n.M;return void 0!==t&&(o=n.from(t.errorCorrectionLevel,n.M),i=p.from(t.version),s=h.from(t.maskPattern),t.toSJISFunc&&r.setToSJISFunction(t.toSJISFunc)),y(e,i,o,s)}},"./node_modules/qrcode/lib/core/reed-solomon-encoder.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/polynomial.js");function n(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}n.prototype.initialize=function(e){this.degree=e,this.genPoly=r.generateECPolynomial(this.degree)},n.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const i=r.mod(t,this.genPoly),n=this.degree-i.length;if(n>0){const e=new Uint8Array(this.degree);return e.set(i,n),e}return i},e.exports=n},"./node_modules/qrcode/lib/core/regex.js":(e,t)=>{let i="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";i=i.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+i+")(?:.|[\r\n]))+";t.KANJI=new RegExp(i,"g"),t.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=new RegExp(r,"g"),t.NUMERIC=new RegExp("[0-9]+","g"),t.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const n=new RegExp("^"+i+"$"),s=new RegExp("^[0-9]+$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(e){return n.test(e)},t.testNumeric=function(e){return s.test(e)},t.testAlphanumeric=function(e){return o.test(e)}},"./node_modules/qrcode/lib/core/segments.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/mode.js"),n=i("./node_modules/qrcode/lib/core/numeric-data.js"),s=i("./node_modules/qrcode/lib/core/alphanumeric-data.js"),o=i("./node_modules/qrcode/lib/core/byte-data.js"),a=i("./node_modules/qrcode/lib/core/kanji-data.js"),c=i("./node_modules/qrcode/lib/core/regex.js"),h=i("./node_modules/qrcode/lib/core/utils.js"),l=i("./node_modules/dijkstrajs/dijkstra.js");function u(e){return unescape(encodeURIComponent(e)).length}function p(e,t,i){const r=[];let n;for(;null!==(n=e.exec(i));)r.push({data:n[0],index:n.index,mode:t,length:n[0].length});return r}function d(e){const t=p(c.NUMERIC,r.NUMERIC,e),i=p(c.ALPHANUMERIC,r.ALPHANUMERIC,e);let n,s;return h.isKanjiModeEnabled()?(n=p(c.BYTE,r.BYTE,e),s=p(c.KANJI,r.KANJI,e)):(n=p(c.BYTE_KANJI,r.BYTE,e),s=[]),t.concat(i,n,s).sort((function(e,t){return e.index-t.index})).map((function(e){return{data:e.data,mode:e.mode,length:e.length}}))}function f(e,t){switch(t){case r.NUMERIC:return n.getBitsLength(e);case r.ALPHANUMERIC:return s.getBitsLength(e);case r.KANJI:return a.getBitsLength(e);case r.BYTE:return o.getBitsLength(e)}}function m(e,t){let i;const c=r.getBestModeForData(e);if(i=r.from(t,c),i!==r.BYTE&&i.bit<c.bit)throw new Error('"'+e+'" cannot be encoded with mode '+r.toString(i)+".\n Suggested mode is: "+r.toString(c));switch(i!==r.KANJI||h.isKanjiModeEnabled()||(i=r.BYTE),i){case r.NUMERIC:return new n(e);case r.ALPHANUMERIC:return new s(e);case r.KANJI:return new a(e);case r.BYTE:return new o(e)}}t.fromArray=function(e){return e.reduce((function(e,t){return"string"==typeof t?e.push(m(t,null)):t.data&&e.push(m(t.data,t.mode)),e}),[])},t.fromString=function(e,i){const n=function(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i];switch(n.mode){case r.NUMERIC:t.push([n,{data:n.data,mode:r.ALPHANUMERIC,length:n.length},{data:n.data,mode:r.BYTE,length:n.length}]);break;case r.ALPHANUMERIC:t.push([n,{data:n.data,mode:r.BYTE,length:n.length}]);break;case r.KANJI:t.push([n,{data:n.data,mode:r.BYTE,length:u(n.data)}]);break;case r.BYTE:t.push([{data:n.data,mode:r.BYTE,length:u(n.data)}])}}return t}(d(e,h.isKanjiModeEnabled())),s=function(e,t){const i={},n={start:{}};let s=["start"];for(let o=0;o<e.length;o++){const a=e[o],c=[];for(let e=0;e<a.length;e++){const h=a[e],l=""+o+e;c.push(l),i[l]={node:h,lastCount:0},n[l]={};for(let e=0;e<s.length;e++){const o=s[e];i[o]&&i[o].node.mode===h.mode?(n[o][l]=f(i[o].lastCount+h.length,h.mode)-f(i[o].lastCount,h.mode),i[o].lastCount+=h.length):(i[o]&&(i[o].lastCount=h.length),n[o][l]=f(h.length,h.mode)+4+r.getCharCountIndicator(h.mode,t))}}s=c}for(let e=0;e<s.length;e++)n[s[e]].end=0;return{map:n,table:i}}(n,i),o=l.find_path(s.map,"start","end"),a=[];for(let e=1;e<o.length-1;e++)a.push(s.table[o[e]].node);return t.fromArray(a.reduce((function(e,t){const i=e.length-1>=0?e[e.length-1]:null;return i&&i.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)}),[]))},t.rawSplit=function(e){return t.fromArray(d(e,h.isKanjiModeEnabled()))}},"./node_modules/qrcode/lib/core/utils.js":(e,t)=>{let i;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},t.getSymbolTotalCodewords=function(e){return r[e]},t.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},t.setToSJISFunction=function(e){if("function"!=typeof e)throw new Error('"toSJISFunc" is not a valid function.');i=e},t.isKanjiModeEnabled=function(){return void 0!==i},t.toSJIS=function(e){return i(e)}},"./node_modules/qrcode/lib/core/version-check.js":(e,t)=>{t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}},"./node_modules/qrcode/lib/core/version.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/core/utils.js"),n=i("./node_modules/qrcode/lib/core/error-correction-code.js"),s=i("./node_modules/qrcode/lib/core/error-correction-level.js"),o=i("./node_modules/qrcode/lib/core/mode.js"),a=i("./node_modules/qrcode/lib/core/version-check.js"),c=r.getBCHDigit(7973);function h(e,t){return o.getCharCountIndicator(e,t)+4}function l(e,t){let i=0;return e.forEach((function(e){const r=h(e.mode,t);i+=r+e.getBitsLength()})),i}t.from=function(e,t){return a.isValid(e)?parseInt(e,10):t},t.getCapacity=function(e,t,i){if(!a.isValid(e))throw new Error("Invalid QR Code version");void 0===i&&(i=o.BYTE);const s=8*(r.getSymbolTotalCodewords(e)-n.getTotalCodewordsCount(e,t));if(i===o.MIXED)return s;const c=s-h(i,e);switch(i){case o.NUMERIC:return Math.floor(c/10*3);case o.ALPHANUMERIC:return Math.floor(c/11*2);case o.KANJI:return Math.floor(c/13);case o.BYTE:default:return Math.floor(c/8)}},t.getBestVersionForData=function(e,i){let r;const n=s.from(i,s.M);if(Array.isArray(e)){if(e.length>1)return function(e,i){for(let r=1;r<=40;r++)if(l(e,r)<=t.getCapacity(r,i,o.MIXED))return r}(e,n);if(0===e.length)return 1;r=e[0]}else r=e;return function(e,i,r){for(let n=1;n<=40;n++)if(i<=t.getCapacity(n,r,e))return n}(r.mode,r.getLength(),n)},t.getEncodedBits=function(e){if(!a.isValid(e)||e<7)throw new Error("Invalid QR Code version");let t=e<<12;for(;r.getBCHDigit(t)-c>=0;)t^=7973<<r.getBCHDigit(t)-c;return e<<12|t}},"./node_modules/qrcode/lib/renderer/canvas.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/renderer/utils.js");t.render=function(e,t,i){let n=i,s=t;void 0!==n||t&&t.getContext||(n=t,t=void 0),t||(s=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),n=r.getOptions(n);const o=r.getImageWidth(e.modules.size,n),a=s.getContext("2d"),c=a.createImageData(o,o);return r.qrToImageData(c.data,e,n),function(e,t,i){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=i,t.width=i,t.style.height=i+"px",t.style.width=i+"px"}(a,s,o),a.putImageData(c,0,0),s},t.renderToDataURL=function(e,i,r){let n=r;void 0!==n||i&&i.getContext||(n=i,i=void 0),n||(n={});const s=t.render(e,i,n),o=n.type||"image/png",a=n.rendererOpts||{};return s.toDataURL(o,a.quality)}},"./node_modules/qrcode/lib/renderer/svg-tag.js":(e,t,i)=>{const r=i("./node_modules/qrcode/lib/renderer/utils.js");function n(e,t){const i=e.a/255,r=t+'="'+e.hex+'"';return i<1?r+" "+t+'-opacity="'+i.toFixed(2).slice(1)+'"':r}function s(e,t,i){let r=e+t;return void 0!==i&&(r+=" "+i),r}t.render=function(e,t,i){const o=r.getOptions(t),a=e.modules.size,c=e.modules.data,h=a+2*o.margin,l=o.color.light.a?"<path "+n(o.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",u="<path "+n(o.color.dark,"stroke")+' d="'+function(e,t,i){let r="",n=0,o=!1,a=0;for(let c=0;c<e.length;c++){const h=Math.floor(c%t),l=Math.floor(c/t);h||o||(o=!0),e[c]?(a++,c>0&&h>0&&e[c-1]||(r+=o?s("M",h+i,.5+l+i):s("m",n,0),n=0,o=!1),h+1<t&&e[c+1]||(r+=s("h",a),a=0)):n++}return r}(c,a,o.margin)+'"/>',p='viewBox="0 0 '+h+" "+h+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+p+' shape-rendering="crispEdges">'+l+u+"</svg>\n";return"function"==typeof i&&i(null,d),d}},"./node_modules/qrcode/lib/renderer/utils.js":(e,t)=>{function i(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map((function(e){return[e,e]})))),6===t.length&&t.push("F","F");const i=parseInt(t.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:255&i,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(e){e||(e={}),e.color||(e.color={});const t=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,n=e.scale||4;return{width:r,scale:r?4:n,margin:t,color:{dark:i(e.color.dark||"#000000ff"),light:i(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},t.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},t.getImageWidth=function(e,i){const r=t.getScale(e,i);return Math.floor((e+2*i.margin)*r)},t.qrToImageData=function(e,i,r){const n=i.modules.size,s=i.modules.data,o=t.getScale(n,r),a=Math.floor((n+2*r.margin)*o),c=r.margin*o,h=[r.color.light,r.color.dark];for(let t=0;t<a;t++)for(let i=0;i<a;i++){let l=4*(t*a+i),u=r.color.light;t>=c&&i>=c&&t<a-c&&i<a-c&&(u=h[s[Math.floor((t-c)/o)*n+Math.floor((i-c)/o)]?1:0]),e[l++]=u.r,e[l++]=u.g,e[l++]=u.b,e[l]=u.a}}},"./node_modules/query-string/index.js":(e,t,i)=>{"use strict";const r=i("./node_modules/strict-uri-encode/index.js"),n=i("./node_modules/decode-uri-component/index.js"),s=i("./node_modules/split-on-first/index.js"),o=i("./node_modules/filter-obj/index.js");function a(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function c(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function h(e,t){return t.decode?n(e):e}function l(e){return Array.isArray(e)?e.sort():"object"==typeof e?l(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function u(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function p(e){const t=(e=u(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function d(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function f(e,t){a((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const i=function(e){let t;switch(e.arrayFormat){case"index":return(e,i,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=i):r[e]=i};case"bracket":return(e,i,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],i):r[e]=[i]:r[e]=i};case"comma":case"separator":return(t,i,r)=>{const n="string"==typeof i&&i.includes(e.arrayFormatSeparator),s="string"==typeof i&&!n&&h(i,e).includes(e.arrayFormatSeparator);i=s?h(i,e):i;const o=n||s?i.split(e.arrayFormatSeparator).map((t=>h(t,e))):null===i?i:h(i,e);r[t]=o};default:return(e,t,i)=>{void 0!==i[e]?i[e]=[].concat(i[e],t):i[e]=t}}}(t),r=Object.create(null);if("string"!=typeof e)return r;if(!(e=e.trim().replace(/^[?#&]/,"")))return r;for(const n of e.split("&")){if(""===n)continue;let[e,o]=s(t.decode?n.replace(/\+/g," "):n,"=");o=void 0===o?null:["comma","separator"].includes(t.arrayFormat)?o:h(o,t),i(h(e,t),o,r)}for(const e of Object.keys(r)){const i=r[e];if("object"==typeof i&&null!==i)for(const e of Object.keys(i))i[e]=d(i[e],t);else r[e]=d(i,t)}return!1===t.sort?r:(!0===t.sort?Object.keys(r).sort():Object.keys(r).sort(t.sort)).reduce(((e,t)=>{const i=r[t];return Boolean(i)&&"object"==typeof i&&!Array.isArray(i)?e[t]=l(i):e[t]=i,e}),Object.create(null))}t.extract=p,t.parse=f,t.stringify=(e,t)=>{if(!e)return"";a((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const i=i=>t.skipNull&&null==e[i]||t.skipEmptyString&&""===e[i],r=function(e){switch(e.arrayFormat){case"index":return t=>(i,r)=>{const n=i.length;return void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?i:null===r?[...i,[c(t,e),"[",n,"]"].join("")]:[...i,[c(t,e),"[",c(n,e),"]=",c(r,e)].join("")]};case"bracket":return t=>(i,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?i:null===r?[...i,[c(t,e),"[]"].join("")]:[...i,[c(t,e),"[]=",c(r,e)].join("")];case"comma":case"separator":return t=>(i,r)=>null==r||0===r.length?i:0===i.length?[[c(t,e),"=",c(r,e)].join("")]:[[i,c(r,e)].join(e.arrayFormatSeparator)];default:return t=>(i,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?i:null===r?[...i,c(t,e)]:[...i,[c(t,e),"=",c(r,e)].join("")]}}(t),n={};for(const t of Object.keys(e))i(t)||(n[t]=e[t]);const s=Object.keys(n);return!1!==t.sort&&s.sort(t.sort),s.map((i=>{const n=e[i];return void 0===n?"":null===n?c(i,t):Array.isArray(n)?n.reduce(r(i),[]).join("&"):c(i,t)+"="+c(n,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[i,r]=s(e,"#");return Object.assign({url:i.split("?")[0]||"",query:f(p(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:h(r,t)}:{})},t.stringifyUrl=(e,i)=>{i=Object.assign({encode:!0,strict:!0},i);const r=u(e.url).split("?")[0]||"",n=t.extract(e.url),s=t.parse(n,{sort:!1}),o=Object.assign(s,e.query);let a=t.stringify(o,i);a&&(a=`?${a}`);let h=function(e){let t="";const i=e.indexOf("#");return-1!==i&&(t=e.slice(i)),t}(e.url);return e.fragmentIdentifier&&(h=`#${c(e.fragmentIdentifier,i)}`),`${r}${a}${h}`},t.pick=(e,i,r)=>{r=Object.assign({parseFragmentIdentifier:!0},r);const{url:n,query:s,fragmentIdentifier:a}=t.parseUrl(e,r);return t.stringifyUrl({url:n,query:o(s,i),fragmentIdentifier:a},r)},t.exclude=(e,i,r)=>{const n=Array.isArray(i)?e=>!i.includes(e):(e,t)=>!i(e,t);return t.pick(e,n,r)}},"./node_modules/split-on-first/index.js":e=>{"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const i=e.indexOf(t);return-1===i?[e]:[e.slice(0,i),e.slice(i+t.length)]}},"./node_modules/strict-uri-encode/index.js":e=>{"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},"./src/autoserialize.ts":(e,t,i)=>{"use strict";function r(e){return JSON.parse(JSON.stringify(e))}function n(e,t){let i=JSON.parse(JSON.stringify(e));for(const[e,r]of Object.entries(i))t[e]=i[e]}i.r(t),i.d(t,{serialize:()=>r,deserialize:()=>n})},"./src/debugging.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEV:()=>n});var r=i("./node_modules/loglevel/lib/loglevel.js");const n=!0;n&&r.enableAll()},"./src/defaultinput.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{DefaultInput:()=>s,DefaultInputReader:()=>o});var r=i("./src/types.ts"),n=i("./src/utils.ts");class s extends r.NetplayInput{constructor(){super(...arguments),this.pressed={},this.touches=[]}}class o{constructor(e,t,i){this.PRESSED_KEYS={},this.mousePosition=null,this.mouseDelta=null,this.touches=[],this.canvas=e,this.touchControls=i,document.addEventListener("keydown",(e=>{this.PRESSED_KEYS[e.key]=!0}),!1),document.addEventListener("keyup",(e=>{this.PRESSED_KEYS[e.key]=!1}),!1),e.addEventListener("mouseenter",(e=>this.updateMousePosition(e)),!1),e.addEventListener("mousemove",(e=>this.updateMousePosition(e)),!1),e.addEventListener("mouseleave",(e=>{this.mousePosition=null}),!1),e.addEventListener("touchstart",(e=>this.updateTouches(e)),!1),e.addEventListener("touchmove",(e=>this.updateTouches(e)),!1),e.addEventListener("touchend",(e=>this.updateTouches(e)),!1),e.addEventListener("mousedown",(()=>{t&&e.requestPointerLock()}))}getCanvasScale(){const e=this.canvas.getBoundingClientRect();return{x:this.canvas.width/e.width,y:this.canvas.height/e.height}}projectClientPosition(e,t){const i=this.canvas.getBoundingClientRect(),r=this.getCanvasScale();return{x:(e-i.left)*r.x,y:(t-i.top)*r.y}}updateMousePosition(e){if(document.pointerLockElement===this.canvas)if(this.mousePosition){const t=this.getCanvasScale();this.mousePosition.x+=e.movementX*t.x,this.mousePosition.y+=e.movementY*t.y}else this.mousePosition=this.projectClientPosition(e.clientX,e.clientY);else this.mousePosition=this.projectClientPosition(e.clientX,e.clientY)}updateTouches(e){this.touches.length=e.targetTouches.length;for(let t=0;t<e.targetTouches.length;++t)this.touches[t]=this.projectClientPosition(e.targetTouches[t].clientX,e.targetTouches[t].clientY)}getInput(){let e=new s;for(let t in this.PRESSED_KEYS)this.PRESSED_KEYS[t]&&(e.pressed[t]=!0);this.mousePosition&&(e.mousePosition=n.clone(this.mousePosition)),e.touches=n.clone(this.touches);for(let[t,i]of Object.entries(this.touchControls))e.touchControls=e.touchControls||{},e.touchControls[t]=n.clone(i.getValue());return e}}},"./src/ewmasd.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});class r{constructor(e){this.discount=e,this.est_average=0,this.est_variance=0,this.initialized=!1}update(e){if(this.initialized){let t=e-this.est_average;this.est_variance=(1-this.discount)*(this.est_variance+this.discount*t*t),this.est_average=this.discount*e+(1-this.discount)*this.est_average}else this.est_average=e,this.initialized=!0}average(){return this.est_average}variance(){return this.est_variance}stddev(){return Math.sqrt(this.est_variance)}}},"./src/game.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{Game:()=>n});var r=i("./src/types.ts");class n extends r.NetplayState{}},"./src/gamewrapper.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{GameWrapper:()=>u});var r=i("./src/defaultinput.ts"),n=i("./src/types.ts"),s=i("./node_modules/loglevel/lib/loglevel.js"),o=i("./node_modules/peerjs/dist/peerjs.min.js"),a=i.n(o),c=i("./node_modules/query-string/index.js"),h=i("./node_modules/qrcode/lib/browser.js"),l=i("./node_modules/chai/index.mjs");class u{constructor(e){if(this.rtcStats="",this.gameClass=e,this.canvas=document.createElement("canvas"),this.canvas.width=e.canvasSize.width,this.canvas.height=e.canvasSize.height,this.canvas.style.backgroundColor="black",this.canvas.style.position="absolute",this.canvas.style.zIndex="0",this.canvas.style.boxShadow="0px 0px 10px black",this.resize(),window.addEventListener("resize",(()=>this.resize())),document.body.appendChild(this.canvas),this.stats=document.createElement("div"),this.stats.style.zIndex="1",this.stats.style.position="absolute",this.stats.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.stats.style.color="white",this.stats.style.padding="5px",this.stats.style.display="none",document.body.appendChild(this.stats),this.menu=document.createElement("div"),this.menu.style.zIndex="1",this.menu.style.position="absolute",this.menu.style.backgroundColor="white",this.menu.style.padding="5px",this.menu.style.left="50%",this.menu.style.top="50%",this.menu.style.boxShadow="0px 0px 10px black",this.menu.style.transform="translate(-50%, -50%)",document.body.appendChild(this.menu),this.gameClass.touchControls&&window.navigator.userAgent.toLowerCase().includes("mobile"))for(let[e,t]of Object.entries(this.gameClass.touchControls))t.show();this.inputReader=new r.DefaultInputReader(this.canvas,this.gameClass.pointerLock||!1,this.gameClass.touchControls||{})}isChannelOrdered(e){return e.ordered}isChannelReliable(e){return null===e.maxPacketLifeTime&&null===e.maxRetransmits}checkChannel(e){l.assert.isTrue(this.isChannelOrdered(e),"Data Channel must be ordered."),l.assert.isTrue(this.isChannelReliable(e),"Channel must be reliable.")}calculateLayout(e,t){const i=e.width/t.width,r=e.height/t.height,n=t.width*r>=e.width,s=n?i:r;let o=t.width*s,a=t.height*s,c=0,h=0;return n?h=e.height/2-a/2:c=e.width/2-o/2,{width:o,height:a,left:c,top:h}}resize(){const e=this.calculateLayout({width:window.innerWidth,height:window.innerHeight},this.gameClass.canvasSize);s.debug("Calculating new layout: %o",e),this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.canvas.style.top=`${e.top}px`,this.canvas.style.left=`${e.left}px`}start(){return e=this,t=void 0,r=function*(){s.info("Creating a PeerJS instance."),this.menu.innerHTML="Connecting to PeerJS...",s.info("Fetching ICE servers...");let e=yield fetch("https://netplayjs.varunramesh.net/iceservers").then((e=>e.json())).catch((()=>[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}]));this.peer=new(a())(void 0,{config:{sdpSemantics:"unified-plan",iceServers:e}}),this.peer.on("error",(e=>console.error(e))),this.peer.on("open",(e=>{const t=c.parse(window.location.hash);if(t.room){this.menu.style.display="none",s.info(`Connecting to room ${t.room}.`);const e=this.peer.connect(t.room,{serialization:"json",reliable:!0,_payload:{originator:!0,reliable:!0}});e.on("error",(e=>console.error(e)));const i=[new n.NetplayPlayer(0,!1,!0),new n.NetplayPlayer(1,!0,!1)];this.startClient(i,e)}else{s.info("Showing join link.");let t=`${window.location.href}#room=${e}`;this.menu.innerHTML=`<div>Join URL (Open in a new window or send to a friend): <a href="${t}">${t}<div>`;const i=document.createElement("canvas");this.menu.appendChild(i),h.toCanvas(i,t);const r=[new n.NetplayPlayer(0,!0,!0),new n.NetplayPlayer(1,!1,!1)];this.peer.on("connection",(e=>{this.menu.style.display="none",e.on("error",(e=>console.error(e))),this.startHost(r,e)}))}}))},new((i=void 0)||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}));var e,t,i,r}formatRTCStats(e){let t="";return e.forEach((e=>{t+="<details>",t+=`<summary>${e.type}</summary>`,Object.keys(e).forEach((i=>{"type"!==i&&(t+=`<div>${i}: ${e[i]}</div> `)})),t+="</details>"})),t}watchRTCStats(e){setInterval((()=>{e.getStats().then((e=>this.rtcStats=this.formatRTCStats(e)))}),1e3)}}},"./src/json.ts":(e,t,i)=>{"use strict";i.r(t)},"./src/lockstepwrapper.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{LockstepWrapper:()=>c});var r=i("./src/defaultinput.ts"),n=i("./src/ewmasd.ts"),s=i("./src/netcode/lockstep.ts"),o=i("./node_modules/loglevel/lib/loglevel.js"),a=i("./src/gamewrapper.ts");class c extends a.GameWrapper{constructor(e){super(e),this.pingMeasure=new n.default(.2)}getStateSyncPeriod(){return this.gameClass.deterministic?0:1}startHost(e,t){o.info("Starting a lockstep host."),this.game=new this.gameClass(this.canvas,e),this.lockstepNetcode=new s.LockstepNetcode(!0,this.game,e,this.gameClass.timestep,this.getStateSyncPeriod(),(()=>this.inputReader.getInput()),((e,i)=>{t.send({type:"input",frame:e,input:i.serialize()})}),((e,i)=>{t.send({type:"state",frame:e,state:i})})),t.on("data",(i=>{if("input"===i.type){let t=new r.DefaultInput;t.deserialize(i.input),this.lockstepNetcode.onRemoteInput(i.frame,e[1],t)}else"ping-req"==i.type?t.send({type:"ping-resp",sent_time:i.sent_time}):"ping-resp"==i.type&&this.pingMeasure.update(Date.now()-i.sent_time)})),t.on("open",(()=>{console.log("Client has connected... Starting game..."),this.checkChannel(t.dataChannel),setInterval((()=>{t.send({type:"ping-req",sent_time:Date.now()})}),100),this.startGameLoop()}))}startClient(e,t){o.info("Starting a lockstep client."),this.game=new this.gameClass(this.canvas,e),this.lockstepNetcode=new s.LockstepNetcode(!1,this.game,e,this.gameClass.timestep,this.getStateSyncPeriod(),(()=>this.inputReader.getInput()),((e,i)=>{t.send({type:"input",frame:e,input:i.serialize()})})),t.on("data",(i=>{if("input"===i.type){let t=new r.DefaultInput;t.deserialize(i.input),this.lockstepNetcode.onRemoteInput(i.frame,e[0],t)}else"state"===i.type?this.lockstepNetcode.onStateSync(i.frame,i.state):"ping-req"==i.type?t.send({type:"ping-resp",sent_time:i.sent_time}):"ping-resp"==i.type&&this.pingMeasure.update(Date.now()-i.sent_time)})),t.on("open",(()=>{console.log("Successfully connected to server... Starting game..."),this.checkChannel(t.dataChannel),setInterval((()=>{t.send({type:"ping-req",sent_time:Date.now()})}),100),this.startGameLoop()}))}startGameLoop(){this.stats.style.display="inherit",this.lockstepNetcode.start();let e=t=>{this.game.draw(this.canvas),this.stats.innerHTML=`\n      <div>Netcode Algorithm: Lockstep</div>\n      <div>Ping: ${this.pingMeasure.average().toFixed(2)} ms +/- ${this.pingMeasure.stddev().toFixed(2)} ms</div>\n      <div>Frame Number: ${this.lockstepNetcode.frame}</div>\n      <div>Missed Frames: ${this.lockstepNetcode.missedFrames}</div>\n\n      <div>State Syncs: ${this.lockstepNetcode.stateSyncsSent} sent, ${this.lockstepNetcode.stateSyncsReceived} received</div>\n      `,requestAnimationFrame(e)};requestAnimationFrame(e)}}},"./src/netcode/lockstep.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{LockstepNetcode:()=>o});var r=i("./src/debugging.ts"),n=i("./node_modules/chai/index.mjs"),s=i("./src/utils.ts");class o{constructor(e,t,i,r,n,s,o,a){this.frame=0,this.inputs=new Map,this.missedFrames=0,this.stateSyncsReceived=0,this.stateSyncsSent=0,this.isHost=e,this.state=t,this.players=i,this.timestep=r,this.pollInput=s,this.broadcastInput=o,this.stateSyncPeriod=n;for(let e of this.players)this.inputs.set(e,[]);if(this.isHost&&this.stateSyncPeriod>0){if(!a)throw new Error("Expected a broadcastState argument");this.broadcastState=a}}getLocalPlayer(){return this.players.filter((e=>e.isLocalPlayer()))[0]}checkAllInputsReady(){for(let e of this.players)if(0===(0,s.get)(this.inputs,e).length)return!1;return!0}tryAdvanceState(){if(!this.checkAllInputsReady())return void this.missedFrames++;let e=new Map;for(let t of this.players){let i=(0,s.get)(this.inputs,t),o=(0,s.shift)(i);r.DEV&&n.assert.equal(o.frame,this.frame),e.set(t,o.input)}this.state.tick(e),this.frame++,this.tryStateSync(),this.processLocalInput()}start(){this.tryStateSync(),this.processLocalInput(),setInterval((()=>{this.tryAdvanceState()}),this.timestep)}onStateSync(e,t){r.DEV&&n.assert.equal(e,this.frame,"Unexpected state sync frame."),this.state.deserialize(t),this.stateSyncsReceived++}tryStateSync(){this.isHost&&this.stateSyncPeriod>0&&this.frame%this.stateSyncPeriod==0&&(this.broadcastState(this.frame,this.state.serialize()),this.stateSyncsSent++)}processLocalInput(){let e=this.getLocalPlayer(),t=this.pollInput();r.DEV&&n.assert.isEmpty(this.inputs.get(e),"Local player already has input stored."),(0,s.get)(this.inputs,e).push({frame:this.frame,input:this.pollInput()}),this.broadcastInput(this.frame,t)}onRemoteInput(e,t,i){r.DEV&&n.assert.isTrue(t.isRemotePlayer(),"'player' must be remote.");const o=(0,s.get)(this.inputs,t),a=0===o.length?this.frame:o[o.length-1].frame+1;r.DEV&&n.assert.equal(e,a,"Unexpected Frame"),o.push({frame:e,input:i})}}},"./src/netcode/rollback.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{RollbackNetcode:()=>c});var r=i("./src/utils.ts"),n=i("./node_modules/loglevel/lib/loglevel.js"),s=i("./src/debugging.ts"),o=i("./node_modules/chai/index.mjs");class a{constructor(e,t,i){this.frame=e,this.state=t,this.inputs=i}isPlayerInputPredicted(e){return(0,r.get)(this.inputs,e).isPrediction}anyInputPredicted(){for(const[e,{isPrediction:t}]of this.inputs.entries())if(t)return!0;return!1}allInputsSynced(){return!this.anyInputPredicted()}}class c{constructor(e,t,i,n,s,o,c,h,l,u){if(this.isHost=e,this.state=t,this.players=i,this.maxPredictedFrames=s,this.broadcastInput=l,this.pingMeasure=o,this.timestep=c,this.pollInput=h,e){if(!u)throw new Error("Expected a broadcast state function.");this.broadcastState=u}let p=new Map;for(const[e,t]of n.entries())p.set(e,{input:t,isPrediction:!1});this.history=[new a(0,(0,r.clone)(this.state.serialize()),p)],this.future=new Map,this.highestFrameReceived=new Map;for(let e of this.players)this.future.set(e,[]),this.highestFrameReceived.set(e,0)}onStateSync(e,t){s.DEV&&o.assert.isFalse(this.isHost,"Only clients recieve state syncs.");let i=0;for(;this.history.length>1&&(s.DEV&&o.assert.isTrue(this.history[0].allInputsSynced()),this.history[0].frame<e);)(0,r.shift)(this.history),i++;s.DEV&&n.debug(`Cleaned up ${i} states.`),s.DEV&&o.assert.equal(this.history[0].frame,e),this.history[0].state=t,this.state.deserialize(t);for(let e=1;e<this.history.length;++e){let t=this.history[e];this.state.tick(this.getStateInputs(t.inputs)),t.state=(0,r.clone)(this.state.serialize())}s.DEV&&n.debug(`Resimulated ${this.history.length-1} states after state sync.`)}onRemoteInput(e,t,i){s.DEV&&o.assert.isTrue(t.isRemotePlayer(),"'player' must be a remote player."),s.DEV&&o.assert.isNotEmpty(this.history,"'history' cannot be empty.");let a=(0,r.get)(this.highestFrameReceived,t)+1;if(s.DEV&&o.assert.equal(a,e),this.highestFrameReceived.set(t,a),e>this.history[this.history.length-1].frame)return void(0,r.get)(this.future,t).push({frame:e,input:i});let c=null;for(let e=0;e<this.history.length;++e)if(this.history[e].isPlayerInputPredicted(t)){c=e;break}s.DEV&&o.assert.exists(c),s.DEV&&o.assert.equal(this.history[c].frame,e);let h=this.history[c-1];this.state.deserialize(h.state);for(let n=c;n<this.history.length;++n){let a=this.history[n],h=(0,r.get)(a.inputs,t);if(s.DEV&&o.assert.isTrue(h.isPrediction),n===c)s.DEV&&o.assert.equal(a.frame,e),h.isPrediction=!1,h.input=i;else{let e=this.history[n-1],i=(0,r.get)(e.inputs,t);h.input=i.input.predictNext()}this.state.tick(this.getStateInputs(a.inputs)),a.state=(0,r.clone)(this.state.serialize())}if(s.DEV&&n.debug(`Resimulated ${this.history.length-c} states after rollback.`),this.isHost){let e=0;for(;this.history.length>=2;){let t=this.history[0],i=this.history[1];if(s.DEV&&o.assert.isTrue(t.allInputsSynced()),!i.allInputsSynced())break;{let t=(0,r.shift)(this.history);e++,this.broadcastState(t.frame,t.state)}}s.DEV&&n.debug(`Cleaned up ${e} states.`)}}currentFrame(){return s.DEV&&o.assert.isNotEmpty(this.history,"'history' cannot be empty."),this.history[this.history.length-1].frame}largestFutureSize(){return Math.max(...Array.from(this.future.values()).map((e=>e.length)))}predictedFrames(){for(let e=0;e<this.history.length;++e)if(!this.history[e].allInputsSynced())return this.history.length-e;return 0}shouldStall(){return this.predictedFrames()>this.maxPredictedFrames}tick(){if(s.DEV&&o.assert.isNotEmpty(this.history,"'history' cannot be empty."),this.shouldStall())return;const e=this.history[this.history.length-1],t=new Map;for(const[i,n]of e.inputs.entries())if(i.isLocalPlayer()){let r=this.pollInput();t.set(i,{input:r,isPrediction:!1}),this.broadcastInput(e.frame+1,r)}else if((0,r.get)(this.future,i).length>0){let n=(0,r.shift)((0,r.get)(this.future,i));s.DEV&&o.assert.equal(e.frame+1,n.frame),t.set(i,{input:n.input,isPrediction:!1})}else t.set(i,{input:n.input.predictNext(),isPrediction:!0});this.state.tick(this.getStateInputs(t)),this.history.push(new a(e.frame+1,(0,r.clone)(this.state.serialize()),t))}getStateInputs(e){let t=new Map;for(const[i,{input:r}]of e.entries())t.set(i,r);return t}start(){setInterval((()=>{let e=1;this.largestFutureSize()>0&&(e=2);for(let t=0;t<e;++t)this.tick()}),this.timestep)}}},"./src/rollbackwrapper.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{RollbackWrapper:()=>c});var r=i("./src/defaultinput.ts"),n=i("./src/ewmasd.ts"),s=i("./node_modules/loglevel/lib/loglevel.js"),o=i("./src/gamewrapper.ts"),a=i("./src/netcode/rollback.ts");class c extends o.GameWrapper{constructor(e){super(e),this.pingMeasure=new n.default(.2)}getInitialInputs(e){let t=new Map;for(let i of e)t.set(i,new r.DefaultInput);return t}startHost(e,t){s.info("Starting a lcokstep host."),this.game=new this.gameClass(this.canvas,e),this.rollbackNetcode=new a.RollbackNetcode(!0,this.game,e,this.getInitialInputs(e),10,this.pingMeasure,this.gameClass.timestep,(()=>this.inputReader.getInput()),((e,i)=>{t.send({type:"input",frame:e,input:i.serialize()})}),((e,i)=>{t.send({type:"state",frame:e,state:i})})),t.on("data",(i=>{if("input"===i.type){let t=new r.DefaultInput;t.deserialize(i.input),this.rollbackNetcode.onRemoteInput(i.frame,e[1],t)}else"ping-req"==i.type?t.send({type:"ping-resp",sent_time:i.sent_time}):"ping-resp"==i.type&&this.pingMeasure.update(Date.now()-i.sent_time)})),t.on("open",(()=>{console.log("Client has connected... Starting game..."),this.checkChannel(t.dataChannel),setInterval((()=>{t.send({type:"ping-req",sent_time:Date.now()})}),100),this.startGameLoop()}))}startClient(e,t){s.info("Starting a lockstep client."),this.game=new this.gameClass(this.canvas,e),this.rollbackNetcode=new a.RollbackNetcode(!1,this.game,e,this.getInitialInputs(e),10,this.pingMeasure,this.gameClass.timestep,(()=>this.inputReader.getInput()),((e,i)=>{t.send({type:"input",frame:e,input:i.serialize()})})),t.on("data",(i=>{if("input"===i.type){let t=new r.DefaultInput;t.deserialize(i.input),this.rollbackNetcode.onRemoteInput(i.frame,e[0],t)}else"state"===i.type?this.rollbackNetcode.onStateSync(i.frame,i.state):"ping-req"==i.type?t.send({type:"ping-resp",sent_time:i.sent_time}):"ping-resp"==i.type&&this.pingMeasure.update(Date.now()-i.sent_time)})),t.on("open",(()=>{console.log("Successfully connected to server... Starting game..."),this.checkChannel(t.dataChannel),setInterval((()=>{t.send({type:"ping-req",sent_time:Date.now()})}),100),this.startGameLoop()}))}startGameLoop(){this.stats.style.display="inherit",this.rollbackNetcode.start();let e=t=>{this.game.draw(this.canvas),this.stats.innerHTML=`\n        <div>Netcode Algorithm: Rollback</div>\n        <div>Ping: ${this.pingMeasure.average().toFixed(2)} ms +/- ${this.pingMeasure.stddev().toFixed(2)} ms</div>\n        <div>History Size: ${this.rollbackNetcode.history.length}</div>\n        <div>Frame Number: ${this.rollbackNetcode.currentFrame()}</div>\n        <div>Largest Future Size: ${this.rollbackNetcode.largestFutureSize()}</div>\n        <div>Predicted Frames: ${this.rollbackNetcode.predictedFrames()}</div>\n        <div title="If true, then the other player is running slow, so we wait for them.">Stalling: ${this.rollbackNetcode.shouldStall()}</div>\n        `,requestAnimationFrame(e)};requestAnimationFrame(e)}}},"./src/test-wrapper.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{TestWrapper:()=>s});var r=i("./src/defaultinput.ts"),n=i("./src/types.ts");class s{constructor(e){if(this.players=[new n.NetplayPlayer(0,!0,!0),new n.NetplayPlayer(1,!1,!1)],this.gameClass=e,this.canvas=document.createElement("canvas"),this.canvas.width=e.canvasSize.width,this.canvas.height=e.canvasSize.height,this.canvas.style.backgroundColor="black",document.body.appendChild(this.canvas),this.gameClass.touchControls&&window.navigator.userAgent.toLowerCase().includes("mobile"))for(let[e,t]of Object.entries(this.gameClass.touchControls))t.show();this.inputReader=new r.DefaultInputReader(this.canvas,this.gameClass.pointerLock||!1,this.gameClass.touchControls||{}),this.game=new this.gameClass(this.canvas,this.players)}start(){setInterval((()=>{let e=new Map;for(let t of this.players)t.isLocalPlayer()?e.set(t,this.inputReader.getInput()):e.set(t,new r.DefaultInput);this.game.tick(e)}),this.gameClass.timestep);let e=t=>{this.game.draw(this.canvas),requestAnimationFrame(e)};requestAnimationFrame(e)}}},"./src/touchcontrols.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{TouchControl:()=>r,VirtualJoystick:()=>n});class r{}class n extends r{constructor(){super(),this.value={x:0,y:0},this.base=document.createElement("div"),this.base.style.width="1.5in",this.base.style.height="1.5in",this.base.style.backgroundColor="rgba(255, 255, 255, 0.5)",this.base.style.zIndex="3",this.base.style.borderRadius="50%",this.base.style.position="absolute",this.base.style.left="10px",this.base.style.bottom="10px",this.base.style.display="none",this.nub=document.createElement("div"),this.nub.style.width="0.5in",this.nub.style.height="0.5in",this.nub.style.backgroundColor="rgba(255, 255, 255, 1.0)",this.nub.style.zIndex="4",this.nub.style.borderRadius="50%",this.nub.style.pointerEvents="none",this.nub.style.position="absolute",this.nub.style.transform="translate(-50%, -50%)",this.nub.style.display="none",document.body.appendChild(this.base),document.body.appendChild(this.nub),this.base.addEventListener("touchstart",(e=>{let t=e.targetTouches[0];this.updateTouch(t)})),this.base.addEventListener("touchmove",(e=>{let t=e.targetTouches[0];this.updateTouch(t)})),this.base.addEventListener("touchend",(e=>{e.targetTouches[0],this.updateTouch()}))}show(){this.base.style.display="inherit",this.nub.style.display="inherit",this.updateTouch()}updateTouch(e){let t=this.base.getBoundingClientRect();if(e){let i={x:2*((e.clientX-t.left)/t.width-.5),y:2*((e.clientY-t.top)/t.height-.5)},r=Math.sqrt(i.x*i.x+i.y*i.y);r>1&&(i.x=i.x/r,i.y=i.y/r),this.value={x:i.x,y:-i.y},this.nub.style.left=`${(i.x/2+.5)*t.width+t.left}px`,this.nub.style.top=`${(i.y/2+.5)*t.height+t.top}px`}else this.nub.style.left=`${.5*t.width+t.left}px`,this.nub.style.top=`${.5*t.height+t.top}px`,this.value={x:0,y:0}}getValue(){return this.value}}},"./src/types.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{NetplayState:()=>n,NetplayInput:()=>s,NetplayPlayer:()=>o});var r=i("./src/autoserialize.ts");class n{serialize(){return r.serialize(this)}deserialize(e){r.deserialize(e,this)}}class s{predictNext(){return this}serialize(){return r.serialize(this)}deserialize(e){r.deserialize(e,this)}}class o{constructor(e,t,i){this.id=e,this.isLocal=t,this.isHost=i}isLocalPlayer(){return this.isLocal}isRemotePlayer(){return!this.isLocal}isServer(){return this.isHost}isClient(){return!this.isHost}getID(){return this.id}}},"./src/utils.ts":(e,t,i)=>{"use strict";function r(e,t){let i=e.get(t);if(void 0!==i)return i;throw new Error(`Key ${String(t)} not in Map ${e.toString()}`)}function n(e){return JSON.parse(JSON.stringify(e))}function s(e){let t=e.shift();if(void 0!==t)return t;throw new Error(`Shift returned undefined from Array ${e.toString()}`)}i.r(t),i.d(t,{get:()=>r,clone:()=>n,shift:()=>s})},"./node_modules/type-detect/type-detect.js":function(e,t,i){e.exports=function(){"use strict";var e="function"==typeof Promise,t="object"==typeof self?self:i.g,r="undefined"!=typeof Symbol,n="undefined"!=typeof Map,s="undefined"!=typeof Set,o="undefined"!=typeof WeakMap,a="undefined"!=typeof WeakSet,c="undefined"!=typeof DataView,h=r&&void 0!==Symbol.iterator,l=r&&void 0!==Symbol.toStringTag,u=s&&"function"==typeof Set.prototype.entries,p=n&&"function"==typeof Map.prototype.entries,d=u&&Object.getPrototypeOf((new Set).entries()),f=p&&Object.getPrototypeOf((new Map).entries()),m=h&&"function"==typeof Array.prototype[Symbol.iterator],g=m&&Object.getPrototypeOf([][Symbol.iterator]()),y=h&&"function"==typeof String.prototype[Symbol.iterator],v=y&&Object.getPrototypeOf(""[Symbol.iterator]());return function(i){var r=typeof i;if("object"!==r)return r;if(null===i)return"null";if(i===t)return"global";if(Array.isArray(i)&&(!1===l||!(Symbol.toStringTag in i)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&i===window.location)return"Location";if("object"==typeof window.document&&i===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&i===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&i===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&i instanceof window.HTMLElement){if("BLOCKQUOTE"===i.tagName)return"HTMLQuoteElement";if("TD"===i.tagName)return"HTMLTableDataCellElement";if("TH"===i.tagName)return"HTMLTableHeaderCellElement"}}var h=l&&i[Symbol.toStringTag];if("string"==typeof h)return h;var u=Object.getPrototypeOf(i);return u===RegExp.prototype?"RegExp":u===Date.prototype?"Date":e&&u===Promise.prototype?"Promise":s&&u===Set.prototype?"Set":n&&u===Map.prototype?"Map":a&&u===WeakSet.prototype?"WeakSet":o&&u===WeakMap.prototype?"WeakMap":c&&u===DataView.prototype?"DataView":n&&u===f?"Map Iterator":s&&u===d?"Set Iterator":m&&u===g?"Array Iterator":y&&u===v?"String Iterator":null===u?"Object":Object.prototype.toString.call(i).slice(8,-1)}}()}},t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";i.r(r),i.d(r,{NetplayInput:()=>e.NetplayInput,NetplayPlayer:()=>e.NetplayPlayer,NetplayState:()=>e.NetplayState,DefaultInput:()=>t.DefaultInput,DefaultInputReader:()=>t.DefaultInputReader,GameWrapper:()=>n.GameWrapper,LockstepWrapper:()=>s.LockstepWrapper,RollbackWrapper:()=>o.RollbackWrapper,Game:()=>a.Game,TouchControl:()=>c.TouchControl,VirtualJoystick:()=>c.VirtualJoystick,TestWrapper:()=>h.TestWrapper});var e=i("./src/types.ts"),t=i("./src/defaultinput.ts"),n=i("./src/gamewrapper.ts"),s=i("./src/lockstepwrapper.ts"),o=i("./src/rollbackwrapper.ts"),a=i("./src/game.ts"),c=i("./src/touchcontrols.ts"),h=(i("./src/json.ts"),i("./src/test-wrapper.ts"))})(),r})()},e.exports=t()},188:e=>{var t=function(){this.state=new Array(8);for(var e=0;e<this.state.length;e++)this.state[e]=64};t.BUTTON_A=0,t.BUTTON_B=1,t.BUTTON_SELECT=2,t.BUTTON_START=3,t.BUTTON_UP=4,t.BUTTON_DOWN=5,t.BUTTON_LEFT=6,t.BUTTON_RIGHT=7,t.prototype={buttonDown:function(e){this.state[e]=65},buttonUp:function(e){this.state[e]=64}},e.exports=t},990:(e,t,i)=>{var r=i(610),n=function(e){this.nes=e,this.mem=null,this.REG_ACC=null,this.REG_X=null,this.REG_Y=null,this.REG_SP=null,this.REG_PC=null,this.REG_PC_NEW=null,this.REG_STATUS=null,this.F_CARRY=null,this.F_DECIMAL=null,this.F_INTERRUPT=null,this.F_INTERRUPT_NEW=null,this.F_OVERFLOW=null,this.F_SIGN=null,this.F_ZERO=null,this.F_NOTUSED=null,this.F_NOTUSED_NEW=null,this.F_BRK=null,this.F_BRK_NEW=null,this.opdata=null,this.cyclesToHalt=null,this.crash=null,this.irqRequested=null,this.irqType=null,this.reset()};n.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var e=0;e<8192;e++)this.mem[e]=255;for(var t=0;t<4;t++){var i=2048*t;this.mem[i+8]=247,this.mem[i+9]=239,this.mem[i+10]=223,this.mem[i+15]=191}for(var r=8193;r<this.mem.length;r++)this.mem[r]=0;this.REG_ACC=0,this.REG_X=0,this.REG_Y=0,this.REG_SP=511,this.REG_PC=32767,this.REG_PC_NEW=32767,this.REG_STATUS=40,this.setStatus(40),this.F_CARRY=0,this.F_DECIMAL=0,this.F_INTERRUPT=1,this.F_INTERRUPT_NEW=1,this.F_OVERFLOW=0,this.F_SIGN=0,this.F_ZERO=1,this.F_NOTUSED=1,this.F_NOTUSED_NEW=1,this.F_BRK=1,this.F_BRK_NEW=1,this.opdata=(new s).opdata,this.cyclesToHalt=0,this.crash=!1,this.irqRequested=!1,this.irqType=null},emulate:function(){var e,t;if(this.irqRequested){switch(e=this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7,this.REG_PC_NEW=this.REG_PC,this.F_INTERRUPT_NEW=this.F_INTERRUPT,this.irqType){case 0:if(0!==this.F_INTERRUPT)break;this.doIrq(e);break;case 1:this.doNonMaskableInterrupt(e);break;case 2:this.doResetInterrupt()}this.REG_PC=this.REG_PC_NEW,this.F_INTERRUPT=this.F_INTERRUPT_NEW,this.F_BRK=this.F_BRK_NEW,this.irqRequested=!1}var i=this.opdata[this.nes.mmap.load(this.REG_PC+1)],r=i>>24,n=0,s=i>>8&255,o=this.REG_PC;this.REG_PC+=i>>16&255;var a=0;switch(s){case 0:a=this.load(o+2);break;case 1:a=this.load(o+2),a+=a<128?this.REG_PC:this.REG_PC-256;break;case 2:break;case 3:a=this.load16bit(o+2);break;case 4:a=this.REG_ACC;break;case 5:a=this.REG_PC;break;case 6:a=this.load(o+2)+this.REG_X&255;break;case 7:a=this.load(o+2)+this.REG_Y&255;break;case 8:(65280&(a=this.load16bit(o+2)))!=(a+this.REG_X&65280)&&(n=1),a+=this.REG_X;break;case 9:(65280&(a=this.load16bit(o+2)))!=(a+this.REG_Y&65280)&&(n=1),a+=this.REG_Y;break;case 10:(65280&(a=this.load(o+2)))!=(a+this.REG_X&65280)&&(n=1),a+=this.REG_X,a&=255,a=this.load16bit(a);break;case 11:(65280&(a=this.load16bit(this.load(o+2))))!=(a+this.REG_Y&65280)&&(n=1),a+=this.REG_Y;break;case 12:a=(a=this.load16bit(o+2))<8191?this.mem[a]+(this.mem[65280&a|1+(255&a)&255]<<8):this.nes.mmap.load(a)+(this.nes.mmap.load(65280&a|1+(255&a)&255)<<8)}switch(a&=65535,255&i){case 0:e=this.REG_ACC+this.load(a)+this.F_CARRY,0==(128&(this.REG_ACC^this.load(a)))&&0!=(128&(this.REG_ACC^e))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=e>255?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e,this.REG_ACC=255&e,r+=n;break;case 1:this.REG_ACC=this.REG_ACC&this.load(a),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==s&&(r+=n);break;case 2:4===s?(this.F_CARRY=this.REG_ACC>>7&1,this.REG_ACC=this.REG_ACC<<1&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC):(e=this.load(a),this.F_CARRY=e>>7&1,e=e<<1&255,this.F_SIGN=e>>7&1,this.F_ZERO=e,this.write(a,e));break;case 3:0===this.F_CARRY&&(r+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 4:1===this.F_CARRY&&(r+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 5:0===this.F_ZERO&&(r+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 6:e=this.load(a),this.F_SIGN=e>>7&1,this.F_OVERFLOW=e>>6&1,e&=this.REG_ACC,this.F_ZERO=e;break;case 7:1===this.F_SIGN&&(r++,this.REG_PC=a);break;case 8:0!==this.F_ZERO&&(r+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 9:0===this.F_SIGN&&(r+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 10:this.REG_PC+=2,this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7),this.F_INTERRUPT=1,this.REG_PC=this.load16bit(65534),this.REG_PC--;break;case 11:0===this.F_OVERFLOW&&(r+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 12:1===this.F_OVERFLOW&&(r+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 13:this.F_CARRY=0;break;case 14:this.F_DECIMAL=0;break;case 15:this.F_INTERRUPT=0;break;case 16:this.F_OVERFLOW=0;break;case 17:e=this.REG_ACC-this.load(a),this.F_CARRY=e>=0?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e,r+=n;break;case 18:e=this.REG_X-this.load(a),this.F_CARRY=e>=0?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e;break;case 19:e=this.REG_Y-this.load(a),this.F_CARRY=e>=0?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e;break;case 20:e=this.load(a)-1&255,this.F_SIGN=e>>7&1,this.F_ZERO=e,this.write(a,e);break;case 21:this.REG_X=this.REG_X-1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 22:this.REG_Y=this.REG_Y-1&255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 23:this.REG_ACC=255&(this.load(a)^this.REG_ACC),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,r+=n;break;case 24:e=this.load(a)+1&255,this.F_SIGN=e>>7&1,this.F_ZERO=e,this.write(a,255&e);break;case 25:this.REG_X=this.REG_X+1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 26:this.REG_Y++,this.REG_Y&=255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 27:this.REG_PC=a-1;break;case 28:this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.REG_PC=a-1;break;case 29:this.REG_ACC=this.load(a),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,r+=n;break;case 30:this.REG_X=this.load(a),this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X,r+=n;break;case 31:this.REG_Y=this.load(a),this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y,r+=n;break;case 32:4===s?(e=255&this.REG_ACC,this.F_CARRY=1&e,e>>=1,this.REG_ACC=e):(e=255&this.load(a),this.F_CARRY=1&e,e>>=1,this.write(a,e)),this.F_SIGN=0,this.F_ZERO=e;break;case 33:case 68:break;case 34:e=255&(this.load(a)|this.REG_ACC),this.F_SIGN=e>>7&1,this.F_ZERO=e,this.REG_ACC=e,11!==s&&(r+=n);break;case 35:this.push(this.REG_ACC);break;case 36:this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break;case 37:this.REG_ACC=this.pull(),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 38:e=this.pull(),this.F_CARRY=1&e,this.F_ZERO=1==(e>>1&1)?0:1,this.F_INTERRUPT=e>>2&1,this.F_DECIMAL=e>>3&1,this.F_BRK=e>>4&1,this.F_NOTUSED=e>>5&1,this.F_OVERFLOW=e>>6&1,this.F_SIGN=e>>7&1,this.F_NOTUSED=1;break;case 39:4===s?(e=this.REG_ACC,t=this.F_CARRY,this.F_CARRY=e>>7&1,e=(e<<1&255)+t,this.REG_ACC=e):(e=this.load(a),t=this.F_CARRY,this.F_CARRY=e>>7&1,e=(e<<1&255)+t,this.write(a,e)),this.F_SIGN=e>>7&1,this.F_ZERO=e;break;case 40:4===s?(t=this.F_CARRY<<7,this.F_CARRY=1&this.REG_ACC,e=(this.REG_ACC>>1)+t,this.REG_ACC=e):(e=this.load(a),t=this.F_CARRY<<7,this.F_CARRY=1&e,e=(e>>1)+t,this.write(a,e)),this.F_SIGN=e>>7&1,this.F_ZERO=e;break;case 41:if(e=this.pull(),this.F_CARRY=1&e,this.F_ZERO=0==(e>>1&1)?1:0,this.F_INTERRUPT=e>>2&1,this.F_DECIMAL=e>>3&1,this.F_BRK=e>>4&1,this.F_NOTUSED=e>>5&1,this.F_OVERFLOW=e>>6&1,this.F_SIGN=e>>7&1,this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;this.REG_PC--,this.F_NOTUSED=1;break;case 42:if(this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;break;case 43:e=this.REG_ACC-this.load(a)-(1-this.F_CARRY),this.F_SIGN=e>>7&1,this.F_ZERO=255&e,0!=(128&(this.REG_ACC^e))&&0!=(128&(this.REG_ACC^this.load(a)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=e<0?0:1,this.REG_ACC=255&e,11!==s&&(r+=n);break;case 44:this.F_CARRY=1;break;case 45:this.F_DECIMAL=1;break;case 46:this.F_INTERRUPT=1;break;case 47:this.write(a,this.REG_ACC);break;case 48:this.write(a,this.REG_X);break;case 49:this.write(a,this.REG_Y);break;case 50:this.REG_X=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 51:this.REG_Y=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 52:this.REG_X=this.REG_SP-256,this.F_SIGN=this.REG_SP>>7&1,this.F_ZERO=this.REG_X;break;case 53:this.REG_ACC=this.REG_X,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 54:this.REG_SP=this.REG_X+256,this.stackWrap();break;case 55:this.REG_ACC=this.REG_Y,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 56:e=this.REG_ACC&this.load(a),this.F_CARRY=1&e,this.REG_ACC=this.F_ZERO=e>>1,this.F_SIGN=0;break;case 57:this.REG_ACC=this.F_ZERO=this.REG_ACC&this.load(a),this.F_CARRY=this.F_SIGN=this.REG_ACC>>7&1;break;case 58:e=this.REG_ACC&this.load(a),this.REG_ACC=this.F_ZERO=(e>>1)+(this.F_CARRY<<7),this.F_SIGN=this.F_CARRY,this.F_CARRY=e>>7&1,this.F_OVERFLOW=1&(e>>7^e>>6);break;case 59:e=(this.REG_X&this.REG_ACC)-this.load(a),this.F_SIGN=e>>7&1,this.F_ZERO=255&e,0!=(128&(this.REG_X^e))&&0!=(128&(this.REG_X^this.load(a)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=e<0?0:1,this.REG_X=255&e;break;case 60:this.REG_ACC=this.REG_X=this.F_ZERO=this.load(a),this.F_SIGN=this.REG_ACC>>7&1,r+=n;break;case 61:this.write(a,this.REG_ACC&this.REG_X);break;case 62:e=this.load(a)-1&255,this.write(a,e),e=this.REG_ACC-e,this.F_CARRY=e>=0?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e,11!==s&&(r+=n);break;case 63:e=this.load(a)+1&255,this.write(a,e),e=this.REG_ACC-e-(1-this.F_CARRY),this.F_SIGN=e>>7&1,this.F_ZERO=255&e,0!=(128&(this.REG_ACC^e))&&0!=(128&(this.REG_ACC^this.load(a)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=e<0?0:1,this.REG_ACC=255&e,11!==s&&(r+=n);break;case 64:e=this.load(a),t=this.F_CARRY,this.F_CARRY=e>>7&1,e=(e<<1&255)+t,this.write(a,e),this.REG_ACC=this.REG_ACC&e,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==s&&(r+=n);break;case 65:e=this.load(a),t=this.F_CARRY<<7,this.F_CARRY=1&e,e=(e>>1)+t,this.write(a,e),e=this.REG_ACC+this.load(a)+this.F_CARRY,0==(128&(this.REG_ACC^this.load(a)))&&0!=(128&(this.REG_ACC^e))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=e>255?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e,this.REG_ACC=255&e,11!==s&&(r+=n);break;case 66:e=this.load(a),this.F_CARRY=e>>7&1,e=e<<1&255,this.write(a,e),this.REG_ACC=this.REG_ACC|e,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==s&&(r+=n);break;case 67:e=255&this.load(a),this.F_CARRY=1&e,e>>=1,this.write(a,e),this.REG_ACC=this.REG_ACC^e,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==s&&(r+=n);break;case 69:this.load(a),11!==s&&(r+=n);break;default:this.nes.stop(),this.nes.crashMessage="Game crashed, invalid opcode at address $"+o.toString(16)}return r},load:function(e){return e<8192?this.mem[2047&e]:this.nes.mmap.load(e)},load16bit:function(e){return e<8191?this.mem[2047&e]|this.mem[e+1&2047]<<8:this.nes.mmap.load(e)|this.nes.mmap.load(e+1)<<8},write:function(e,t){e<8192?this.mem[2047&e]=t:this.nes.mmap.write(e,t)},requestIrq:function(e){this.irqRequested&&e===this.IRQ_NORMAL||(this.irqRequested=!0,this.irqType=e)},push:function(e){this.nes.mmap.write(this.REG_SP,e),this.REG_SP--,this.REG_SP=256|255&this.REG_SP},stackWrap:function(){this.REG_SP=256|255&this.REG_SP},pull:function(){return this.REG_SP++,this.REG_SP=256|255&this.REG_SP,this.nes.mmap.load(this.REG_SP)},pageCrossed:function(e,t){return(65280&e)!=(65280&t)},haltCycles:function(e){this.cyclesToHalt+=e},doNonMaskableInterrupt:function(e){0!=(128&this.nes.mmap.load(8192))&&(this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(e),this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8,this.REG_PC_NEW--)},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8,this.REG_PC_NEW--},doIrq:function(e){this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(e),this.F_INTERRUPT_NEW=1,this.F_BRK_NEW=0,this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8,this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(e){this.F_CARRY=1&e,this.F_ZERO=e>>1&1,this.F_INTERRUPT=e>>2&1,this.F_DECIMAL=e>>3&1,this.F_BRK=e>>4&1,this.F_NOTUSED=e>>5&1,this.F_OVERFLOW=e>>6&1,this.F_SIGN=e>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return r.toJSON(this)},fromJSON:function(e){r.fromJSON(this,e)}};var s=function(){this.opdata=new Array(256);for(var e=0;e<256;e++)this.opdata[e]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2),this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3),this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4),this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4),this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4),this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4),this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2),this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3),this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4),this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4),this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4),this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4),this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2),this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5),this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6),this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6),this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7),this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2),this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2),this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2),this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3),this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4),this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2),this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2),this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2),this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7),this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2),this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2),this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2),this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2),this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2),this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2),this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2),this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3),this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4),this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4),this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4),this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4),this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2),this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3),this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4),this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2),this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3),this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4),this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5),this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6),this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6),this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7),this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2),this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2),this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2),this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3),this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4),this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4),this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4),this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4),this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5),this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6),this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6),this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7),this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2),this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2),this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3),this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5),this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6),this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2),this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3),this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4),this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4),this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2),this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3),this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4),this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4),this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2),this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3),this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4),this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4),this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2),this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5),this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6),this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6),this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7),this.setOp(this.INS_NOP,26,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,58,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,90,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,122,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,218,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,250,this.ADDR_IMP,1,2),this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2),this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3),this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4),this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4),this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4),this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4),this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3),this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3),this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4),this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4),this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2),this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5),this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6),this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7),this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2),this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5),this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6),this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7),this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6),this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6),this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2),this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3),this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4),this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4),this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4),this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4),this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2),this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2),this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2),this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3),this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4),this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4),this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5),this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5),this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6),this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3),this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4),this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4),this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3),this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4),this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4),this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2),this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2),this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2),this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2),this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2),this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2),this.setOp(this.INS_ALR,75,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,11,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,43,this.ADDR_IMM,2,2),this.setOp(this.INS_ARR,107,this.ADDR_IMM,2,2),this.setOp(this.INS_AXS,203,this.ADDR_IMM,2,2),this.setOp(this.INS_LAX,163,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LAX,167,this.ADDR_ZP,2,3),this.setOp(this.INS_LAX,175,this.ADDR_ABS,3,4),this.setOp(this.INS_LAX,179,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LAX,183,this.ADDR_ZPY,2,4),this.setOp(this.INS_LAX,191,this.ADDR_ABSY,3,4),this.setOp(this.INS_SAX,131,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SAX,135,this.ADDR_ZP,2,3),this.setOp(this.INS_SAX,143,this.ADDR_ABS,3,4),this.setOp(this.INS_SAX,151,this.ADDR_ZPY,2,4),this.setOp(this.INS_DCP,195,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_DCP,199,this.ADDR_ZP,2,5),this.setOp(this.INS_DCP,207,this.ADDR_ABS,3,6),this.setOp(this.INS_DCP,211,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_DCP,215,this.ADDR_ZPX,2,6),this.setOp(this.INS_DCP,219,this.ADDR_ABSY,3,7),this.setOp(this.INS_DCP,223,this.ADDR_ABSX,3,7),this.setOp(this.INS_ISC,227,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_ISC,231,this.ADDR_ZP,2,5),this.setOp(this.INS_ISC,239,this.ADDR_ABS,3,6),this.setOp(this.INS_ISC,243,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_ISC,247,this.ADDR_ZPX,2,6),this.setOp(this.INS_ISC,251,this.ADDR_ABSY,3,7),this.setOp(this.INS_ISC,255,this.ADDR_ABSX,3,7),this.setOp(this.INS_RLA,35,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RLA,39,this.ADDR_ZP,2,5),this.setOp(this.INS_RLA,47,this.ADDR_ABS,3,6),this.setOp(this.INS_RLA,51,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RLA,55,this.ADDR_ZPX,2,6),this.setOp(this.INS_RLA,59,this.ADDR_ABSY,3,7),this.setOp(this.INS_RLA,63,this.ADDR_ABSX,3,7),this.setOp(this.INS_RRA,99,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RRA,103,this.ADDR_ZP,2,5),this.setOp(this.INS_RRA,111,this.ADDR_ABS,3,6),this.setOp(this.INS_RRA,115,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RRA,119,this.ADDR_ZPX,2,6),this.setOp(this.INS_RRA,123,this.ADDR_ABSY,3,7),this.setOp(this.INS_RRA,127,this.ADDR_ABSX,3,7),this.setOp(this.INS_SLO,3,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SLO,7,this.ADDR_ZP,2,5),this.setOp(this.INS_SLO,15,this.ADDR_ABS,3,6),this.setOp(this.INS_SLO,19,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SLO,23,this.ADDR_ZPX,2,6),this.setOp(this.INS_SLO,27,this.ADDR_ABSY,3,7),this.setOp(this.INS_SLO,31,this.ADDR_ABSX,3,7),this.setOp(this.INS_SRE,67,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SRE,71,this.ADDR_ZP,2,5),this.setOp(this.INS_SRE,79,this.ADDR_ABS,3,6),this.setOp(this.INS_SRE,83,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SRE,87,this.ADDR_ZPX,2,6),this.setOp(this.INS_SRE,91,this.ADDR_ABSY,3,7),this.setOp(this.INS_SRE,95,this.ADDR_ABSX,3,7),this.setOp(this.INS_SKB,128,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,130,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,137,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,194,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,226,this.ADDR_IMM,2,2),this.setOp(this.INS_IGN,12,this.ADDR_ABS,3,4),this.setOp(this.INS_IGN,28,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,60,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,92,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,124,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,220,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,252,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,4,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,68,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,100,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,20,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,52,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,84,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,116,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,212,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,244,this.ADDR_ZPX,2,4),this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7),this.instname=new Array(70),this.instname[0]="ADC",this.instname[1]="AND",this.instname[2]="ASL",this.instname[3]="BCC",this.instname[4]="BCS",this.instname[5]="BEQ",this.instname[6]="BIT",this.instname[7]="BMI",this.instname[8]="BNE",this.instname[9]="BPL",this.instname[10]="BRK",this.instname[11]="BVC",this.instname[12]="BVS",this.instname[13]="CLC",this.instname[14]="CLD",this.instname[15]="CLI",this.instname[16]="CLV",this.instname[17]="CMP",this.instname[18]="CPX",this.instname[19]="CPY",this.instname[20]="DEC",this.instname[21]="DEX",this.instname[22]="DEY",this.instname[23]="EOR",this.instname[24]="INC",this.instname[25]="INX",this.instname[26]="INY",this.instname[27]="JMP",this.instname[28]="JSR",this.instname[29]="LDA",this.instname[30]="LDX",this.instname[31]="LDY",this.instname[32]="LSR",this.instname[33]="NOP",this.instname[34]="ORA",this.instname[35]="PHA",this.instname[36]="PHP",this.instname[37]="PLA",this.instname[38]="PLP",this.instname[39]="ROL",this.instname[40]="ROR",this.instname[41]="RTI",this.instname[42]="RTS",this.instname[43]="SBC",this.instname[44]="SEC",this.instname[45]="SED",this.instname[46]="SEI",this.instname[47]="STA",this.instname[48]="STX",this.instname[49]="STY",this.instname[50]="TAX",this.instname[51]="TAY",this.instname[52]="TSX",this.instname[53]="TXA",this.instname[54]="TXS",this.instname[55]="TYA",this.instname[56]="ALR",this.instname[57]="ANC",this.instname[58]="ARR",this.instname[59]="AXS",this.instname[60]="LAX",this.instname[61]="SAX",this.instname[62]="DCP",this.instname[63]="ISC",this.instname[64]="RLA",this.instname[65]="RRA",this.instname[66]="SLO",this.instname[67]="SRE",this.instname[68]="SKB",this.instname[69]="IGN",this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")};s.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_ALR:56,INS_ANC:57,INS_ARR:58,INS_AXS:59,INS_LAX:60,INS_SAX:61,INS_DCP:62,INS_ISC:63,INS_RLA:64,INS_RRA:65,INS_SLO:66,INS_SRE:67,INS_SKB:68,INS_IGN:69,INS_DUMMY:70,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(e,t,i,r,n){this.opdata[t]=255&e|(255&i)<<8|(255&r)<<16|(255&n)<<24}},e.exports=n},520:(e,t,i)=>{e.exports={Controller:i(188),NES:i(744)}},939:(e,t,i)=>{var r=i(610),n={0:function(e){this.nes=e}};n[0].prototype={reset:function(){this.joy1StrobeState=0,this.joy2StrobeState=0,this.joypadLastWrite=0,this.zapperFired=!1,this.zapperX=null,this.zapperY=null},write:function(e,t){e<8192?this.nes.cpu.mem[2047&e]=t:e>16407?(this.nes.cpu.mem[e]=t,e>=24576&&e<32768&&this.nes.opts.onBatteryRamWrite(e,t)):e>8199&&e<16384?this.regWrite(8192+(7&e),t):this.regWrite(e,t)},writelow:function(e,t){e<8192?this.nes.cpu.mem[2047&e]=t:e>16407?this.nes.cpu.mem[e]=t:e>8199&&e<16384?this.regWrite(8192+(7&e),t):this.regWrite(e,t)},load:function(e){return(e&=65535)>16407?this.nes.cpu.mem[e]:e>=8192?this.regLoad(e):this.nes.cpu.mem[2047&e]},regLoad:function(e){switch(e>>12){case 0:case 1:break;case 2:case 3:switch(7&e){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:case 5:case 6:return 0;case 4:return this.nes.ppu.sramLoad();case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(e-16405){case 0:return this.nes.papu.readReg(e);case 1:return this.joy1Read();case 2:var t;return t=null!==this.zapperX&&null!==this.zapperY&&this.nes.ppu.isPixelWhite(this.zapperX,this.zapperY)?0:8,this.zapperFired&&(t|=16),65535&(this.joy2Read()|t)}}return 0},regWrite:function(e,t){switch(e){case 8192:this.nes.cpu.mem[e]=t,this.nes.ppu.updateControlReg1(t);break;case 8193:this.nes.cpu.mem[e]=t,this.nes.ppu.updateControlReg2(t);break;case 8195:this.nes.ppu.writeSRAMAddress(t);break;case 8196:this.nes.ppu.sramWrite(t);break;case 8197:this.nes.ppu.scrollWrite(t);break;case 8198:this.nes.ppu.writeVRAMAddress(t);break;case 8199:this.nes.ppu.vramWrite(t);break;case 16404:this.nes.ppu.sramDMA(t);break;case 16405:case 16407:this.nes.papu.writeReg(e,t);break;case 16406:0==(1&t)&&1==(1&this.joypadLastWrite)&&(this.joy1StrobeState=0,this.joy2StrobeState=0),this.joypadLastWrite=t;break;default:e>=16384&&e<=16407&&this.nes.papu.writeReg(e,t)}},joy1Read:function(){var e;switch(this.joy1StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e=this.nes.controllers[1].state[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:default:e=0;break;case 19:e=1}return this.joy1StrobeState++,24===this.joy1StrobeState&&(this.joy1StrobeState=0),e},joy2Read:function(){var e;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e=this.nes.controllers[2].state[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:default:e=0;break;case 19:e=1}return this.joy2StrobeState++,24===this.joy2StrobeState&&(this.joy2StrobeState=0),e},loadROM:function(){if(!this.nes.rom.valid||this.nes.rom.romCount<1)throw new Error("NoMapper: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},loadPRGROM:function(){this.nes.rom.romCount>1?(this.loadRomBank(0,32768),this.loadRomBank(1,49152)):(this.loadRomBank(0,32768),this.loadRomBank(0,49152))},loadCHRROM:function(){this.nes.rom.vromCount>0&&(1===this.nes.rom.vromCount?(this.loadVromBank(0,0),this.loadVromBank(0,4096)):(this.loadVromBank(0,0),this.loadVromBank(1,4096)))},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var e=this.nes.rom.batteryRam;null!==e&&8192===e.length&&r.copyArrayElements(e,0,this.nes.cpu.mem,24576,8192)}},loadRomBank:function(e,t){e%=this.nes.rom.romCount,r.copyArrayElements(this.nes.rom.rom[e],0,this.nes.cpu.mem,t,16384)},loadVromBank:function(e,t){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering(),r.copyArrayElements(this.nes.rom.vrom[e%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,t,4096);var i=this.nes.rom.vromTile[e%this.nes.rom.vromCount];r.copyArrayElements(i,0,this.nes.ppu.ptTile,t>>4,256)}},load32kRomBank:function(e,t){this.loadRomBank(2*e%this.nes.rom.romCount,t),this.loadRomBank((2*e+1)%this.nes.rom.romCount,t+16384)},load8kVromBank:function(e,t){0!==this.nes.rom.vromCount&&(this.nes.ppu.triggerRendering(),this.loadVromBank(e%this.nes.rom.vromCount,t),this.loadVromBank((e+1)%this.nes.rom.vromCount,t+4096))},load1kVromBank:function(e,t){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(e/4)%this.nes.rom.vromCount,n=e%4*1024;r.copyArrayElements(this.nes.rom.vrom[i],n,this.nes.ppu.vramMem,t,1024);for(var s=this.nes.rom.vromTile[i],o=t>>4,a=0;a<64;a++)this.nes.ppu.ptTile[o+a]=s[(e%4<<6)+a]}},load2kVromBank:function(e,t){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(e/2)%this.nes.rom.vromCount,n=e%2*2048;r.copyArrayElements(this.nes.rom.vrom[i],n,this.nes.ppu.vramMem,t,2048);for(var s=this.nes.rom.vromTile[i],o=t>>4,a=0;a<128;a++)this.nes.ppu.ptTile[o+a]=s[(e%2<<7)+a]}},load8kRomBank:function(e,t){var i=Math.floor(e/2)%this.nes.rom.romCount,n=e%2*8192;r.copyArrayElements(this.nes.rom.rom[i],n,this.nes.cpu.mem,t,8192)},clockIrqCounter:function(){},latchAccess:function(e){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(e){this.joy1StrobeState=e.joy1StrobeState,this.joy2StrobeState=e.joy2StrobeState,this.joypadLastWrite=e.joypadLastWrite}},n[1]=function(e){this.nes=e},n[1].prototype=new n[0],n[1].prototype.reset=function(){n[0].prototype.reset.apply(this),this.regBuffer=0,this.regBufferCounter=0,this.mirroring=0,this.oneScreenMirroring=0,this.prgSwitchingArea=1,this.prgSwitchingSize=1,this.vromSwitchingSize=0,this.romSelectionReg0=0,this.romSelectionReg1=0,this.romBankSelect=0},n[1].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):0!=(128&t)?(this.regBufferCounter=0,this.regBuffer=0,0===this.getRegNumber(e)&&(this.prgSwitchingArea=1,this.prgSwitchingSize=1)):(this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(1&t)<<this.regBufferCounter,this.regBufferCounter++,5===this.regBufferCounter&&(this.setReg(this.getRegNumber(e),this.regBuffer),this.regBuffer=0,this.regBufferCounter=0))},n[1].prototype.setReg=function(e,t){var i;switch(e){case 0:(i=3&t)!==this.mirroring&&(this.mirroring=i,0==(2&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING):0!=(1&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)),this.prgSwitchingArea=t>>2&1,this.prgSwitchingSize=t>>3&1,this.vromSwitchingSize=t>>4&1;break;case 1:this.romSelectionReg0=t>>4&1,this.nes.rom.vromCount>0&&(0===this.vromSwitchingSize?0===this.romSelectionReg0?this.load8kVromBank(15&t,0):this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&t),0):0===this.romSelectionReg0?this.loadVromBank(15&t,0):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&t),0));break;case 2:this.romSelectionReg1=t>>4&1,this.nes.rom.vromCount>0&&1===this.vromSwitchingSize&&(0===this.romSelectionReg1?this.loadVromBank(15&t,4096):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&t),4096));break;default:var r;i=15&t;var n=0;this.nes.rom.romCount>=32?0===this.vromSwitchingSize?1===this.romSelectionReg0&&(n=16):n=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3:this.nes.rom.romCount>=16&&1===this.romSelectionReg0&&(n=8),0===this.prgSwitchingSize?(r=n+(15&t),this.load32kRomBank(r,32768)):(r=2*n+(15&t),0===this.prgSwitchingArea?this.loadRomBank(r,49152):this.loadRomBank(r,32768))}},n[1].prototype.getRegNumber=function(e){return e>=32768&&e<=40959?0:e>=40960&&e<=49151?1:e>=49152&&e<=57343?2:3},n[1].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC1: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[1].prototype.switchLowHighPrgRom=function(e){},n[1].prototype.switch16to32=function(){},n[1].prototype.switch32to16=function(){},n[1].prototype.toJSON=function(){var e=n[0].prototype.toJSON.apply(this);return e.mirroring=this.mirroring,e.oneScreenMirroring=this.oneScreenMirroring,e.prgSwitchingArea=this.prgSwitchingArea,e.prgSwitchingSize=this.prgSwitchingSize,e.vromSwitchingSize=this.vromSwitchingSize,e.romSelectionReg0=this.romSelectionReg0,e.romSelectionReg1=this.romSelectionReg1,e.romBankSelect=this.romBankSelect,e.regBuffer=this.regBuffer,e.regBufferCounter=this.regBufferCounter,e},n[1].prototype.fromJSON=function(e){n[0].prototype.fromJSON.apply(this,arguments),this.mirroring=e.mirroring,this.oneScreenMirroring=e.oneScreenMirroring,this.prgSwitchingArea=e.prgSwitchingArea,this.prgSwitchingSize=e.prgSwitchingSize,this.vromSwitchingSize=e.vromSwitchingSize,this.romSelectionReg0=e.romSelectionReg0,this.romSelectionReg1=e.romSelectionReg1,this.romBankSelect=e.romBankSelect,this.regBuffer=e.regBuffer,this.regBufferCounter=e.regBufferCounter},n[2]=function(e){this.nes=e},n[2].prototype=new n[0],n[2].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):this.loadRomBank(t,32768)},n[2].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[3]=function(e){this.nes=e},n[3].prototype=new n[0],n[3].prototype.write=function(e,t){if(e<32768)n[0].prototype.write.apply(this,arguments);else{var i=t%(this.nes.rom.vromCount/2)*2;this.loadVromBank(i,0),this.loadVromBank(i+1,4096),this.load8kVromBank(2*t,0)}},n[4]=function(e){this.nes=e,this.CMD_SEL_2_1K_VROM_0000=0,this.CMD_SEL_2_1K_VROM_0800=1,this.CMD_SEL_1K_VROM_1000=2,this.CMD_SEL_1K_VROM_1400=3,this.CMD_SEL_1K_VROM_1800=4,this.CMD_SEL_1K_VROM_1C00=5,this.CMD_SEL_ROM_PAGE1=6,this.CMD_SEL_ROM_PAGE2=7,this.command=null,this.prgAddressSelect=null,this.chrAddressSelect=null,this.pageNumber=null,this.irqCounter=null,this.irqLatchValue=null,this.irqEnable=null,this.prgAddressChanged=!1},n[4].prototype=new n[0],n[4].prototype.write=function(e,t){if(e<32768)n[0].prototype.write.apply(this,arguments);else switch(e){case 32768:this.command=7&t;var i=t>>6&1;i!==this.prgAddressSelect&&(this.prgAddressChanged=!0),this.prgAddressSelect=i,this.chrAddressSelect=t>>7&1;break;case 32769:this.executeCommand(this.command,t);break;case 40960:0!=(1&t)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING);break;case 40961:break;case 49152:this.irqCounter=t;break;case 49153:this.irqLatchValue=t;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1}},n[4].prototype.executeCommand=function(e,t){switch(e){case this.CMD_SEL_2_1K_VROM_0000:0===this.chrAddressSelect?(this.load1kVromBank(t,0),this.load1kVromBank(t+1,1024)):(this.load1kVromBank(t,4096),this.load1kVromBank(t+1,5120));break;case this.CMD_SEL_2_1K_VROM_0800:0===this.chrAddressSelect?(this.load1kVromBank(t,2048),this.load1kVromBank(t+1,3072)):(this.load1kVromBank(t,6144),this.load1kVromBank(t+1,7168));break;case this.CMD_SEL_1K_VROM_1000:0===this.chrAddressSelect?this.load1kVromBank(t,4096):this.load1kVromBank(t,0);break;case this.CMD_SEL_1K_VROM_1400:0===this.chrAddressSelect?this.load1kVromBank(t,5120):this.load1kVromBank(t,1024);break;case this.CMD_SEL_1K_VROM_1800:0===this.chrAddressSelect?this.load1kVromBank(t,6144):this.load1kVromBank(t,2048);break;case this.CMD_SEL_1K_VROM_1C00:0===this.chrAddressSelect?this.load1kVromBank(t,7168):this.load1kVromBank(t,3072);break;case this.CMD_SEL_ROM_PAGE1:this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1),0===this.prgAddressSelect?this.load8kRomBank(t,32768):this.load8kRomBank(t,49152);break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(t,40960),this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1)}},n[4].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC3: Invalid ROM! Unable to load.");this.load8kRomBank(2*(this.nes.rom.romCount-1),49152),this.load8kRomBank(2*(this.nes.rom.romCount-1)+1,57344),this.load8kRomBank(0,32768),this.load8kRomBank(1,40960),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[4].prototype.clockIrqCounter=function(){1===this.irqEnable&&(this.irqCounter--,this.irqCounter<0&&(this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.irqCounter=this.irqLatchValue))},n[4].prototype.toJSON=function(){var e=n[0].prototype.toJSON.apply(this);return e.command=this.command,e.prgAddressSelect=this.prgAddressSelect,e.chrAddressSelect=this.chrAddressSelect,e.pageNumber=this.pageNumber,e.irqCounter=this.irqCounter,e.irqLatchValue=this.irqLatchValue,e.irqEnable=this.irqEnable,e.prgAddressChanged=this.prgAddressChanged,e},n[4].prototype.fromJSON=function(e){n[0].prototype.fromJSON.apply(this,arguments),this.command=e.command,this.prgAddressSelect=e.prgAddressSelect,this.chrAddressSelect=e.chrAddressSelect,this.pageNumber=e.pageNumber,this.irqCounter=e.irqCounter,this.irqLatchValue=e.irqLatchValue,this.irqEnable=e.irqEnable,this.prgAddressChanged=e.prgAddressChanged},n[5]=function(e){this.nes=e},n[5].prototype=new n[0],n[5].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):this.load8kVromBank(t,0)},n[5].prototype.write=function(e,t){if(e<20480)n[0].prototype.write.apply(this,arguments);else switch(e){case 20736:this.prg_size=3&t;break;case 20737:this.chr_size=3&t;break;case 20738:this.sram_we_a=3&t;break;case 20739:this.sram_we_b=3&t;break;case 20740:this.graphic_mode=3&t;break;case 20741:this.nametable_mode=t,this.nametable_type[0]=3&t,this.load1kVromBank(3&t,8192),t>>=2,this.nametable_type[1]=3&t,this.load1kVromBank(3&t,9216),t>>=2,this.nametable_type[2]=3&t,this.load1kVromBank(3&t,10240),t>>=2,this.nametable_type[3]=3&t,this.load1kVromBank(3&t,11264);break;case 20742:this.fill_chr=t;break;case 20743:this.fill_pal=3&t;break;case 20755:this.SetBank_SRAM(3,3&t);break;case 20756:case 20757:case 20758:case 20759:this.SetBank_CPU(e,t);break;case 20768:case 20769:case 20770:case 20771:case 20772:case 20773:case 20774:case 20775:this.chr_mode=0,this.chr_page[0][7&e]=t,this.SetBank_PPU();break;case 20776:case 20777:case 20778:case 20779:this.chr_mode=1,this.chr_page[1][0+(3&e)]=t,this.chr_page[1][4+(3&e)]=t,this.SetBank_PPU();break;case 20992:this.split_control=t;break;case 20993:this.split_scroll=t;break;case 20994:this.split_page=63&t;break;case 20995:this.irq_line=t,this.nes.cpu.ClearIRQ();break;case 20996:this.irq_enable=t,this.nes.cpu.ClearIRQ();break;case 20997:this.mult_a=t;break;case 20998:this.mult_b=t;break;default:e>=20480&&e<=20501?this.nes.papu.exWrite(e,t):e>=23552&&e<=24575?2===this.graphic_mode||3!==this.graphic_mode&&this.irq_status:e>=24576&&e<=32767&&2===this.sram_we_a&&this.sram_we_b}},n[5].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.load8kRomBank(2*this.nes.rom.romCount-1,32768),this.load8kRomBank(2*this.nes.rom.romCount-1,40960),this.load8kRomBank(2*this.nes.rom.romCount-1,49152),this.load8kRomBank(2*this.nes.rom.romCount-1,57344),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[7]=function(e){this.nes=e},n[7].prototype=new n[0],n[7].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):(this.load32kRomBank(7&t,32768),16&t?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING2):this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING))},n[7].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("AOROM: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[11]=function(e){this.nes=e},n[11].prototype=new n[0],n[11].prototype.write=function(e,t){if(e<32768)n[0].prototype.write.apply(this,arguments);else{var i=2*(15&t)%this.nes.rom.romCount,r=(2*(15&t)+1)%this.nes.rom.romCount;if(this.loadRomBank(i,32768),this.loadRomBank(r,49152),this.nes.rom.vromCount>0){var s=2*(t>>4)%this.nes.rom.vromCount;this.loadVromBank(s,0),this.loadVromBank(s+1,4096)}}},n[34]=function(e){this.nes=e},n[34].prototype=new n[0],n[34].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):this.load32kRomBank(t,32768)},n[38]=function(e){this.nes=e},n[38].prototype=new n[0],n[38].prototype.write=function(e,t){e<28672||e>32767?n[0].prototype.write.apply(this,arguments):(this.load32kRomBank(3&t,32768),this.load8kVromBank(2*(t>>2&3),0))},n[66]=function(e){this.nes=e},n[66].prototype=new n[0],n[66].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):(this.load32kRomBank(t>>4&3,32768),this.load8kVromBank(2*(3&t),0))},n[94]=function(e){this.nes=e},n[94].prototype=new n[0],n[94].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):this.loadRomBank(t>>2,32768)},n[94].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UN1ROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[140]=function(e){this.nes=e},n[140].prototype=new n[0],n[140].prototype.write=function(e,t){e<24576||e>32767?n[0].prototype.write.apply(this,arguments):(this.load32kRomBank(t>>4&3,32768),this.load8kVromBank(2*(15&t),0))},n[180]=function(e){this.nes=e},n[180].prototype=new n[0],n[180].prototype.write=function(e,t){e<32768?n[0].prototype.write.apply(this,arguments):this.loadRomBank(t,49152)},n[180].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("Mapper 180: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},e.exports=n},744:(e,t,i)=>{var r=i(990),n=i(188),s=i(321),o=i(306),a=i(471),c=function(e){var t;if(this.opts={onFrame:function(){},onAudioSample:null,onStatusUpdate:function(){},onBatteryRamWrite:function(){},preferredFrameRate:60,emulateSound:!0,sampleRate:44100},void 0!==e)for(t in this.opts)void 0!==e[t]&&(this.opts[t]=e[t]);this.frameTime=1e3/this.opts.preferredFrameRate,this.ui={writeFrame:this.opts.onFrame,updateStatus:this.opts.onStatusUpdate},this.cpu=new r(this),this.ppu=new s(this),this.papu=new o(this),this.mmap=null,this.controllers={1:new n,2:new n},this.ui.updateStatus("Ready to load a ROM."),this.frame=this.frame.bind(this),this.buttonDown=this.buttonDown.bind(this),this.buttonUp=this.buttonUp.bind(this),this.zapperMove=this.zapperMove.bind(this),this.zapperFireDown=this.zapperFireDown.bind(this),this.zapperFireUp=this.zapperFireUp.bind(this)};c.prototype={fpsFrameCount:0,romData:null,reset:function(){null!==this.mmap&&this.mmap.reset(),this.cpu.reset(),this.ppu.reset(),this.papu.reset(),this.lastFpsTime=null,this.fpsFrameCount=0},frame:function(){this.ppu.startFrame();var e=0,t=this.opts.emulateSound,i=this.cpu,r=this.ppu,n=this.papu;e:for(;;)for(0===i.cyclesToHalt?(e=i.emulate(),t&&n.clockFrameCounter(e),e*=3):i.cyclesToHalt>8?(e=24,t&&n.clockFrameCounter(8),i.cyclesToHalt-=8):(e=3*i.cyclesToHalt,t&&n.clockFrameCounter(i.cyclesToHalt),i.cyclesToHalt=0);e>0;e--){if(r.curX===r.spr0HitX&&1===r.f_spVisibility&&r.scanline-21===r.spr0HitY&&r.setStatusFlag(r.STATUS_SPRITE0HIT,!0),r.requestEndFrame&&(r.nmiCounter--,0===r.nmiCounter)){r.requestEndFrame=!1,r.startVBlank();break e}r.curX++,341===r.curX&&(r.curX=0,r.endScanline())}this.fpsFrameCount++},buttonDown:function(e,t){this.controllers[e].buttonDown(t)},buttonUp:function(e,t){this.controllers[e].buttonUp(t)},zapperMove:function(e,t){this.mmap&&(this.mmap.zapperX=e,this.mmap.zapperY=t)},zapperFireDown:function(){this.mmap&&(this.mmap.zapperFired=!0)},zapperFireUp:function(){this.mmap&&(this.mmap.zapperFired=!1)},getFPS:function(){var e=+new Date,t=null;return this.lastFpsTime&&(t=this.fpsFrameCount/((e-this.lastFpsTime)/1e3)),this.fpsFrameCount=0,this.lastFpsTime=e,t},reloadROM:function(){null!==this.romData&&this.loadROM(this.romData)},loadROM:function(e){this.rom=new a(this),this.rom.load(e),this.reset(),this.mmap=this.rom.createMapper(),this.mmap.loadROM(),this.ppu.setMirroring(this.rom.getMirroringType()),this.romData=e},setFramerate:function(e){this.opts.preferredFrameRate=e,this.frameTime=1e3/e,this.papu.setSampleRate(this.opts.sampleRate,!1)},toJSON:function(){return{romData:this.romData,cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON()}},fromJSON:function(e){this.loadROM(e.romData),this.cpu.fromJSON(e.cpu),this.mmap.fromJSON(e.mmap),this.ppu.fromJSON(e.ppu)}},e.exports=c},306:e=>{var t=function(e){this.nes=e,this.square1=new n(this,!0),this.square2=new n(this,!1),this.triangle=new s(this),this.noise=new r(this),this.dmc=new i(this),this.frameIrqCounter=null,this.frameIrqCounterMax=4,this.initCounter=2048,this.channelEnableValue=null,this.sampleRate=44100,this.lengthLookup=null,this.dmcFreqLookup=null,this.noiseWavelengthLookup=null,this.square_table=null,this.tnd_table=null,this.frameIrqEnabled=!1,this.frameIrqActive=null,this.frameClockNow=null,this.startedPlaying=!1,this.recordOutput=!1,this.initingHardware=!1,this.masterFrameCounter=null,this.derivedFrameCounter=null,this.countSequence=null,this.sampleTimer=null,this.frameTime=null,this.sampleTimerMax=null,this.sampleCount=null,this.triValue=0,this.smpSquare1=null,this.smpSquare2=null,this.smpTriangle=null,this.smpDmc=null,this.accCount=null,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.dacRange=0,this.dcValue=0,this.masterVolume=256,this.stereoPosLSquare1=null,this.stereoPosLSquare2=null,this.stereoPosLTriangle=null,this.stereoPosLNoise=null,this.stereoPosLDMC=null,this.stereoPosRSquare1=null,this.stereoPosRSquare2=null,this.stereoPosRTriangle=null,this.stereoPosRNoise=null,this.stereoPosRDMC=null,this.extraCycles=null,this.maxSample=null,this.minSample=null,this.panning=[80,170,100,150,128],this.setPanning(this.panning),this.initLengthLookup(),this.initDmcFrequencyLookup(),this.initNoiseWavelengthLookup(),this.initDACtables();for(var t=0;t<20;t++)16===t?this.writeReg(16400,16):this.writeReg(16384+t,0);this.reset()};t.prototype={reset:function(){this.sampleRate=this.nes.opts.sampleRate,this.sampleTimerMax=Math.floor(1832727040*this.nes.opts.preferredFrameRate/(60*this.sampleRate)),this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60),this.sampleTimer=0,this.updateChannelEnable(0),this.masterFrameCounter=0,this.derivedFrameCounter=0,this.countSequence=0,this.sampleCount=0,this.initCounter=2048,this.frameIrqEnabled=!1,this.initingHardware=!1,this.resetCounter(),this.square1.reset(),this.square2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.accCount=0,this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0,this.frameIrqEnabled=!1,this.frameIrqCounterMax=4,this.channelEnableValue=255,this.startedPlaying=!1,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.maxSample=-5e5,this.minSample=5e5},readReg:function(e){var t=0;return t|=this.square1.getLengthStatus(),t|=this.square2.getLengthStatus()<<1,t|=this.triangle.getLengthStatus()<<2,t|=this.noise.getLengthStatus()<<3,t|=this.dmc.getLengthStatus()<<4,t|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6,t|=this.dmc.getIrqStatus()<<7,this.frameIrqActive=!1,this.dmc.irqGenerated=!1,65535&t},writeReg:function(e,t){e>=16384&&e<16388?this.square1.writeReg(e,t):e>=16388&&e<16392?this.square2.writeReg(e,t):e>=16392&&e<16396?this.triangle.writeReg(e,t):e>=16396&&e<=16399?this.noise.writeReg(e,t):16400===e||16401===e||16402===e||16403===e?this.dmc.writeReg(e,t):16405===e?(this.updateChannelEnable(t),0!==t&&this.initCounter>0&&(this.initingHardware=!0),this.dmc.writeReg(e,t)):16407===e&&(this.countSequence=t>>7&1,this.masterFrameCounter=0,this.frameIrqActive=!1,this.frameIrqEnabled=0==(t>>6&1),0===this.countSequence?(this.frameIrqCounterMax=4,this.derivedFrameCounter=4):(this.frameIrqCounterMax=5,this.derivedFrameCounter=0,this.frameCounterTick()))},resetCounter:function(){0===this.countSequence?this.derivedFrameCounter=4:this.derivedFrameCounter=0},updateChannelEnable:function(e){this.channelEnableValue=65535&e,this.square1.setEnabled(0!=(1&e)),this.square2.setEnabled(0!=(2&e)),this.triangle.setEnabled(0!=(4&e)),this.noise.setEnabled(0!=(8&e)),this.dmc.setEnabled(0!=(16&e))},clockFrameCounter:function(e){if(this.initCounter>0&&this.initingHardware)return this.initCounter-=e,void(this.initCounter<=0&&(this.initingHardware=!1));e+=this.extraCycles;var t=this.sampleTimerMax-this.sampleTimer;e<<10>t?(this.extraCycles=(e<<10)-t>>10,e-=this.extraCycles):this.extraCycles=0;var i=this.dmc,r=this.triangle,n=this.square1,s=this.square2,o=this.noise;if(i.isEnabled)for(i.shiftCounter-=e<<3;i.shiftCounter<=0&&i.dmaFrequency>0;)i.shiftCounter+=i.dmaFrequency,i.clockDmc();if(r.progTimerMax>0)for(r.progTimerCount-=e;r.progTimerCount<=0;)r.progTimerCount+=r.progTimerMax+1,r.linearCounter>0&&r.lengthCounter>0&&(r.triangleCounter++,r.triangleCounter&=31,r.isEnabled&&(r.triangleCounter>=16?r.sampleValue=15&r.triangleCounter:r.sampleValue=15-(15&r.triangleCounter),r.sampleValue<<=4));n.progTimerCount-=e,n.progTimerCount<=0&&(n.progTimerCount+=n.progTimerMax+1<<1,n.squareCounter++,n.squareCounter&=7,n.updateSampleValue()),s.progTimerCount-=e,s.progTimerCount<=0&&(s.progTimerCount+=s.progTimerMax+1<<1,s.squareCounter++,s.squareCounter&=7,s.updateSampleValue());var a=e;if(o.progTimerCount-a>0)o.progTimerCount-=a,o.accCount+=a,o.accValue+=a*o.sampleValue;else for(;a-- >0;)--o.progTimerCount<=0&&o.progTimerMax>0&&(o.shiftReg<<=1,o.tmp=32768&(o.shiftReg<<(0===o.randomMode?1:6)^o.shiftReg),0!==o.tmp?(o.shiftReg|=1,o.randomBit=0,o.sampleValue=0):(o.randomBit=1,o.isEnabled&&o.lengthCounter>0?o.sampleValue=o.masterVolume:o.sampleValue=0),o.progTimerCount+=o.progTimerMax),o.accValue+=o.sampleValue,o.accCount++;this.frameIrqEnabled&&this.frameIrqActive&&this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.masterFrameCounter+=e<<1,this.masterFrameCounter>=this.frameTime&&(this.masterFrameCounter-=this.frameTime,this.frameCounterTick()),this.accSample(e),this.sampleTimer+=e<<10,this.sampleTimer>=this.sampleTimerMax&&(this.sample(),this.sampleTimer-=this.sampleTimerMax)},accSample:function(e){this.triangle.sampleCondition&&(this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1)),this.triValue>16&&(this.triValue=16),this.triangle.triangleCounter>=16&&(this.triValue=16-this.triValue),this.triValue+=this.triangle.sampleValue),2===e?(this.smpTriangle+=this.triValue<<1,this.smpDmc+=this.dmc.sample<<1,this.smpSquare1+=this.square1.sampleValue<<1,this.smpSquare2+=this.square2.sampleValue<<1,this.accCount+=2):4===e?(this.smpTriangle+=this.triValue<<2,this.smpDmc+=this.dmc.sample<<2,this.smpSquare1+=this.square1.sampleValue<<2,this.smpSquare2+=this.square2.sampleValue<<2,this.accCount+=4):(this.smpTriangle+=e*this.triValue,this.smpDmc+=e*this.dmc.sample,this.smpSquare1+=e*this.square1.sampleValue,this.smpSquare2+=e*this.square2.sampleValue,this.accCount+=e)},frameCounterTick:function(){this.derivedFrameCounter++,this.derivedFrameCounter>=this.frameIrqCounterMax&&(this.derivedFrameCounter=0),1!==this.derivedFrameCounter&&3!==this.derivedFrameCounter||(this.triangle.clockLengthCounter(),this.square1.clockLengthCounter(),this.square2.clockLengthCounter(),this.noise.clockLengthCounter(),this.square1.clockSweep(),this.square2.clockSweep()),this.derivedFrameCounter>=0&&this.derivedFrameCounter<4&&(this.square1.clockEnvDecay(),this.square2.clockEnvDecay(),this.noise.clockEnvDecay(),this.triangle.clockLinearCounter()),3===this.derivedFrameCounter&&0===this.countSequence&&(this.frameIrqActive=!0)},sample:function(){var e,t;this.accCount>0?(this.smpSquare1<<=4,this.smpSquare1=Math.floor(this.smpSquare1/this.accCount),this.smpSquare2<<=4,this.smpSquare2=Math.floor(this.smpSquare2/this.accCount),this.smpTriangle=Math.floor(this.smpTriangle/this.accCount),this.smpDmc<<=4,this.smpDmc=Math.floor(this.smpDmc/this.accCount),this.accCount=0):(this.smpSquare1=this.square1.sampleValue<<4,this.smpSquare2=this.square2.sampleValue<<4,this.smpTriangle=this.triangle.sampleValue,this.smpDmc=this.dmc.sample<<4);var i=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=i>>4,this.noise.accCount=1,e=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8,t=3*this.smpTriangle*this.stereoPosLTriangle+(i<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8,e>=this.square_table.length&&(e=this.square_table.length-1),t>=this.tnd_table.length&&(t=this.tnd_table.length-1);var r=this.square_table[e]+this.tnd_table[t]-this.dcValue;e=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8,t=3*this.smpTriangle*this.stereoPosRTriangle+(i<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8,e>=this.square_table.length&&(e=this.square_table.length-1),t>=this.tnd_table.length&&(t=this.tnd_table.length-1);var n=this.square_table[e]+this.tnd_table[t]-this.dcValue,s=r-this.prevSampleL;this.prevSampleL+=s,this.smpAccumL+=s-(this.smpAccumL>>10),r=this.smpAccumL;var o=n-this.prevSampleR;this.prevSampleR+=o,this.smpAccumR+=o-(this.smpAccumR>>10),n=this.smpAccumR,r>this.maxSample&&(this.maxSample=r),r<this.minSample&&(this.minSample=r),this.nes.opts.onAudioSample&&this.nes.opts.onAudioSample(r/32768,n/32768),this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0},getLengthMax:function(e){return this.lengthLookup[e>>3]},getDmcFrequency:function(e){return e>=0&&e<16?this.dmcFreqLookup[e]:0},getNoiseWaveLength:function(e){return e>=0&&e<16?this.noiseWavelengthLookup[e]:0},setPanning:function(e){for(var t=0;t<5;t++)this.panning[t]=e[t];this.updateStereoPos()},setMasterVolume:function(e){e<0&&(e=0),e>256&&(e=256),this.masterVolume=e,this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8,this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8,this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8,this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8,this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8,this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1,this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2,this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle,this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise,this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16),this.dmcFreqLookup[0]=3424,this.dmcFreqLookup[1]=3040,this.dmcFreqLookup[2]=2720,this.dmcFreqLookup[3]=2560,this.dmcFreqLookup[4]=2288,this.dmcFreqLookup[5]=2032,this.dmcFreqLookup[6]=1808,this.dmcFreqLookup[7]=1712,this.dmcFreqLookup[8]=1520,this.dmcFreqLookup[9]=1280,this.dmcFreqLookup[10]=1136,this.dmcFreqLookup[11]=1024,this.dmcFreqLookup[12]=848,this.dmcFreqLookup[13]=672,this.dmcFreqLookup[14]=576,this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16),this.noiseWavelengthLookup[0]=4,this.noiseWavelengthLookup[1]=8,this.noiseWavelengthLookup[2]=16,this.noiseWavelengthLookup[3]=32,this.noiseWavelengthLookup[4]=64,this.noiseWavelengthLookup[5]=96,this.noiseWavelengthLookup[6]=128,this.noiseWavelengthLookup[7]=160,this.noiseWavelengthLookup[8]=202,this.noiseWavelengthLookup[9]=254,this.noiseWavelengthLookup[10]=380,this.noiseWavelengthLookup[11]=508,this.noiseWavelengthLookup[12]=762,this.noiseWavelengthLookup[13]=1016,this.noiseWavelengthLookup[14]=2034,this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var e,t,i,r=0,n=0;for(this.square_table=new Array(512),this.tnd_table=new Array(3264),i=0;i<512;i++)e=95.52/(8128/(i/16)+100),e*=.98411,e*=5e4,t=Math.floor(e),this.square_table[i]=t,t>r&&(r=t);for(i=0;i<3264;i++)e=163.67/(24329/(i/16)+100),e*=.98411,e*=5e4,t=Math.floor(e),this.tnd_table[i]=t,t>n&&(n=t);this.dacRange=r+n,this.dcValue=this.dacRange/2}};var i=function(e){this.papu=e,this.MODE_NORMAL=0,this.MODE_LOOP=1,this.MODE_IRQ=2,this.isEnabled=null,this.hasSample=null,this.irqGenerated=!1,this.playMode=null,this.dmaFrequency=null,this.dmaCounter=null,this.deltaCounter=null,this.playStartAddress=null,this.playAddress=null,this.playLength=null,this.playLengthCounter=null,this.shiftCounter=null,this.reg4012=null,this.reg4013=null,this.sample=null,this.dacLsb=null,this.data=null,this.reset()};i.prototype={clockDmc:function(){this.hasSample&&(0==(1&this.data)?this.deltaCounter>0&&this.deltaCounter--:this.deltaCounter<63&&this.deltaCounter++,this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0,this.data>>=1),this.dmaCounter--,this.dmaCounter<=0&&(this.hasSample=!1,this.endOfSample(),this.dmaCounter=8),this.irqGenerated&&this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)},endOfSample:function(){0===this.playLengthCounter&&this.playMode===this.MODE_LOOP&&(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.playLengthCounter>0&&(this.nextSample(),0===this.playLengthCounter&&this.playMode===this.MODE_IRQ&&(this.irqGenerated=!0))},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress),this.papu.nes.cpu.haltCycles(4),this.playLengthCounter--,this.playAddress++,this.playAddress>65535&&(this.playAddress=32768),this.hasSample=!0},writeReg:function(e,t){16400===e?(t>>6==0?this.playMode=this.MODE_NORMAL:1==(t>>6&1)?this.playMode=this.MODE_LOOP:t>>6==2&&(this.playMode=this.MODE_IRQ),0==(128&t)&&(this.irqGenerated=!1),this.dmaFrequency=this.papu.getDmcFrequency(15&t)):16401===e?(this.deltaCounter=t>>1&63,this.dacLsb=1&t,this.sample=(this.deltaCounter<<1)+this.dacLsb):16402===e?(this.playStartAddress=t<<6|49152,this.playAddress=this.playStartAddress,this.reg4012=t):16403===e?(this.playLength=1+(t<<4),this.playLengthCounter=this.playLength,this.reg4013=t):16405===e&&(0==(t>>4&1)?this.playLengthCounter=0:(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.irqGenerated=!1)},setEnabled:function(e){!this.isEnabled&&e&&(this.playLengthCounter=this.playLength),this.isEnabled=e},getLengthStatus:function(){return 0!==this.playLengthCounter&&this.isEnabled?1:0},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=!1,this.irqGenerated=!1,this.playMode=this.MODE_NORMAL,this.dmaFrequency=0,this.dmaCounter=0,this.deltaCounter=0,this.playStartAddress=0,this.playAddress=0,this.playLength=0,this.playLengthCounter=0,this.sample=0,this.dacLsb=0,this.shiftCounter=0,this.reg4012=0,this.reg4013=0,this.data=0}};var r=function(e){this.papu=e,this.isEnabled=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.lengthCounterEnable=null,this.envReset=null,this.shiftNow=null,this.lengthCounter=null,this.progTimerCount=null,this.progTimerMax=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.shiftReg=16384,this.randomBit=null,this.randomMode=null,this.sampleValue=null,this.accValue=0,this.accCount=1,this.tmp=null,this.reset()};r.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.isEnabled=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1,this.shiftNow=!1,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.shiftReg=1,this.randomBit=0,this.randomMode=0,this.sampleValue=0,this.tmp=0},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&(this.sampleValue=this.randomBit*this.masterVolume)},writeReg:function(e,t){16396===e?(this.envDecayDisable=0!=(16&t),this.envDecayRate=15&t,this.envDecayLoopEnable=0!=(32&t),this.lengthCounterEnable=0==(32&t),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume):16398===e?(this.progTimerMax=this.papu.getNoiseWaveLength(15&t),this.randomMode=t>>7):16399===e&&(this.lengthCounter=this.papu.getLengthMax(248&t),this.envReset=!0)},setEnabled:function(e){this.isEnabled=e,e||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}};var n=function(e,t){this.papu=e,this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1],this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0],this.sqr1=t,this.isEnabled=null,this.lengthCounterEnable=null,this.sweepActive=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.envReset=null,this.sweepCarry=null,this.updateSweepPeriod=null,this.progTimerCount=null,this.progTimerMax=null,this.lengthCounter=null,this.squareCounter=null,this.sweepCounter=null,this.sweepCounterMax=null,this.sweepMode=null,this.sweepShiftAmount=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.dutyMode=null,this.sweepResult=null,this.sampleValue=null,this.vol=null,this.reset()};n.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.lengthCounter=0,this.squareCounter=0,this.sweepCounter=0,this.sweepCounterMax=0,this.sweepMode=0,this.sweepShiftAmount=0,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.dutyMode=0,this.vol=0,this.isEnabled=!1,this.lengthCounterEnable=!1,this.sweepActive=!1,this.sweepCarry=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},clockSweep:function(){--this.sweepCounter<=0&&(this.sweepCounter=this.sweepCounterMax+1,this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7&&(this.sweepCarry=!1,0===this.sweepMode?(this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount,this.progTimerMax>4095&&(this.progTimerMax=4095,this.sweepCarry=!0)):this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0)))),this.updateSweepPeriod&&(this.updateSweepPeriod=!1,this.sweepCounter=this.sweepCounterMax+1)},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7?0===this.sweepMode&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095?this.sampleValue=0:this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]:this.sampleValue=0},writeReg:function(e,t){var i=this.sqr1?0:4;e===16384+i?(this.envDecayDisable=0!=(16&t),this.envDecayRate=15&t,this.envDecayLoopEnable=0!=(32&t),this.dutyMode=t>>6&3,this.lengthCounterEnable=0==(32&t),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()):e===16385+i?(this.sweepActive=0!=(128&t),this.sweepCounterMax=t>>4&7,this.sweepMode=t>>3&1,this.sweepShiftAmount=7&t,this.updateSweepPeriod=!0):e===16386+i?(this.progTimerMax&=1792,this.progTimerMax|=t):e===16387+i&&(this.progTimerMax&=255,this.progTimerMax|=(7&t)<<8,this.isEnabled&&(this.lengthCounter=this.papu.getLengthMax(248&t)),this.envReset=!0)},setEnabled:function(e){this.isEnabled=e,e||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}};var s=function(e){this.papu=e,this.isEnabled=null,this.sampleCondition=null,this.lengthCounterEnable=null,this.lcHalt=null,this.lcControl=null,this.progTimerCount=null,this.progTimerMax=null,this.triangleCounter=null,this.lengthCounter=null,this.linearCounter=null,this.lcLoadValue=null,this.sampleValue=null,this.tmp=null,this.reset()};s.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.triangleCounter=0,this.isEnabled=!1,this.sampleCondition=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.linearCounter=0,this.lcLoadValue=0,this.lcHalt=!0,this.lcControl=!1,this.tmp=0,this.sampleValue=15},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleCondition())},clockLinearCounter:function(){this.lcHalt?(this.linearCounter=this.lcLoadValue,this.updateSampleCondition()):this.linearCounter>0&&(this.linearCounter--,this.updateSampleCondition()),this.lcControl||(this.lcHalt=!1)},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},readReg:function(e){return 0},writeReg:function(e,t){16392===e?(this.lcControl=0!=(128&t),this.lcLoadValue=127&t,this.lengthCounterEnable=!this.lcControl):16394===e?(this.progTimerMax&=1792,this.progTimerMax|=t):16395===e&&(this.progTimerMax&=255,this.progTimerMax|=(7&t)<<8,this.lengthCounter=this.papu.getLengthMax(248&t),this.lcHalt=!0),this.updateSampleCondition()},clockProgrammableTimer:function(e){if(this.progTimerMax>0)for(this.progTimerCount+=e;this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax;)this.progTimerCount-=this.progTimerMax,this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0&&this.clockTriangleGenerator()},clockTriangleGenerator:function(){this.triangleCounter++,this.triangleCounter&=31},setEnabled:function(e){this.isEnabled=e,e||(this.lengthCounter=0),this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0}},e.exports=t},321:(e,t,i)=>{var r=i(361),n=i(610),s=function(e){this.nes=e,this.vramMem=null,this.spriteMem=null,this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=null,this.firstWrite=null,this.sramAddress=null,this.currentMirroring=null,this.requestEndFrame=null,this.nmiOk=null,this.dummyCycleToggle=null,this.validTileData=null,this.nmiCounter=null,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=null,this.f_spriteSize=null,this.f_bgPatternTable=null,this.f_spPatternTable=null,this.f_addrInc=null,this.f_nTblAddress=null,this.f_color=null,this.f_spVisibility=null,this.f_bgVisibility=null,this.f_spClipping=null,this.f_bgClipping=null,this.f_dispType=null,this.cntFV=null,this.cntV=null,this.cntH=null,this.cntVT=null,this.cntHT=null,this.regFV=null,this.regV=null,this.regH=null,this.regVT=null,this.regHT=null,this.regFH=null,this.regS=null,this.curNt=null,this.attrib=null,this.buffer=null,this.bgbuffer=null,this.pixrendered=null,this.validTileData=null,this.scantile=null,this.scanline=null,this.lastRenderedScanline=null,this.curX=null,this.sprX=null,this.sprY=null,this.sprTile=null,this.sprCol=null,this.vertFlip=null,this.horiFlip=null,this.bgPriority=null,this.spr0HitX=null,this.spr0HitY=null,this.hitSpr0=null,this.sprPalette=null,this.imgPalette=null,this.ptTile=null,this.ntable1=null,this.currentMirroring=null,this.nameTable=null,this.vramMirrorTable=null,this.palTable=null,this.showSpr0Hit=!1,this.clipToTvSize=!0,this.reset()};s.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var e;for(this.vramMem=new Array(32768),this.spriteMem=new Array(256),e=0;e<this.vramMem.length;e++)this.vramMem[e]=0;for(e=0;e<this.spriteMem.length;e++)this.spriteMem[e]=0;for(this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=0,this.firstWrite=!0,this.sramAddress=0,this.currentMirroring=-1,this.requestEndFrame=!1,this.nmiOk=!1,this.dummyCycleToggle=!1,this.validTileData=!1,this.nmiCounter=0,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=0,this.f_spriteSize=0,this.f_bgPatternTable=0,this.f_spPatternTable=0,this.f_addrInc=0,this.f_nTblAddress=0,this.f_color=0,this.f_spVisibility=0,this.f_bgVisibility=0,this.f_spClipping=0,this.f_bgClipping=0,this.f_dispType=0,this.cntFV=0,this.cntV=0,this.cntH=0,this.cntVT=0,this.cntHT=0,this.regFV=0,this.regV=0,this.regH=0,this.regVT=0,this.regHT=0,this.regFH=0,this.regS=0,this.curNt=null,this.attrib=new Array(32),this.buffer=new Array(61440),this.bgbuffer=new Array(61440),this.pixrendered=new Array(61440),this.validTileData=null,this.scantile=new Array(32),this.scanline=0,this.lastRenderedScanline=-1,this.curX=0,this.sprX=new Array(64),this.sprY=new Array(64),this.sprTile=new Array(64),this.sprCol=new Array(64),this.vertFlip=new Array(64),this.horiFlip=new Array(64),this.bgPriority=new Array(64),this.spr0HitX=0,this.spr0HitY=0,this.hitSpr0=!1,this.sprPalette=new Array(16),this.imgPalette=new Array(16),this.ptTile=new Array(512),e=0;e<512;e++)this.ptTile[e]=new r;for(this.ntable1=new Array(4),this.currentMirroring=-1,this.nameTable=new Array(4),e=0;e<4;e++)this.nameTable[e]=new o(32,32,"Nt"+e);for(this.vramMirrorTable=new Array(32768),e=0;e<32768;e++)this.vramMirrorTable[e]=e;this.palTable=new a,this.palTable.loadNTSCPalette(),this.updateControlReg1(0),this.updateControlReg2(0)},setMirroring:function(e){if(e!==this.currentMirroring){this.currentMirroring=e,this.triggerRendering(),null===this.vramMirrorTable&&(this.vramMirrorTable=new Array(32768));for(var t=0;t<32768;t++)this.vramMirrorTable[t]=t;this.defineMirrorRegion(16160,16128,32),this.defineMirrorRegion(16192,16128,32),this.defineMirrorRegion(16256,16128,32),this.defineMirrorRegion(16320,16128,32),this.defineMirrorRegion(12288,8192,3840),this.defineMirrorRegion(16384,0,16384),e===this.nes.rom.HORIZONTAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(11264,10240,1024)):e===this.nes.rom.VERTICAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=0,this.ntable1[3]=1,this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,9216,1024)):e===this.nes.rom.SINGLESCREEN_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=0,this.ntable1[3]=0,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,8192,1024)):e===this.nes.rom.SINGLESCREEN_MIRRORING2?(this.ntable1[0]=1,this.ntable1[1]=1,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,9216,1024),this.defineMirrorRegion(10240,9216,1024),this.defineMirrorRegion(11264,9216,1024)):(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=2,this.ntable1[3]=3)}},defineMirrorRegion:function(e,t,i){for(var r=0;r<i;r++)this.vramMirrorTable[e+r]=t+r},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI),this.lastRenderedScanline<239&&this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline),this.endFrame(),this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:this.dummyCycleToggle&&(this.curX=1,this.dummyCycleToggle=!this.dummyCycleToggle);break;case 20:this.setStatusFlag(this.STATUS_VBLANK,!1),this.setStatusFlag(this.STATUS_SPRITE0HIT,!1),this.hitSpr0=!1,this.spr0HitX=-1,this.spr0HitY=-1,1!==this.f_bgVisibility&&1!==this.f_spVisibility||(this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,1===this.f_bgVisibility&&this.renderBgScanline(!1,0)),1===this.f_bgVisibility&&1===this.f_spVisibility&&this.checkSprite0(0),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter();break;case 261:this.setStatusFlag(this.STATUS_VBLANK,!0),this.requestEndFrame=!0,this.nmiCounter=9,this.scanline=-1;break;default:this.scanline>=21&&this.scanline<=260&&(1===this.f_bgVisibility&&(this.scanlineAlreadyRendered||(this.cntHT=this.regHT,this.cntH=this.regH,this.renderBgScanline(!0,this.scanline+1-21)),this.scanlineAlreadyRendered=!1,this.hitSpr0||1!==this.f_spVisibility||this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(0===this.f_spriteSize?8:16)>=this.scanline-20&&this.checkSprite0(this.scanline-20)&&(this.hitSpr0=!0)),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter())}this.scanline++,this.regsToAddress(),this.cntsToAddress()},startFrame:function(){var e=0;if(0===this.f_dispType)e=this.imgPalette[0];else switch(this.f_color){case 0:case 3:default:e=0;break;case 1:e=65280;break;case 2:e=16711680;break;case 4:e=255}var t,i=this.buffer;for(t=0;t<61440;t++)i[t]=e;var r=this.pixrendered;for(t=0;t<r.length;t++)r[t]=65},endFrame:function(){var e,t,i,r=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(e=0;e<256;e++)r[(this.sprY[0]<<8)+e]=16733525;for(e=0;e<240;e++)r[(e<<8)+this.sprX[0]]=16733525}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(e=0;e<256;e++)r[(this.spr0HitY<<8)+e]=5635925;for(e=0;e<240;e++)r[(e<<8)+this.spr0HitX]=5635925}}if(this.clipToTvSize||0===this.f_bgClipping||0===this.f_spClipping)for(i=0;i<240;i++)for(t=0;t<8;t++)r[(i<<8)+t]=0;if(this.clipToTvSize)for(i=0;i<240;i++)for(t=0;t<8;t++)r[255+(i<<8)-t]=0;if(this.clipToTvSize)for(i=0;i<8;i++)for(t=0;t<256;t++)r[(i<<8)+t]=0,r[(239-i<<8)+t]=0;this.nes.ui.writeFrame(r)},updateControlReg1:function(e){this.triggerRendering(),this.f_nmiOnVblank=e>>7&1,this.f_spriteSize=e>>5&1,this.f_bgPatternTable=e>>4&1,this.f_spPatternTable=e>>3&1,this.f_addrInc=e>>2&1,this.f_nTblAddress=3&e,this.regV=e>>1&1,this.regH=1&e,this.regS=e>>4&1},updateControlReg2:function(e){this.triggerRendering(),this.f_color=e>>5&7,this.f_spVisibility=e>>4&1,this.f_bgVisibility=e>>3&1,this.f_spClipping=e>>2&1,this.f_bgClipping=e>>1&1,this.f_dispType=1&e,0===this.f_dispType&&this.palTable.setEmphasis(this.f_color),this.updatePalettes()},setStatusFlag:function(e,t){var i=1<<e;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-i|(t?i:0)},readStatusRegister:function(){var e=this.nes.cpu.mem[8194];return this.firstWrite=!0,this.setStatusFlag(this.STATUS_VBLANK,!1),e},writeSRAMAddress:function(e){this.sramAddress=e},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(e){this.spriteMem[this.sramAddress]=e,this.spriteRamWriteUpdate(this.sramAddress,e),this.sramAddress++,this.sramAddress%=256},scrollWrite:function(e){this.triggerRendering(),this.firstWrite?(this.regHT=e>>3&31,this.regFH=7&e):(this.regFV=7&e,this.regVT=e>>3&31),this.firstWrite=!this.firstWrite},writeVRAMAddress:function(e){this.firstWrite?(this.regFV=e>>4&3,this.regV=e>>3&1,this.regH=e>>2&1,this.regVT=7&this.regVT|(3&e)<<3):(this.triggerRendering(),this.regVT=24&this.regVT|e>>5&7,this.regHT=31&e,this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.checkSprite0(this.scanline-20)),this.firstWrite=!this.firstWrite,this.cntsToAddress(),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress)},vramLoad:function(){var e;return this.cntsToAddress(),this.regsToAddress(),this.vramAddress<=16127?(e=this.vramBufferedReadValue,this.vramAddress<8192?this.vramBufferedReadValue=this.vramMem[this.vramAddress]:this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),e):(e=this.mirroredLoad(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),e)},vramWrite:function(e){this.triggerRendering(),this.cntsToAddress(),this.regsToAddress(),this.vramAddress>=8192?this.mirroredWrite(this.vramAddress,e):(this.writeMem(this.vramAddress,e),this.nes.mmap.latchAccess(this.vramAddress)),this.vramAddress+=1===this.f_addrInc?32:1,this.regsFromAddress(),this.cntsFromAddress()},sramDMA:function(e){for(var t,i=256*e,r=this.sramAddress;r<256;r++)t=this.nes.cpu.mem[i+r],this.spriteMem[r]=t,this.spriteRamWriteUpdate(r,t);this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var e=this.vramTmpAddress>>8&255;this.regFV=e>>4&7,this.regV=e>>3&1,this.regH=e>>2&1,this.regVT=7&this.regVT|(3&e)<<3,e=255&this.vramTmpAddress,this.regVT=24&this.regVT|e>>5&7,this.regHT=31&e},cntsFromAddress:function(){var e=this.vramAddress>>8&255;this.cntFV=e>>4&3,this.cntV=e>>3&1,this.cntH=e>>2&1,this.cntVT=7&this.cntVT|(3&e)<<3,e=255&this.vramAddress,this.cntVT=24&this.cntVT|e>>5&7,this.cntHT=31&e},regsToAddress:function(){var e=(7&this.regFV)<<4;e|=(1&this.regV)<<3,e|=(1&this.regH)<<2,e|=this.regVT>>3&3;var t=(7&this.regVT)<<5;t|=31&this.regHT,this.vramTmpAddress=32767&(e<<8|t)},cntsToAddress:function(){var e=(7&this.cntFV)<<4;e|=(1&this.cntV)<<3,e|=(1&this.cntH)<<2,e|=this.cntVT>>3&3;var t=(7&this.cntVT)<<5;t|=31&this.cntHT,this.vramAddress=32767&(e<<8|t)},incTileCounter:function(e){for(var t=e;0!==t;t--)this.cntHT++,32===this.cntHT&&(this.cntHT=0,this.cntVT++,this.cntVT>=30&&(this.cntH++,2===this.cntH&&(this.cntH=0,this.cntV++,2===this.cntV&&(this.cntV=0,this.cntFV++,this.cntFV&=7))))},mirroredLoad:function(e){return this.vramMem[this.vramMirrorTable[e]]},mirroredWrite:function(e,t){if(e>=16128&&e<16160)16128===e||16144===e?(this.writeMem(16128,t),this.writeMem(16144,t)):16132===e||16148===e?(this.writeMem(16132,t),this.writeMem(16148,t)):16136===e||16152===e?(this.writeMem(16136,t),this.writeMem(16152,t)):16140===e||16156===e?(this.writeMem(16140,t),this.writeMem(16156,t)):this.writeMem(e,t);else{if(!(e<this.vramMirrorTable.length))throw new Error("Invalid VRAM address: "+e.toString(16));this.writeMem(this.vramMirrorTable[e],t)}},triggerRendering:function(){this.scanline>=21&&this.scanline<=260&&(this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline),this.lastRenderedScanline=this.scanline-21)},renderFramePartially:function(e,t){if(1===this.f_spVisibility&&this.renderSpritesPartially(e,t,!0),1===this.f_bgVisibility){var i=e<<8,r=e+t<<8;r>61440&&(r=61440);for(var n=this.buffer,s=this.bgbuffer,o=this.pixrendered,a=i;a<r;a++)o[a]>255&&(n[a]=s[a])}1===this.f_spVisibility&&this.renderSpritesPartially(e,t,!1),this.validTileData=!1},renderBgScanline:function(e,t){var i=0===this.regS?0:256,r=(t<<8)-this.regFH;if(this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],this.cntHT=this.regHT,this.cntH=this.regH,this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],t<240&&t-this.cntFV>=0){for(var n,s,o,a,c=this.cntFV<<3,h=this.scantile,l=this.attrib,u=this.ptTile,p=this.nameTable,d=this.imgPalette,f=this.pixrendered,m=e?this.bgbuffer:this.buffer,g=0;g<32;g++){if(t>=0){if(this.validTileData){if(void 0===(n=h[g]))continue;s=n.pix,o=l[g]}else{if(void 0===(n=u[i+p[this.curNt].getTileIndex(this.cntHT,this.cntVT)]))continue;s=n.pix,o=p[this.curNt].getAttrib(this.cntHT,this.cntVT),h[g]=n,l[g]=o}var y=0,v=(g<<3)-this.regFH;if(v>-8)if(v<0&&(r-=v,y=-v),n.opaque[this.cntFV])for(;y<8;y++)m[r]=d[s[c+y]+o],f[r]|=256,r++;else for(;y<8;y++)0!==(a=s[c+y])&&(m[r]=d[a+o],f[r]|=256),r++}32==++this.cntHT&&(this.cntHT=0,this.cntH++,this.cntH%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH])}this.validTileData=!0}this.cntFV++,8===this.cntFV&&(this.cntFV=0,this.cntVT++,30===this.cntVT?(this.cntVT=0,this.cntV++,this.cntV%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]):32===this.cntVT&&(this.cntVT=0),this.validTileData=!1)},renderSpritesPartially:function(e,t,i){if(1===this.f_spVisibility)for(var r=0;r<64;r++)if(this.bgPriority[r]===i&&this.sprX[r]>=0&&this.sprX[r]<256&&this.sprY[r]+8>=e&&this.sprY[r]<e+t)if(0===this.f_spriteSize)this.srcy1=0,this.srcy2=8,this.sprY[r]<e&&(this.srcy1=e-this.sprY[r]-1),this.sprY[r]+8>e+t&&(this.srcy2=e+t-this.sprY[r]+1),0===this.f_spPatternTable?this.ptTile[this.sprTile[r]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[r],this.sprY[r]+1,this.sprCol[r],this.sprPalette,this.horiFlip[r],this.vertFlip[r],r,this.pixrendered):this.ptTile[this.sprTile[r]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[r],this.sprY[r]+1,this.sprCol[r],this.sprPalette,this.horiFlip[r],this.vertFlip[r],r,this.pixrendered);else{var n=this.sprTile[r];0!=(1&n)&&(n=this.sprTile[r]-1+256);var s=0,o=8;this.sprY[r]<e&&(s=e-this.sprY[r]-1),this.sprY[r]+8>e+t&&(o=e+t-this.sprY[r]),this.ptTile[n+(this.vertFlip[r]?1:0)].render(this.buffer,0,s,8,o,this.sprX[r],this.sprY[r]+1,this.sprCol[r],this.sprPalette,this.horiFlip[r],this.vertFlip[r],r,this.pixrendered),s=0,o=8,this.sprY[r]+8<e&&(s=e-(this.sprY[r]+8+1)),this.sprY[r]+16>e+t&&(o=e+t-(this.sprY[r]+8)),this.ptTile[n+(this.vertFlip[r]?0:1)].render(this.buffer,0,s,8,o,this.sprX[r],this.sprY[r]+1+8,this.sprCol[r],this.sprPalette,this.horiFlip[r],this.vertFlip[r],r,this.pixrendered)}},checkSprite0:function(e){var t;this.spr0HitX=-1,this.spr0HitY=-1;var i,r,n,s,o,a=0===this.f_spPatternTable?0:256;if(i=this.sprX[0],r=this.sprY[0]+1,0===this.f_spriteSize){if(r<=e&&r+8>e&&i>=-7&&i<256)if(n=this.ptTile[this.sprTile[0]+a],t=this.vertFlip[0]?7-(e-r):e-r,t*=8,o=256*e+i,this.horiFlip[0])for(s=7;s>=0;s--){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[t+s])return this.spr0HitX=o%256,this.spr0HitY=e,!0;i++,o++}else for(s=0;s<8;s++){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[t+s])return this.spr0HitX=o%256,this.spr0HitY=e,!0;i++,o++}}else if(r<=e&&r+16>e&&i>=-7&&i<256)if((t=this.vertFlip[0]?15-(e-r):e-r)<8?n=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+(0!=(1&this.sprTile[0])?255:0)]:(n=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+(0!=(1&this.sprTile[0])?255:0)],this.vertFlip[0]?t=15-t:t-=8),t*=8,o=256*e+i,this.horiFlip[0])for(s=7;s>=0;s--){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[t+s])return this.spr0HitX=o%256,this.spr0HitY=e,!0;i++,o++}else for(s=0;s<8;s++){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[t+s])return this.spr0HitX=o%256,this.spr0HitY=e,!0;i++,o++}return!1},writeMem:function(e,t){this.vramMem[e]=t,e<8192?(this.vramMem[e]=t,this.patternWrite(e,t)):e>=8192&&e<9152?this.nameTableWrite(this.ntable1[0],e-8192,t):e>=9152&&e<9216?this.attribTableWrite(this.ntable1[0],e-9152,t):e>=9216&&e<10176?this.nameTableWrite(this.ntable1[1],e-9216,t):e>=10176&&e<10240?this.attribTableWrite(this.ntable1[1],e-10176,t):e>=10240&&e<11200?this.nameTableWrite(this.ntable1[2],e-10240,t):e>=11200&&e<11264?this.attribTableWrite(this.ntable1[2],e-11200,t):e>=11264&&e<12224?this.nameTableWrite(this.ntable1[3],e-11264,t):e>=12224&&e<12288?this.attribTableWrite(this.ntable1[3],e-12224,t):e>=16128&&e<16160&&this.updatePalettes()},updatePalettes:function(){var e;for(e=0;e<16;e++)0===this.f_dispType?this.imgPalette[e]=this.palTable.getEntry(63&this.vramMem[16128+e]):this.imgPalette[e]=this.palTable.getEntry(32&this.vramMem[16128+e]);for(e=0;e<16;e++)0===this.f_dispType?this.sprPalette[e]=this.palTable.getEntry(63&this.vramMem[16144+e]):this.sprPalette[e]=this.palTable.getEntry(32&this.vramMem[16144+e])},patternWrite:function(e,t){var i=Math.floor(e/16),r=e%16;r<8?this.ptTile[i].setScanline(r,t,this.vramMem[e+8]):this.ptTile[i].setScanline(r-8,this.vramMem[e-8],t)},nameTableWrite:function(e,t,i){this.nameTable[e].tile[t]=i,this.checkSprite0(this.scanline-20)},attribTableWrite:function(e,t,i){this.nameTable[e].writeAttrib(t,i)},spriteRamWriteUpdate:function(e,t){var i=Math.floor(e/4);0===i&&this.checkSprite0(this.scanline-20),e%4==0?this.sprY[i]=t:e%4==1?this.sprTile[i]=t:e%4==2?(this.vertFlip[i]=0!=(128&t),this.horiFlip[i]=0!=(64&t),this.bgPriority[i]=0!=(32&t),this.sprCol[i]=(3&t)<<2):e%4==3&&(this.sprX[i]=t)},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,!0),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},isPixelWhite:function(e,t){return this.triggerRendering(),16777215===this.nes.ppu.buffer[(t<<8)+e]},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],toJSON:function(){var e,t=n.toJSON(this);for(t.nameTable=[],e=0;e<this.nameTable.length;e++)t.nameTable[e]=this.nameTable[e].toJSON();for(t.ptTile=[],e=0;e<this.ptTile.length;e++)t.ptTile[e]=this.ptTile[e].toJSON();return t},fromJSON:function(e){var t;for(n.fromJSON(this,e),t=0;t<this.nameTable.length;t++)this.nameTable[t].fromJSON(e.nameTable[t]);for(t=0;t<this.ptTile.length;t++)this.ptTile[t].fromJSON(e.ptTile[t]);for(t=0;t<this.spriteMem.length;t++)this.spriteRamWriteUpdate(t,this.spriteMem[t])}};var o=function(e,t,i){this.width=e,this.height=t,this.name=i,this.tile=new Array(e*t),this.attrib=new Array(e*t);for(var r=0;r<e*t;r++)this.tile[r]=0,this.attrib[r]=0};o.prototype={getTileIndex:function(e,t){return this.tile[t*this.width+e]},getAttrib:function(e,t){return this.attrib[t*this.width+e]},writeAttrib:function(e,t){for(var i,r,n,s=e%8*4,o=4*Math.floor(e/8),a=0;a<2;a++)for(var c=0;c<2;c++){i=t>>2*(2*a+c)&3;for(var h=0;h<2;h++)for(var l=0;l<2;l++)r=s+2*c+l,n=(o+2*a+h)*this.width+r,this.attrib[n]=i<<2&12}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(e){this.tile=e.tile,this.attrib=e.attrib}};var a=function(){this.curTable=new Array(64),this.emphTable=new Array(8),this.currentEmph=-1};a.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},makeTables:function(){for(var e,t,i,r,n,s,o,a,c=0;c<8;c++)for(s=1,o=1,a=1,0!=(1&c)&&(s=.75,a=.75),0!=(2&c)&&(s=.75,o=.75),0!=(4&c)&&(o=.75,a=.75),this.emphTable[c]=new Array(64),n=0;n<64;n++)r=this.curTable[n],e=Math.floor(this.getRed(r)*s),t=Math.floor(this.getGreen(r)*o),i=Math.floor(this.getBlue(r)*a),this.emphTable[c][n]=this.getRgb(e,t,i)},setEmphasis:function(e){if(e!==this.currentEmph){this.currentEmph=e;for(var t=0;t<64;t++)this.curTable[t]=this.emphTable[e][t]}},getEntry:function(e){return this.curTable[e]},getRed:function(e){return e>>16&255},getGreen:function(e){return e>>8&255},getBlue:function(e){return 255&e},getRgb:function(e,t,i){return e<<16|t<<8|i},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117),this.curTable[1]=this.getRgb(39,27,143),this.curTable[2]=this.getRgb(0,0,171),this.curTable[3]=this.getRgb(71,0,159),this.curTable[4]=this.getRgb(143,0,119),this.curTable[5]=this.getRgb(171,0,19),this.curTable[6]=this.getRgb(167,0,0),this.curTable[7]=this.getRgb(127,11,0),this.curTable[8]=this.getRgb(67,47,0),this.curTable[9]=this.getRgb(0,71,0),this.curTable[10]=this.getRgb(0,81,0),this.curTable[11]=this.getRgb(0,63,23),this.curTable[12]=this.getRgb(27,63,95),this.curTable[13]=this.getRgb(0,0,0),this.curTable[14]=this.getRgb(0,0,0),this.curTable[15]=this.getRgb(0,0,0),this.curTable[16]=this.getRgb(188,188,188),this.curTable[17]=this.getRgb(0,115,239),this.curTable[18]=this.getRgb(35,59,239),this.curTable[19]=this.getRgb(131,0,243),this.curTable[20]=this.getRgb(191,0,191),this.curTable[21]=this.getRgb(231,0,91),this.curTable[22]=this.getRgb(219,43,0),this.curTable[23]=this.getRgb(203,79,15),this.curTable[24]=this.getRgb(139,115,0),this.curTable[25]=this.getRgb(0,151,0),this.curTable[26]=this.getRgb(0,171,0),this.curTable[27]=this.getRgb(0,147,59),this.curTable[28]=this.getRgb(0,131,139),this.curTable[29]=this.getRgb(0,0,0),this.curTable[30]=this.getRgb(0,0,0),this.curTable[31]=this.getRgb(0,0,0),this.curTable[32]=this.getRgb(255,255,255),this.curTable[33]=this.getRgb(63,191,255),this.curTable[34]=this.getRgb(95,151,255),this.curTable[35]=this.getRgb(167,139,253),this.curTable[36]=this.getRgb(247,123,255),this.curTable[37]=this.getRgb(255,119,183),this.curTable[38]=this.getRgb(255,119,99),this.curTable[39]=this.getRgb(255,155,59),this.curTable[40]=this.getRgb(243,191,63),this.curTable[41]=this.getRgb(131,211,19),this.curTable[42]=this.getRgb(79,223,75),this.curTable[43]=this.getRgb(88,248,152),this.curTable[44]=this.getRgb(0,235,219),this.curTable[45]=this.getRgb(0,0,0),this.curTable[46]=this.getRgb(0,0,0),this.curTable[47]=this.getRgb(0,0,0),this.curTable[48]=this.getRgb(255,255,255),this.curTable[49]=this.getRgb(171,231,255),this.curTable[50]=this.getRgb(199,215,255),this.curTable[51]=this.getRgb(215,203,255),this.curTable[52]=this.getRgb(255,199,255),this.curTable[53]=this.getRgb(255,199,219),this.curTable[54]=this.getRgb(255,191,179),this.curTable[55]=this.getRgb(255,219,171),this.curTable[56]=this.getRgb(255,231,163),this.curTable[57]=this.getRgb(227,255,163),this.curTable[58]=this.getRgb(171,243,191),this.curTable[59]=this.getRgb(179,255,207),this.curTable[60]=this.getRgb(159,255,243),this.curTable[61]=this.getRgb(0,0,0),this.curTable[62]=this.getRgb(0,0,0),this.curTable[63]=this.getRgb(0,0,0),this.makeTables(),this.setEmphasis(0)}},e.exports=s},471:(e,t,i)=>{var r=i(939),n=i(361),s=function(e){this.nes=e,this.mapperName=new Array(92);for(var t=0;t<92;t++)this.mapperName[t]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"};s.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(e){var t,i,r;if(-1===e.indexOf("NES"))throw new Error("Not a valid NES ROM.");for(this.header=new Array(16),t=0;t<16;t++)this.header[t]=255&e.charCodeAt(t);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=0!=(1&this.header[6])?1:0,this.batteryRam=0!=(2&this.header[6]),this.trainer=0!=(4&this.header[6]),this.fourScreen=0!=(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];var s=!1;for(t=8;t<16;t++)if(0!==this.header[t]){s=!0;break}s&&(this.mapperType&=15),this.rom=new Array(this.romCount);var o,a,c=16;for(t=0;t<this.romCount;t++){for(this.rom[t]=new Array(16384),i=0;i<16384&&!(c+i>=e.length);i++)this.rom[t][i]=255&e.charCodeAt(c+i);c+=16384}for(this.vrom=new Array(this.vromCount),t=0;t<this.vromCount;t++){for(this.vrom[t]=new Array(4096),i=0;i<4096&&!(c+i>=e.length);i++)this.vrom[t][i]=255&e.charCodeAt(c+i);c+=4096}for(this.vromTile=new Array(this.vromCount),t=0;t<this.vromCount;t++)for(this.vromTile[t]=new Array(256),i=0;i<256;i++)this.vromTile[t][i]=new n;for(r=0;r<this.vromCount;r++)for(t=0;t<4096;t++)o=t>>4,(a=t%16)<8?this.vromTile[r][o].setScanline(a,this.vrom[r][t],this.vrom[r][t+8]):this.vromTile[r][o].setScanline(a-8,this.vrom[r][t-8],this.vrom[r][t]);this.valid=!0},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return void 0!==r[this.mapperType]},createMapper:function(){if(this.mapperSupported())return new r[this.mapperType](this.nes);throw new Error("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")")}},e.exports=s},361:e=>{var t=function(){this.pix=new Array(64),this.fbIndex=null,this.tIndex=null,this.x=null,this.y=null,this.w=null,this.h=null,this.incX=null,this.incY=null,this.palIndex=null,this.tpri=null,this.c=null,this.initialized=!1,this.opaque=new Array(8)};t.prototype={setBuffer:function(e){for(this.y=0;this.y<8;this.y++)this.setScanline(this.y,e[this.y],e[this.y+8])},setScanline:function(e,t,i){for(this.initialized=!0,this.tIndex=e<<3,this.x=0;this.x<8;this.x++)this.pix[this.tIndex+this.x]=(t>>7-this.x&1)+((i>>7-this.x&1)<<1),0===this.pix[this.tIndex+this.x]&&(this.opaque[e]=!1)},render:function(e,t,i,r,n,s,o,a,c,h,l,u,p){if(!(s<-7||s>=256||o<-7||o>=240))if(this.w=r-t,this.h=n-i,s<0&&(t-=s),s+r>=256&&(r=256-s),o<0&&(i-=o),o+n>=240&&(n=240-o),h||l)if(h&&!l)for(this.fbIndex=(o<<8)+s,this.tIndex=7,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<r&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=c[this.palIndex+a],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256,this.tIndex+=16}else if(l&&!h)for(this.fbIndex=(o<<8)+s,this.tIndex=56,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<r&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=c[this.palIndex+a],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256,this.tIndex-=16}else for(this.fbIndex=(o<<8)+s,this.tIndex=63,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<r&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=c[this.palIndex+a],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256}else for(this.fbIndex=(o<<8)+s,this.tIndex=0,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<r&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=c[this.palIndex+a],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256}},isTransparent:function(e,t){return 0===this.pix[(t<<3)+e]},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(e){this.opaque=e.opaque,this.pix=e.pix}},e.exports=t},610:e=>{e.exports={copyArrayElements:function(e,t,i,r,n){for(var s=0;s<n;++s)i[r+s]=e[t+s]},copyArray:function(e){return e.slice(0)},fromJSON:function(e,t){for(var i=0;i<e.JSON_PROPERTIES.length;i++)e[e.JSON_PROPERTIES[i]]=t[e.JSON_PROPERTIES[i]]},toJSON:function(e){for(var t={},i=0;i<e.JSON_PROPERTIES.length;i++)t[e.JSON_PROPERTIES[i]]=e[e.JSON_PROPERTIES[i]];return t}}}},t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=i(783);const t=i(520);let r=null;const n=256,s=240;class o extends e.Game{constructor(e){super();const i=e.getContext("2d");this.imageData=i.getImageData(0,0,n,s),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8ClampedArray(this.buf),this.buf32=new Uint32Array(this.buf);for(var o=0;o<this.buf32.length;++o)this.buf32[o]=4278190080;this.nes=new t.NES({onFrame:e=>{for(var t=0,i=0;i<s;++i)for(var r=0;r<n;++r)t=256*i+r,this.buf32[t]=4278190080|e[t]},onAudioSample:(e,t)=>{}}),this.nes.loadROM(r)}serialize(){throw new Error("The game state cannot be serialized.")}deserialize(e){throw new Error("The game state cannot be deserialized.")}tick(e){this.nes.frame();for(let[i,r]of e)r.pressed.z?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_A):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_A),r.pressed.x?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_B):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_B),r.pressed.ArrowUp?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_UP):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_UP),r.pressed.ArrowDown?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_DOWN):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_DOWN),r.pressed.ArrowLeft?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_LEFT):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_LEFT),r.pressed.ArrowRight?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_RIGHT):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_RIGHT),r.pressed.Enter?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_START):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_START),r.pressed.Shift?this.nes.buttonDown(i.getID()+1,t.Controller.BUTTON_SELECT):this.nes.buttonUp(i.getID()+1,t.Controller.BUTTON_SELECT)}draw(e){const t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,n,s),this.imageData.data.set(this.buf8),t.putImageData(this.imageData,0,0)}}var a,c;o.timestep=1e3/60,o.canvasSize={width:n,height:s},o.deterministic=!0,a=(t,i)=>{r=i,new e.LockstepWrapper(o).start()},(c=new XMLHttpRequest).open("GET","../files/rom.nes"),c.overrideMimeType("text/plain; charset=x-user-defined"),c.onload=function(){if(200===this.status){if(c.responseText.match(/^<!doctype html>/i))return a(new Error("Page not found"));a(0,this.responseText)}else 0===this.status||a(new Error(c.statusText))},c.onerror=function(){a(new Error(c.statusText))},c.send()})()})();